<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interaktiver Chartmuster Visualisierer</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Basis-Reset und Grundstile */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            height: 100%;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827;
            color: #e5e7eb;
            display: flex;
            flex-direction: column;
            min-height: 100%;
            align-items: center;
            padding: 1rem; 
        }

        /* Container-Stile */
        .main-container {
            width: 100%;
            max-width: 1280px; 
            margin-left: auto;
            margin-right: auto;
            display: flex; 
            flex-direction: column; 
            flex-grow: 1; 
        }

        /* Header-Stile */
        .header {
            margin-bottom: 1.5rem; 
            text-align: center;
            flex-shrink: 0; 
        }
        .header-title {
            font-size: 1.875rem; 
            font-weight: 700; 
            background-image: linear-gradient(to right, #60a5fa, #a78bfa);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        .header-subtitle {
            color: #9ca3af; 
            margin-top: 0.5rem; 
            font-size: 0.875rem; 
        }

        /* Grid-Layout Stile */
        .content-grid {
            display: grid;
            grid-template-columns: 1fr; 
            gap: 1.5rem; 
            flex-grow: 1; 
            width: 100%; 
        }

        /* Musterauswahl-Stile */
        .pattern-select-container {
            background-color: #1f2937; 
            padding: 1rem; 
            border-radius: 0.5rem; 
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -2px rgba(0,0,0,0.1); 
            overflow-y: auto; 
            max-height: calc(100vh - 10rem); 
        }
        
        .pattern-select-title {
            font-size: 1.25rem; 
            font-weight: 600; 
            margin-bottom: 0.75rem; 
            color: #e5e7eb; 
        }
        .category-title {
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            font-size: 1.125rem; 
            font-weight: 600; 
            color: #9ca3af; 
            border-bottom: 1px solid #374151;
            padding-bottom: 0.25rem;
        }
        .category-title:first-of-type {
            margin-top: 0;
        }
        .pattern-button {
            width: 100%;
            text-align: left;
            padding: 0.75rem; 
            background-color: #374151; 
            border-radius: 0.375rem; 
            color: #d1d5db; 
            margin-bottom: 0.25rem; 
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .pattern-button:hover {
            background-color: #4b5563; 
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .pattern-button:focus {
            outline: none;
            box-shadow: 0 0 0 2px #3b82f6; 
        }
        .pattern-button.active { 
            background-color: #3b82f6; 
            color: white;
            font-weight: 600;
        }
        
        /* Indikator-Steuerung */
        .indicator-controls {
            margin-top: 1.5rem; 
        }
        .indicator-controls > *:not(:last-child) { 
            margin-bottom: 0.5rem;
        }
        .indicator-controls h3 {
            font-size: 1.125rem; 
            font-weight: 600; 
            margin-bottom: 0.5rem; 
            color: #e5e7eb; 
        }
        .indicator-controls label {
            display: flex;
            align-items: center;
            padding: 0.5rem;
            background-color: #374151;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .indicator-controls label:hover {
            background-color: #4b5563;
        }
        .indicator-controls input[type="checkbox"] {
            margin-right: 0.5rem;
            accent-color: #3b82f6;
        }

        /* Chart und Beschreibungsbereich */
        .chart-description-area {
            display: flex;
            flex-direction: column;
            min-width: 0; 
        }

        .chart-description-area > *:not(:last-child) { 
            margin-bottom: 1.5rem;
        }
        .charts-container { 
            border: 1px solid #374151; 
            border-radius: 0.5rem;
            background-color: #1f2937; 
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            padding: 1rem; 
            flex-shrink: 0; 
            width: 100%; 
            overflow: hidden; 
        }
        #chartCanvas, #rsiCanvas {
            width: 100%  !important;
            margin-left: auto;
            margin-right: auto;
            height: auto; 
            border-radius: 0.375rem; 
            display: block; 
        }
        #rsiCanvas {
            border-top: 1px solid #374151;
            margin-top: 1rem;
        }
        .description-box {
            background-color: #1f2937;
            border-radius: 0.5rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            color: #d1d5db; 
            width: 100%; 
            overflow-y: auto; 
            /*max-height: calc(80vh - 250px); */
            flex-grow: 1; 
        }
        .pattern-title-wrapper { 
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem; 
        }
        #patternName { 
            font-size: 1.5rem; 
            font-weight: 600; 
            color: #60a5fa; 
        }
        .main-favorite-button { 
            background: none;
            border: none;
            color: #9ca3af; 
            font-size: 1.75rem; 
            cursor: pointer;
            padding: 0.25rem;
            line-height: 1;
            transition: color 0.2s ease-in-out, transform 0.1s ease;
        }
        .main-favorite-button:hover {
            transform: scale(1.1);
        }
        .main-favorite-button.is-favorite {
            color: #facc15; 
        }

        .description-box p, .description-box ul {
            margin-bottom: 1rem; 
            overflow-wrap: break-word; 
            word-break: break-word; 
        }
        .description-box h4 {
            font-weight: 600; 
            font-size: 1.125rem; 
            margin-bottom: 0.5rem; 
            color: #e5e7eb; 
        }
        .description-box ul {
            list-style-type: disc;
            list-style-position: inside;
        }
        .description-box ul > *:not(:last-child) { 
            margin-bottom: 0.25rem;
        }

        /* Footer-Stile */
        .footer {
            text-align: center;
            margin-top: 2rem; 
            color: #6b7280; 
            font-size: 0.875rem; 
            flex-shrink: 0; 
        }

        /* Tooltip-Stile (existierend) */
        .tooltip {
            position: absolute;
            background-color: #374151;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.875rem;
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 10;
            pointer-events: none; 
        }
        /* Scrollbar-Stile (existierend) */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #1f2937; border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #6b7280; }
        .disclaimer {
            font-size: 0.75rem; 
            color: #9ca3af; 
            margin-top: 0.5rem;
            border-top: 1px solid #374151;
            padding-top: 0.5rem;
        }

        /* Responsive Anpassungen */
        @media (min-width: 640px) { 
            body { padding: 1.5rem; }
            .header { margin-bottom: 2rem; }
            .header-title { font-size: 2.25rem; } 
            .header-subtitle { font-size: 1rem; } 
            .content-grid { gap: 2rem; } 
            .chart-description-area > *:not(:last-child) {
                 margin-bottom: 2rem; 
            }
        }

        @media (min-width: 1024px) { 
            body { padding: 2rem; }
            .content-grid {
                grid-template-columns: 1fr 2fr; 
                align-items: stretch; 
            }
        }

    </style>
</head>
<body> 

    <div class="main-container">
        <header class="header">
            <h1 class="header-title">
                Interaktiver Chartmuster Visualisierer
            </h1>
            <p class="header-subtitle">Wählen Sie ein Muster und optionale Indikatoren aus.</p>
        </header>

        <div class="content-grid">
            <!-- Musterauswahl & Indikator Steuerung -->
            <div class="pattern-select-container">
                <h2 class="pattern-select-title">Chartmuster wählen:</h2>
                <!-- Kategorien und Buttons werden hier per JS eingefügt -->
                
                <div class="indicator-controls">
                    <h3>Illustrative Indikatoren:</h3>
                    <div>
                        <label for="showMA">
                            <input type="checkbox" id="showMA"> Gleitender Durchschnitt (MA)
                        </label>
                        <label for="showRSI">
                            <input type="checkbox" id="showRSI"> Relative Strength Index (RSI)
                        </label>
                    </div>
                </div>
            </div>

            <!-- Canvas und Beschreibung -->
            <div class="chart-description-area">
                <div id="chartsContainer" class="charts-container">
                    <canvas id="chartCanvas"></canvas>
                    <canvas id="rsiCanvas" style="display:none;"></canvas>
                </div>
                <div id="patternInfo" class="description-box">
                    <div class="pattern-title-wrapper">
                        <h3 id="patternName">Wählen Sie ein Muster</h3>
                        <button id="mainFavoriteButton" class="main-favorite-button" title="Als Favorit markieren" disabled>☆</button>
                    </div>
                    <p id="patternDescription">Die Beschreibung des ausgewählten Chartmusters wird hier angezeigt.</p>
                    <div id="patternCharacteristics">
                        <h4>Charakteristika:</h4>
                        <ul id="characteristicsList">
                            <li>Wird geladen...</li>
                        </ul>
                    </div>
                    <div id="patternTrading" >
                        <h4>Trading-Implikationen:</h4>
                        <p id="tradingText">Wird geladen...</p>
                    </div>
                    <div id="patternAdvanced" class="mt-4">
                        <h4>Detailliertere Informationen:</h4>
                        <p id="advancedText">Wird geladen...</p>
                    </div>
                    <div id="patternPerformance" class="mt-4">
                        <h4>Performance-Hinweise (Illustrativ):</h4>
                        <p id="performanceText">Wird geladen...</p>
                        <p class="disclaimer"><strong>Disclaimer:</strong> Diese Hinweise sind rein illustrativ und basieren auf allgemeinen Beobachtungen. Sie stellen keine Anlageberatung dar und garantieren keine zukünftigen Ergebnisse. Die tatsächliche Performance kann stark variieren.</p>
                    </div>
                </div>
            </div>
        </div>
         <footer class="footer">
            <p>&copy; <span id="currentYear"></span> Chartmuster Visualisierer. Alle Rechte vorbehalten.</p>
        </footer>
    </div>

    <script>
        const chartCanvas = document.getElementById('chartCanvas');
        const ctx = chartCanvas.getContext('2d');
        const rsiCanvas = document.getElementById('rsiCanvas');
        const rsiCtx = rsiCanvas.getContext('2d');
        const chartsContainer = document.getElementById('chartsContainer'); 
        
        const patternSelectContainer = document.querySelector('.pattern-select-container');
        const patternNameEl = document.getElementById('patternName');
        const patternDescriptionEl = document.getElementById('patternDescription');
        const characteristicsListEl = document.getElementById('characteristicsList');
        const tradingTextEl = document.getElementById('tradingText');
        const advancedTextEl = document.getElementById('advancedText');
        const performanceTextEl = document.getElementById('performanceText'); 
        const mainFavoriteButton = document.getElementById('mainFavoriteButton');
        document.getElementById('currentYear').textContent = new Date().getFullYear();

        const showMACheckbox = document.getElementById('showMA');
        const showRSICheckbox = document.getElementById('showRSI');

        let currentPattern = null;
        let baseWidth, baseChartHeight, rsiHeight = 80; 

        let showIllustrativeMA = false;
        let showIllustrativeRSI = false;
        let favoritePatterns = [];

        // Laden der Favoriten aus dem localStorage
        function loadFavorites() {
            const storedFavorites = localStorage.getItem('chartPatternFavorites');
            if (storedFavorites) {
                favoritePatterns = JSON.parse(storedFavorites);
            }
        }

        // Speichern der Favoriten im localStorage
        function saveFavorites() {
            localStorage.setItem('chartPatternFavorites', JSON.stringify(favoritePatterns));
        }

        // Umschalten des Favoritenstatus für das aktuelle Muster
        function toggleCurrentPatternFavorite() {
            if (!currentPattern) return; // Nur ausführen, wenn ein Muster ausgewählt ist

            const patternId = currentPattern.id;
            const index = favoritePatterns.indexOf(patternId);
            if (index > -1) {
                favoritePatterns.splice(index, 1); // Entfernen
            } else {
                favoritePatterns.push(patternId); // Hinzufügen
            }
            saveFavorites();
            updateMainFavoriteButtonState(); 
            generatePatternButtons(); // Liste neu generieren, um Favoritenkategorie zu aktualisieren
        }

        function updateMainFavoriteButtonState() {
            if (currentPattern && favoritePatterns.includes(currentPattern.id)) {
                mainFavoriteButton.classList.add('is-favorite');
                mainFavoriteButton.textContent = '★';
                mainFavoriteButton.title = 'Aus Favoriten entfernen';
            } else {
                mainFavoriteButton.classList.remove('is-favorite');
                mainFavoriteButton.textContent = '☆';
                mainFavoriteButton.title = 'Als Favorit markieren';
            }
            mainFavoriteButton.disabled = !currentPattern;
        }
        
        mainFavoriteButton.addEventListener('click', () => {
            toggleCurrentPatternFavorite();
        });

        const chartPatternsByCategory = {
            "Umkehrmuster": [
                {
                    id: 'headAndShoulders',
                    name: 'SKS (Schulter-Kopf-Schulter)',
                    description: 'Ein SKS-Muster ist eine bärische Umkehrformation, die typischerweise am Ende eines Aufwärtstrends auftritt. Es besteht aus drei Hochs, wobei das mittlere Hoch (Kopf) höher ist als die beiden seitlichen Hochs (Schultern). Eine Nackenlinie verbindet die Tiefs zwischen den Hochs.',
                    characteristics: [
                        'Tritt nach einem Aufwärtstrend auf.',
                        'Drei Peaks: linke Schulter, Kopf (höchster Peak), rechte Schulter.',
                        'Nackenlinie (Neckline) verbindet die Tiefs zwischen den Peaks.',
                        'Volumen ist oft höher bei der linken Schulter und dem Kopf, geringer bei der rechten Schulter.'
                    ],
                    trading: 'Ein Verkaufssignal entsteht, wenn der Kurs die Nackenlinie nach unten durchbricht. Das Kursziel wird oft als die Distanz vom Kopf zur Nackenlinie, projiziert nach unten vom Ausbruchspunkt, berechnet.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Mittel bis hoch, insbesondere bei klarem Bruch der Nackenlinie mit erhöhtem Volumen und nachfolgender Bestätigung (z.B. Pullback zur Nackenlinie, die dann als Widerstand hält).<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Short-Position bei oder nach dem Bruch der Nackenlinie. Stop-Loss (SL): Knapp über der Nackenlinie oder über der rechten Schulter. Take-Profit (TP): Mindestens die Distanz vom Kopf zur Nackenlinie, vom Ausbruchspunkt nach unten projiziert.',
                    advancedConsiderations: '<strong>Fehlausbrüche:</strong> Ein Fehlausbruch über die Nackenlinie (nach oben) kann ein starkes bullisches Signal sein (siehe SKS-Top Fehlausbruch). Ein Fehlausbruch unter die Nackenlinie, der schnell wieder darüber schließt, kann ebenfalls eine Falle sein.<br><strong>Variationen:</strong> Die Nackenlinie kann leicht geneigt sein. Die Schultern müssen nicht exakt gleich hoch sein.<br><strong>Kontext:</strong> Stärkeres Signal, wenn es nach einem längeren, etablierten Aufwärtstrend auftritt. Bärische Divergenzen im RSI oder MACD können das Signal verstärken.<br><strong>Kombinationen:</strong> Kann Teil einer größeren Top-Bildung sein oder nach einem Fehlausbruch eines anderen Musters entstehen.',
                    performanceStats: 'Historisch gesehen eine der zuverlässigeren Umkehrformationen. Die Erfolgsquote kann je nach Markt und Zeitrahmen variieren, liegt aber oft über 60-70% bei idealtypischer Ausbildung und Bestätigung. Das Risk-Reward-Verhältnis ist oft günstig, da das Kursziel klar definiert ist.',
                    drawFunction: (ctx, w, h) => {
                        const neckY = h * 0.6;
                        drawLine(ctx, w * 0.1, neckY, w * 0.9, neckY, '#e5e7eb', 2, 'Nackenlinie');
                        drawPeak(ctx, w * 0.25, h * 0.4, w * 0.15, neckY, '#fca5a5', 'Linke Schulter');
                        drawPeak(ctx, w * 0.5, h * 0.2, w * 0.2, neckY, '#ef4444', 'Kopf');
                        drawPeak(ctx, w * 0.75, h * 0.45, w * 0.15, neckY, '#fca5a5', 'Rechte Schulter');
                        drawText(ctx, 'L Schulter', w * 0.25, h * 0.38, '#fde047');
                        drawText(ctx, 'Kopf', w * 0.5, h * 0.18, '#fde047');
                        drawText(ctx, 'R Schulter', w * 0.75, h * 0.43, '#fde047');
                        drawText(ctx, 'Nackenlinie', w * 0.5, neckY + 20, '#e5e7eb');
                        drawArrow(ctx, w * 0.8, neckY, w * 0.8, neckY + h*0.2, '#ef4444', 2, 'Ausbruchsrichtung');
                        drawText(ctx, 'Ausbruch', w * 0.8, neckY + h*0.2 + 20, '#ef4444');
                    }
                },
                {
                    id: 'inverseHeadAndShoulders',
                    name: 'Inverse SKS (iSKS)',
                    description: 'Eine inverse SKS-Formation ist ein bullisches Umkehrmuster, das typischerweise am Ende eines Abwärtstrends auftritt. Es ist das Spiegelbild des SKS-Musters.',
                    characteristics: [
                        'Tritt nach einem Abwärtstrend auf.',
                        'Drei Tiefs: linke Schulter, Kopf (tiefster Punkt), rechte Schulter.',
                        'Nackenlinie verbindet die Hochs zwischen den Tiefs.',
                        'Volumen kann beim Ausbruch über die Nackenlinie ansteigen.'
                    ],
                    trading: 'Ein Kaufsignal entsteht, wenn der Kurs die Nackenlinie nach oben durchbricht. Das Kursziel wird oft als die Distanz vom Kopf zur Nackenlinie, projiziert nach oben vom Ausbruchspunkt, berechnet.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Mittel bis hoch, insbesondere bei klarem Bruch der Nackenlinie mit erhöhtem Volumen und nachfolgender Bestätigung (z.B. Pullback zur Nackenlinie, die dann als Unterstützung hält).<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Long-Position bei oder nach dem Bruch der Nackenlinie. SL: Knapp unter der Nackenlinie oder unter der rechten Schulter. TP: Mindestens die Distanz vom Kopf zur Nackenlinie, vom Ausbruchspunkt nach oben projiziert.',
                    advancedConsiderations: '<strong>Fehlausbrüche:</strong> Ein Fehlausbruch unter die Nackenlinie (nach unten) kann ein starkes bärisches Signal sein (siehe iSKS-Boden Fehlausbruch).<br><strong>Variationen:</strong> Die Nackenlinie kann leicht geneigt sein. Die Schultern müssen nicht exakt gleich tief sein.<br><strong>Kontext:</strong> Stärkeres Signal, wenn es nach einem längeren, etablierten Abwärtstrend auftritt. Bullische Divergenzen im RSI oder MACD können das Signal verstärken.',
                    performanceStats: 'Ähnlich zuverlässig wie das SKS-Top. Die Erfolgsquote ist vergleichbar, und das Risk-Reward-Verhältnis kann attraktiv sein.',
                    drawFunction: (ctx, w, h) => { 
                        const neckY = h * 0.4;
                        drawLine(ctx, w * 0.1, neckY, w * 0.9, neckY, '#e5e7eb', 2, 'Nackenlinie');
                        drawTrough(ctx, w * 0.25, h * 0.6, w * 0.15, neckY, '#86efac', 'Linke Schulter');
                        drawTrough(ctx, w * 0.5, h * 0.8, w * 0.2, neckY, '#22c55e', 'Kopf');
                        drawTrough(ctx, w * 0.75, h * 0.55, w * 0.15, neckY, '#86efac', 'Rechte Schulter');
                        drawText(ctx, 'L Schulter', w * 0.25, h * 0.62, '#fde047');
                        drawText(ctx, 'Kopf', w * 0.5, h * 0.82, '#fde047');
                        drawText(ctx, 'R Schulter', w * 0.75, h * 0.57, '#fde047');
                        drawText(ctx, 'Nackenlinie', w * 0.5, neckY - 15, '#e5e7eb');
                        drawArrow(ctx, w * 0.8, neckY, w * 0.8, neckY - h*0.2, '#22c55e', 2, 'Ausbruchsrichtung');
                        drawText(ctx, 'Ausbruch', w * 0.8, neckY - h*0.2 - 15, '#22c55e');
                    }
                },
                 {
                    id: 'headAndShouldersTopFailure',
                    name: 'SKS-Top Fehlausbruch',
                    description: 'Ein SKS-Top Fehlausbruch tritt auf, wenn ein SKS-Muster sich zu bilden beginnt, der Kurs aber die Nackenlinie nicht nachhaltig nach unten durchbricht und stattdessen wieder über die rechte Schulter oder sogar den Kopf ansteigt. Dies kann ein starkes bullisches Signal sein.',
                    characteristics: [
                        'Ansatz eines SKS-Top-Musters (linke Schulter, Kopf, rechte Schulter).',
                        'Der Kurs scheitert daran, die Nackenlinie signifikant nach unten zu durchbrechen.',
                        'Stattdessen steigt der Kurs wieder an, oft über das Niveau der rechten Schulter oder des Kopfes.',
                        'Signalisiert, dass die Verkäufer nicht stark genug waren, den Trend zu wenden.'
                    ],
                    trading: 'Ein Kaufsignal entsteht, wenn der Kurs nach dem gescheiterten Bruch der Nackenlinie wieder Stärke zeigt und über wichtige Widerstandsniveaus des unvollendeten SKS-Musters steigt.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Mittel bis hoch, da der Fehlausbruch oft eine Falle für Short-Seller darstellt und eine starke Gegenbewegung auslösen kann.<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Long-Position, wenn der Kurs über die rechte Schulter oder den Kopf des gescheiterten SKS-Musters steigt. SL: Unterhalb der Nackenlinie oder des Tiefs der rechten Schulter. TP: Basierend auf vorherigen Widerständen oder Fibonacci-Projektionen des vorherigen Aufwärtstrends.',
                    advancedConsiderations: 'Achten Sie auf das Volumen: Ein Fehlausbruch mit geringem Volumen beim Versuch, die Nackenlinie zu durchbrechen, und anschließendem Anstieg mit höherem Volumen ist ein stärkeres Signal.',
                    performanceStats: 'Fehlausbrüche können starke Signale sein, da sie Marktteilnehmer auf dem falschen Fuß erwischen. Die Zuverlässigkeit hängt von der Stärke der Umkehr ab.',
                    drawFunction: (ctx, w, h) => { 
                        const neckY = h * 0.6;
                        const headPeakY = h * 0.2;
                        const shoulderPeakY = h * 0.35;

                        drawLine(ctx, w * 0.1, neckY, w * 0.7, neckY, '#e5e7eb', 2, 'Nackenlinie (nicht gebrochen)');
                        drawPeak(ctx, w * 0.2, shoulderPeakY, w * 0.15, neckY, '#fca5a5', 'Linke Schulter');
                        drawPeak(ctx, w * 0.4, headPeakY, w * 0.2, neckY, '#ef4444', 'Kopf');
                        drawPeak(ctx, w * 0.6, shoulderPeakY * 1.1 , w * 0.15, neckY, '#fca5a5', 'Rechte Schulter (Ansatz)');
                        
                        ctx.beginPath();
                        ctx.moveTo(w * 0.6 + (w*0.15)/2, neckY); 
                        ctx.lineTo(w * 0.65, neckY + h*0.05); 
                        ctx.quadraticCurveTo(w * 0.7, neckY - h*0.05, w * 0.75, shoulderPeakY * 0.9); 
                        ctx.lineTo(w * 0.85, headPeakY * 0.8); 
                        ctx.strokeStyle = '#22c55e'; 
                        ctx.lineWidth = 2.5;
                        ctx.stroke();
                        addTooltipToPath(ctx.getCurrentPath ? ctx.getCurrentPath() : null, 'Fehlausbruch & Bullische Umkehr');

                        drawText(ctx, 'Fehlausbruch!', w * 0.7, neckY + h*0.1, '#22c55e');
                        drawArrow(ctx, w*0.8, headPeakY, w*0.8, headPeakY - h*0.15, '#22c55e', 2, 'Starke bullische Bewegung');
                    }
                },
                {
                    id: 'headAndShouldersBottomFailure',
                    name: 'iSKS-Boden Fehlausbruch',
                    description: 'Ein iSKS-Boden Fehlausbruch tritt auf, wenn ein inverses SKS-Muster sich zu bilden beginnt, der Kurs aber die Nackenlinie nicht nachhaltig nach oben durchbricht und stattdessen wieder unter die rechte Schulter oder sogar den Kopf fällt. Dies kann ein starkes bärisches Signal sein.',
                    characteristics: [
                        'Ansatz eines iSKS-Musters (linke Schulter, Kopf, rechte Schulter).',
                        'Der Kurs scheitert daran, die Nackenlinie signifikant nach oben zu durchbrechen.',
                        'Stattdessen fällt der Kurs wieder ab, oft unter das Niveau der rechten Schulter oder des Kopfes.',
                        'Signalisiert, dass die Käufer nicht stark genug waren, den Trend zu wenden.'
                    ],
                    trading: 'Ein Verkaufssignal entsteht, wenn der Kurs nach dem gescheiterten Bruch der Nackenlinie wieder Schwäche zeigt und unter wichtige Unterstützungsniveaus des unvollendeten iSKS-Musters fällt.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Mittel bis hoch.<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Short-Position, wenn der Kurs unter die rechte Schulter oder den Kopf des gescheiterten iSKS-Musters fällt. SL: Oberhalb der Nackenlinie oder des Hochs der rechten Schulter. TP: Basierend auf vorherigen Unterstützungen oder Fibonacci-Projektionen des vorherigen Abwärtstrends.',
                    advancedConsiderations: 'Achten Sie auf das Volumen: Ein Fehlausbruch mit geringem Volumen beim Versuch, die Nackenlinie zu durchbrechen, und anschließendem Abfall mit höherem Volumen ist ein stärkeres Signal.',
                    performanceStats: 'Analog zum SKS-Top Fehlausbruch, nur in die entgegengesetzte Richtung.',
                    drawFunction: (ctx, w, h) => { 
                        const neckY = h * 0.4;
                        const headTroughY = h * 0.8;
                        const shoulderTroughY = h * 0.65;

                        drawLine(ctx, w * 0.1, neckY, w * 0.7, neckY, '#e5e7eb', 2, 'Nackenlinie (nicht gebrochen)');
                        drawTrough(ctx, w * 0.2, shoulderTroughY, w * 0.15, neckY, '#86efac', 'Linke Schulter');
                        drawTrough(ctx, w * 0.4, headTroughY, w * 0.2, neckY, '#22c55e', 'Kopf');
                        drawTrough(ctx, w * 0.6, shoulderTroughY * 0.9 , w * 0.15, neckY, '#86efac', 'Rechte Schulter (Ansatz)');
                        
                        ctx.beginPath();
                        ctx.moveTo(w * 0.6 + (w*0.15)/2, neckY); 
                        ctx.lineTo(w * 0.65, neckY - h*0.05); 
                        ctx.quadraticCurveTo(w * 0.7, neckY + h*0.05, w * 0.75, shoulderTroughY * 1.1); 
                        ctx.lineTo(w * 0.85, headTroughY * 1.2); 
                        ctx.strokeStyle = '#ef4444'; 
                        ctx.lineWidth = 2.5;
                        ctx.stroke();
                        addTooltipToPath(ctx.getCurrentPath ? ctx.getCurrentPath() : null, 'Fehlausbruch & Bärische Umkehr');

                        drawText(ctx, 'Fehlausbruch!', w * 0.7, neckY - h*0.1, '#ef4444');
                        drawArrow(ctx, w*0.8, headTroughY*1.1, w*0.8, headTroughY*1.1 + h*0.1, '#ef4444', 2, 'Starke bärische Bewegung');
                    }
                },
                {
                    id: 'doubleTop',
                    name: 'Doppeltop',
                    description: 'Ein Doppeltop ist ein bärisches Umkehrmuster, das nach einem signifikanten Aufwärtstrend auftritt. Es besteht aus zwei etwa gleich hohen Hochs mit einem moderaten Tief dazwischen.',
                    characteristics: [ 'Zwei aufeinanderfolgende Hochs auf ähnlichem Niveau.', 'Ein Zwischentief (Unterstützungslinie) zwischen den Hochs.', 'Volumen ist oft beim ersten Hoch höher als beim zweiten.'],
                    trading: 'Ein Verkaufssignal wird generiert, wenn der Kurs unter die Unterstützungslinie (das Zwischentief) fällt. Das Kursziel ist oft die Höhe des Musters (Distanz von den Hochs zur Unterstützungslinie), projiziert nach unten.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Mittel bis hoch, wenn der Bruch der Unterstützungslinie mit Volumen bestätigt wird. Eine höhere Wahrscheinlichkeit besteht, wenn das zweite Hoch das erste nicht übersteigt und ggf. bärische Divergenzen bei Indikatoren auftreten.<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Short-Position nach dem Bruch der Unterstützungslinie. SL: Knapp über der Unterstützungslinie (die nun Widerstand ist) oder über den Hochs. TP: Höhe des Musters vom Ausbruchspunkt nach unten projiziert.',
                    advancedConsiderations: '<strong>Fehlausbrüche:</strong> Ein Fehlausbruch unter die Unterstützungslinie, der schnell wieder darüber schließt, kann eine Falle sein. Ein Ausbruch über die Hochs negiert das Muster.<br><strong>Variationen:</strong> Die Hochs müssen nicht exakt gleich sein; leichte Abweichungen sind normal. Das Zwischentief kann unterschiedlich tief sein.<br><strong>Kontext:</strong> Stärker nach einem langen Aufwärtstrend. Bärische Divergenzen (z.B. im RSI) zwischen den beiden Hochs erhöhen die Aussagekraft.<br><strong>Kombinationen:</strong> Kann Teil einer größeren Verteilungsphase sein.',
                    performanceStats: 'Gilt als zuverlässiges Umkehrmuster. Die Erfolgsrate kann durch Bestätigungssignale wie Volumen oder Divergenzen verbessert werden.',
                    drawFunction: (ctx, w, h) => { 
                        const supportY = h * 0.7; const peakY = h * 0.3;
                        drawLine(ctx, w * 0.1, supportY, w * 0.9, supportY, '#e5e7eb', 2, 'Unterstützungslinie');
                        drawPeak(ctx, w * 0.3, peakY, w * 0.2, supportY, '#fca5a5', 'Erstes Hoch');
                        drawPeak(ctx, w * 0.7, peakY, w * 0.2, supportY, '#fca5a5', 'Zweites Hoch');
                        drawText(ctx, 'Hoch 1', w * 0.3, peakY - 10, '#fde047'); drawText(ctx, 'Hoch 2', w * 0.7, peakY - 10, '#fde047');
                        drawText(ctx, 'Unterstützung', w * 0.5, supportY + 20, '#e5e7eb');
                        drawArrow(ctx, w * 0.6, supportY, w * 0.6, supportY + h*0.2, '#ef4444', 2, 'Ausbruchsrichtung');
                        drawText(ctx, 'Ausbruch', w * 0.6, supportY + h*0.2 + 20, '#ef4444');
                    }
                },
                {
                    id: 'doubleBottom',
                    name: 'Doppelboden',
                    description: 'Ein Doppelboden ist ein bullisches Umkehrmuster, das nach einem signifikanten Abwärtstrend auftritt. Es besteht aus zwei etwa gleich tiefen Tiefs mit einem moderaten Hoch dazwischen.',
                    characteristics: ['Zwei aufeinanderfolgende Tiefs auf ähnlichem Niveau.', 'Ein Zwischenhoch (Widerstandslinie) zwischen den Tiefs.', 'Volumen kann beim zweiten Tief geringer sein und beim Ausbruch ansteigen.'],
                    trading: 'Ein Kaufsignal wird generiert, wenn der Kurs über die Widerstandslinie (das Zwischenhoch) steigt. Das Kursziel ist oft die Höhe des Musters (Distanz von den Tiefs zur Widerstandslinie), projiziert nach oben.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Mittel bis hoch, wenn der Bruch der Widerstandslinie mit Volumen bestätigt wird. Eine höhere Wahrscheinlichkeit besteht, wenn das zweite Tief das erste nicht unterschreitet und ggf. bullische Divergenzen bei Indikatoren auftreten.<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Long-Position nach dem Bruch der Widerstandslinie. SL: Knapp unter der Widerstandslinie (die nun Unterstützung ist) oder unter den Tiefs. TP: Höhe des Musters vom Ausbruchspunkt nach oben projiziert.',
                    advancedConsiderations: '<strong>Fehlausbrüche:</strong> Ein Fehlausbruch über die Widerstandslinie, der schnell wieder darunter schließt, kann eine Falle sein. Ein Bruch unter die Tiefs negiert das Muster.<br><strong>Variationen:</strong> Die Tiefs müssen nicht exakt gleich sein. Das Zwischenhoch kann unterschiedlich hoch sein.<br><strong>Kontext:</strong> Stärker nach einem langen Abwärtstrend. Bullische Divergenzen (z.B. im RSI) zwischen den beiden Tiefs erhöhen die Aussagekraft.<br><strong>Kombinationen:</strong> Kann Teil einer größeren Akkumulationsphase sein.',
                    performanceStats: 'Gilt als zuverlässiges Umkehrmuster. Analog zum Doppeltop, Bestätigungssignale sind wichtig.',
                    drawFunction: (ctx, w, h) => { 
                        const resistanceY = h * 0.3; const troughY = h * 0.7;
                        drawLine(ctx, w * 0.1, resistanceY, w * 0.9, resistanceY, '#e5e7eb', 2, 'Widerstandslinie');
                        drawTrough(ctx, w * 0.3, troughY, w * 0.2, resistanceY, '#86efac', 'Erstes Tief');
                        drawTrough(ctx, w * 0.7, troughY, w * 0.2, resistanceY, '#86efac', 'Zweites Tief');
                        drawText(ctx, 'Tief 1', w * 0.3, troughY + 20, '#fde047'); drawText(ctx, 'Tief 2', w * 0.7, troughY + 20, '#fde047');
                        drawText(ctx, 'Widerstand', w * 0.5, resistanceY - 10, '#e5e7eb');
                        drawArrow(ctx, w * 0.6, resistanceY, w * 0.6, resistanceY - h*0.2, '#22c55e', 2, 'Ausbruchsrichtung');
                        drawText(ctx, 'Ausbruch', w * 0.6, resistanceY - h*0.2 - 15, '#22c55e');
                    }
                },
                {
                    id: 'tripleTop',
                    name: 'Dreifachtop (Triple Top)',
                    description: 'Ein Dreifachtop ist ein bärisches Umkehrmuster, ähnlich dem Doppeltop, aber mit drei Hochs auf etwa gleichem Niveau. Es signalisiert eine stärkere Widerstandszone.',
                    characteristics: [
                        'Drei aufeinanderfolgende Hochs auf ähnlichem Niveau.',
                        'Zwei Zwischentiefs (Unterstützungslinie) zwischen den Hochs.',
                        'Volumen nimmt oft bei jedem folgenden Hoch ab.'
                    ],
                    trading: 'Ein Verkaufssignal wird generiert, wenn der Kurs unter die Unterstützungslinie (gebildet durch die Zwischentiefs) fällt. Das Kursziel ist oft die Höhe des Musters.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Hoch, da es eine stärkere Bestätigung des Widerstands darstellt als ein Doppeltop. Bestätigung durch Volumen beim Bruch ist wichtig.<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Short-Position nach dem Bruch der Unterstützungslinie. SL: Knapp über der Unterstützungslinie oder über den Hochs. TP: Höhe des Musters vom Ausbruchspunkt nach unten projiziert.',
                    advancedConsiderations: '<strong>Kontext:</strong> Ein Triple Top nach einem sehr starken Aufwärtstrend hat eine höhere Aussagekraft. Achten Sie auf Divergenzen bei Indikatoren über die drei Hochs hinweg.',
                    performanceStats: 'Stärker als ein Doppeltop, da der Widerstand dreimal bestätigt wurde. Gute Erfolgsquote bei klarem Bruch.',
                    drawFunction: (ctx, w, h) => { 
                        const supportY = h * 0.7;
                        const peakY = h * 0.3;
                        drawLine(ctx, w * 0.1, supportY, w * 0.9, supportY, '#e5e7eb', 2, 'Unterstützungslinie');
                        drawPeak(ctx, w * 0.2, peakY, w * 0.15, supportY, '#fca5a5', 'Hoch 1');
                        drawPeak(ctx, w * 0.5, peakY, w * 0.15, supportY, '#fca5a5', 'Hoch 2');
                        drawPeak(ctx, w * 0.8, peakY, w * 0.15, supportY, '#fca5a5', 'Hoch 3');
                        drawText(ctx, 'H1', w * 0.2, peakY - 10, '#fde047');
                        drawText(ctx, 'H2', w * 0.5, peakY - 10, '#fde047');
                        drawText(ctx, 'H3', w * 0.8, peakY - 10, '#fde047');
                        drawText(ctx, 'Unterstützung', w * 0.5, supportY + 20, '#e5e7eb');
                        drawArrow(ctx, w * 0.7, supportY, w * 0.7, supportY + h*0.2, '#ef4444', 2, 'Ausbruchsrichtung');
                        drawText(ctx, 'Ausbruch', w * 0.7, supportY + h*0.2 + 20, '#ef4444');
                    }
                },
                {
                    id: 'tripleBottom',
                    name: 'Dreifachboden (Triple Bottom)',
                    description: 'Ein Dreifachboden ist ein bullisches Umkehrmuster, ähnlich dem Doppelboden, aber mit drei Tiefs auf etwa gleichem Niveau. Es signalisiert eine stärkere Unterstützungszone.',
                    characteristics: [
                        'Drei aufeinanderfolgende Tiefs auf ähnlichem Niveau.',
                        'Zwei Zwischenhochs (Widerstandslinie) zwischen den Tiefs.',
                        'Volumen kann beim dritten Tief geringer sein und beim Ausbruch ansteigen.'
                    ],
                    trading: 'Ein Kaufsignal wird generiert, wenn der Kurs über die Widerstandslinie (gebildet durch die Zwischenhochs) steigt. Das Kursziel ist oft die Höhe des Musters.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Hoch, da es eine stärkere Bestätigung der Unterstützung darstellt als ein Doppelboden. Bestätigung durch Volumen beim Bruch ist wichtig.<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Long-Position nach dem Bruch der Widerstandslinie. SL: Knapp unter der Widerstandslinie oder unter den Tiefs. TP: Höhe des Musters vom Ausbruchspunkt nach oben projiziert.',
                    advancedConsiderations: '<strong>Kontext:</strong> Ein Triple Bottom nach einem sehr starken Abwärtstrend hat eine höhere Aussagekraft. Achten Sie auf Divergenzen bei Indikatoren über die drei Tiefs hinweg.',
                    performanceStats: 'Stärker als ein Doppelboden. Gute Erfolgsquote bei klarem Bruch.',
                    drawFunction: (ctx, w, h) => { 
                        const resistanceY = h * 0.3;
                        const troughY = h * 0.7;
                        drawLine(ctx, w * 0.1, resistanceY, w * 0.9, resistanceY, '#e5e7eb', 2, 'Widerstandslinie');
                        drawTrough(ctx, w * 0.2, troughY, w * 0.15, resistanceY, '#86efac', 'Tief 1');
                        drawTrough(ctx, w * 0.5, troughY, w * 0.15, resistanceY, '#86efac', 'Tief 2');
                        drawTrough(ctx, w * 0.8, troughY, w * 0.15, resistanceY, '#86efac', 'Tief 3');
                        drawText(ctx, 'T1', w * 0.2, troughY + 20, '#fde047');
                        drawText(ctx, 'T2', w * 0.5, troughY + 20, '#fde047');
                        drawText(ctx, 'T3', w * 0.8, troughY + 20, '#fde047');
                        drawText(ctx, 'Widerstand', w * 0.5, resistanceY - 10, '#e5e7eb');
                        drawArrow(ctx, w * 0.7, resistanceY, w * 0.7, resistanceY - h*0.2, '#22c55e', 2, 'Ausbruchsrichtung');
                        drawText(ctx, 'Ausbruch', w * 0.7, resistanceY - h*0.2 - 15, '#22c55e');
                    }
                },
                 {
                    id: 'fallingWedge',
                    name: 'Fallender Keil (Falling Wedge)',
                    description: 'Ein fallender Keil ist typischerweise eine bullische Umkehrformation, kann aber auch als Fortsetzungsmuster in einem Aufwärtstrend auftreten. Er wird durch zwei konvergierende, abwärts geneigte Linien gebildet.',
                    characteristics: [
                        'Zwei abwärts geneigte Linien (Widerstand und Unterstützung), die konvergieren.',
                        'Die obere Linie (Widerstand) fällt steiler als die untere Linie (Unterstützung).',
                        'Volumen nimmt oft während der Bildung ab und steigt beim Ausbruch stark an.'
                    ],
                    trading: 'Ein Kaufsignal entsteht, wenn der Kurs über die obere Widerstandslinie ausbricht. Das Kursziel ist oft der breiteste Teil des Keils, projiziert vom Ausbruchspunkt.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Mittel bis hoch, besonders wenn der Ausbruch mit hohem Volumen erfolgt und der Keil sich nach einem Abwärtstrend bildet (Umkehr).<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Long-Position nach dem Ausbruch über die obere Keillinie. SL: Unterhalb des Ausbruchspunktes oder unter dem letzten Tief innerhalb des Keils. TP: Höhe der Basis des Keils, projiziert vom Ausbruchspunkt nach oben.',
                    advancedConsiderations: '<strong>Fehlausbrüche:</strong> Ein Fehlausbruch nach unten, gefolgt von einer schnellen Umkehr und einem Ausbruch nach oben, kann ein besonders starkes Signal sein.<br><strong>Kontext und Interpretation (Dualität):</strong><ul>    <li><strong>Als bullische Umkehrformation (häufiger):</strong><ul><li><em>Vorhergehender Trend:</em> Etablierter Abwärtstrend.</li><li><em>Formation:</em> Zeigt nachlassende Verkaufsdynamik.</li><li><em>Ausbruch:</em> Nach oben aus der oberen Keillinie.</li><li><em>Interpretation:</em> Signalisiert das Ende des Abwärtstrends und den Beginn eines Aufwärtstrends. Am  am Ende eines deutlichen Abwärtstrends.</li></ul></li><li><strong>Als bullische Fortsetzungsformation:</strong><ul><li><em>Vorhergehender Trend:</em> Etablierter Aufwärtstrend.</li><li><em>Formation:</em> Stellt eine Konsolidierungsphase oder einen Pullback innerhalb des Aufwärtstrends dar.</li><li><em>Ausbruch:</em> Nach oben  der oberen Keillinie.</li><li><em>Interpretation:</em> Signalisiert das Ende der Konsolidierung und die Wiederaufnahme des Aufwärtstrends.</li></ul></li></ul>',
                    performanceStats: 'Fallende Keile haben eine relativ hohe Erfolgsquote als bullische Muster, insbesondere wenn sie nach einem Abwärtstrend auftreten.',
                    drawFunction: (ctx, w, h) => { 
                        const startResistanceY = h * 0.2;
                        const endResistanceY = h * 0.6;
                        const startSupportY = h * 0.4;
                        const endSupportY = h * 0.7;
                        const startX = w * 0.1;
                        const endX = w * 0.9;

                        drawLineWithLabel(ctx, w, h, startX, startResistanceY, endX, endResistanceY, '#e5e7eb', 2, 'Widerstand');
                        drawLineWithLabel(ctx, w, h, startX, startSupportY, endX, endSupportY, '#e5e7eb', 2, 'Unterstützung');
                        
                        ctx.beginPath();
                        ctx.moveTo(startX + w*0.05, startResistanceY + h*0.02);
                        ctx.lineTo(startX + w*0.2, startSupportY + h*0.05);
                        ctx.lineTo(startX + w*0.35, (startResistanceY + endResistanceY)/2 * 0.9);
                        ctx.lineTo(startX + w*0.5, (startSupportY + endSupportY)/2 * 1.05);
                        ctx.lineTo(startX + w*0.65, endResistanceY * 0.95);
                        ctx.strokeStyle = '#60a5fa'; ctx.lineWidth = 1.5; ctx.stroke();
                        addTooltipToPath(ctx.getCurrentPath ? ctx.getCurrentPath() : null, 'Simulierte Kursbewegung');

                        drawArrow(ctx, endX * 0.9, endResistanceY, endX * 0.9, endResistanceY - h*0.2, '#22c55e', 2, 'Bullischer Ausbruch');
                        drawText(ctx, 'Ausbruch', endX * 0.9, endResistanceY - h*0.2 - 15, '#22c55e');
                    }
                },
                {
                    id: 'risingWedge',
                    name: 'Steigender Keil (Rising Wedge)',
                    description: 'Ein steigender Keil ist typischerweise eine bärische Umkehrformation, kann aber auch als Fortsetzungsmuster in einem Abwärtstrend auftreten. Er wird durch zwei konvergierende, aufwärts geneigte Linien gebildet.',
                    characteristics: [
                        'Zwei aufwärts geneigte Linien (Widerstand und Unterstützung), die konvergieren.',
                        'Die untere Linie (Unterstützung) steigt steiler als die obere Linie (Widerstand).',
                        'Volumen nimmt oft während der Bildung ab und steigt beim Ausbruch.'
                    ],
                    trading: 'Ein Verkaufssignal entsteht, wenn der Kurs unter die untere Unterstützungslinie ausbricht. Das Kursziel ist oft der breiteste Teil des Keils, projiziert vom Ausbruchspunkt.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Mittel bis hoch, besonders wenn der Ausbruch mit hohem Volumen erfolgt und der Keil sich nach einem Aufwärtstrend bildet (Umkehr).<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Short-Position nach dem Ausbruch unter die untere Keillinie. SL: Oberhalb des Ausbruchspunktes oder über dem letzten Hoch innerhalb des Keils. TP: Höhe der Basis des Keils, projiziert vom Ausbruchspunkt nach unten.',
                    advancedConsiderations: '<strong>Fehlausbrüche:</strong> Ein Fehlausbruch nach oben, gefolgt von einer schnellen Umkehr und einem Ausbruch nach unten, kann ein besonders starkes Signal sein.<br><strong>Kontext und Interpretation (Dualität):</strong><ul><li><strong>Als bärische Umkehrformation (häufiger):</strong><ul><li><em>Vorhergehender Trend:</em> Etablierter Aufwärtstrend.</li><li><em>Formation:</em> Zeigt nachlassende Kaufdynamik, oft mit bärischen Divergenzen bei Indikatoren.</li><li><em>Ausbruch:</em> Nach unten aus der unteren Keillinie.</li><li><em>Interpretation:</em> Signalisiert das Ende des Aufwärtstrends und Beginn eines Abwärtstrends. Am zuverlässigsten am Ende eines deutlichen Aufwärtstrends.</li></ul></li><li><strong>Als bärische Fortsetzungsformation:</strong><ul><li><em>Vorhergehender Trend:</em> Etablierter Abwärtstrend.</li><li><em>Formation:</em> Stellt eine Konsolidierungsphase oder eine korrektive Gegenbewegung Bärenmarktrallye) innerhalb des Abwärtstrends dar.</li><li><em>Ausbruch:</em> Nach unten aus der unteren Keillinie.</li><li><em>Interpretation:</em> Signalisiert das Ende der Gegenbewegung und die Wiederaufnahme des Abwärtstrends.</li></ul></li></ul><strong>Zusätzlich:</strong> Bärische Divergenzen bei Oszillatoren (z.B. RSI, MACD) zwischen den Hochpunkten innerhalb des Keils können die Wahrscheinlichkeit einer bärischen Auflösung (besonders im Umkehrszenario) erhöhen.',
                    performanceStats: 'Steigende Keile haben eine relativ hohe Erfolgsquote als bärische Muster, insbesondere wenn sie nach einem Aufwärtstrend auftreten.',
                    drawFunction: (ctx, w, h) => { 
                        const startSupportY = h * 0.8;
                        const endSupportY = h * 0.4;
                        const startResistanceY = h * 0.6;
                        const endResistanceY = h * 0.3;
                        const startX = w * 0.1;
                        const endX = w * 0.9;

                        drawLineWithLabel(ctx, w, h, startX, startSupportY, endX, endSupportY, '#e5e7eb', 2, 'Unterstützung');
                        drawLineWithLabel(ctx, w, h, startX, startResistanceY, endX, endResistanceY, '#e5e7eb', 2, 'Widerstand');

                        ctx.beginPath();
                        ctx.moveTo(startX + w*0.05, startSupportY - h*0.02);
                        ctx.lineTo(startX + w*0.2, startResistanceY - h*0.05);
                        ctx.lineTo(startX + w*0.35, (startSupportY + endSupportY)/2 * 1.1);
                        ctx.lineTo(startX + w*0.5, (startResistanceY + endResistanceY)/2 * 0.95);
                        ctx.lineTo(startX + w*0.65, endSupportY * 1.05);
                        ctx.strokeStyle = '#f87171'; ctx.lineWidth = 1.5; ctx.stroke();
                        addTooltipToPath(ctx.getCurrentPath ? ctx.getCurrentPath() : null, 'Simulierte Kursbewegung');

                        drawArrow(ctx, endX * 0.9, endSupportY, endX * 0.9, endSupportY + h*0.2, '#ef4444', 2, 'Bärischer Ausbruch');
                        drawText(ctx, 'Ausbruch', endX * 0.9, endSupportY + h*0.2 + 15, '#ef4444');
                    }
                },
                {
                    id: 'diamondTop',
                    name: 'Diamant Top (Diamond Top)',
                    description: 'Ein Diamant Top ist eine seltene, aber zuverlässige bärische Umkehrformation, die nach einem Aufwärtstrend auftritt. Sie ähnelt einer Kombination aus Broadening Top und Symmetrischem Dreieck.',
                    characteristics: [
                        'Tritt nach einem signifikanten Aufwärtstrend auf.',
                        'Beginnt mit auseinanderlaufenden Hochs und Tiefs (Broadening Phase).',
                        'Gefolgt von zusammenlaufenden Hochs und Tiefs (Triangle Phase).',
                        'Die vier Hauptpunkte bilden eine Diamantform.',
                        'Volumen ist oft unregelmäßig und kann beim Ausbruch ansteigen.'
                    ],
                    trading: 'Ein Verkaufssignal entsteht, wenn der Kurs die untere rechte Trendlinie des Diamanten nach unten durchbricht. Das Kursziel wird oft durch Messen der größten vertikalen Distanz innerhalb des Diamanten und Projizieren nach unten vom Ausbruchspunkt bestimmt.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Mittel. Diamantformationen sind seltener und können komplexer zu identifizieren sein. Bestätigung des Ausbruchs ist wichtig.<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Short-Position nach dem Bruch der unteren rechten Trendlinie. SL: Über dem letzten Hoch innerhalb des Diamanten oder über der rechten oberen Spitze. TP: Höhe des Diamanten vom Ausbruchspunkt nach unten projiziert.',
                    advancedConsiderations: '<strong>Volumen:</strong> Das Volumen sollte während der Bildung des Diamanten abnehmen und beim Ausbruch ansteigen.<br><strong>Kontext:</strong> Tritt häufiger in volatilen Märkten auf.',
                    performanceStats: 'Diamantformationen gelten als relativ zuverlässig, sind aber seltener. Die Performance kann gut sein, wenn das Muster klar identifiziert wird und der Ausbruch bestätigt ist.',
                    drawFunction: (ctx, w, h) => { 
                        const midX = w / 2;
                        const midY = h / 2;
                        const diamondWidth = w * 0.6;
                        const diamondHeight = h * 0.5;

                        const p1x = midX - diamondWidth / 2; 
                        const p1y = midY;
                        const p2x = midX; 
                        const p2y = midY - diamondHeight / 2;
                        const p3x = midX + diamondWidth / 2; 
                        const p3y = midY;
                        const p4x = midX; 
                        const p4y = midY + diamondHeight / 2;

                        drawLineWithLabel(ctx, w, h, p1x, p1y, p2x, p2y, '#e5e7eb', 2, 'Obere linke Seite');
                        drawLineWithLabel(ctx, w, h, p2x, p2y, p3x, p3y, '#e5e7eb', 2, 'Obere rechte Seite');
                        drawLineWithLabel(ctx, w, h, p3x, p3y, p4x, p4y, '#e5e7eb', 2, 'Untere rechte Seite');
                        drawLineWithLabel(ctx, w, h, p4x, p4y, p1x, p1y, '#e5e7eb', 2, 'Untere linke Seite');

                        ctx.beginPath();
                        ctx.moveTo(p1x + 10, p1y);
                        ctx.lineTo(midX - diamondWidth * 0.1, p2y + diamondHeight * 0.1);
                        ctx.lineTo(midX + diamondWidth * 0.1, p4y - diamondHeight * 0.1);
                        ctx.lineTo(p3x - 10, p3y);
                        ctx.lineTo(midX, p2y + diamondHeight * 0.3); 
                        ctx.lineTo(midX, p4y - diamondHeight * 0.3);
                        ctx.strokeStyle = '#f87171'; ctx.lineWidth = 1.5; ctx.stroke();
                        addTooltipToPath(ctx.getCurrentPath ? ctx.getCurrentPath() : null, 'Simulierte Kursbewegung');

                        drawArrow(ctx, p3x - w*0.05, p3y + h*0.05, p3x - w*0.05, p3y + h*0.25, '#ef4444', 2, 'Bärischer Ausbruch');
                        drawText(ctx, 'Ausbruch', p3x - w*0.05, p3y + h*0.25 + 15, '#ef4444');
                    }
                },
                {
                    id: 'diamondBottom',
                    name: 'Diamant Bottom (Diamond Bottom)',
                    description: 'Ein Diamant Bottom ist eine seltene, aber zuverlässige bullische Umkehrformation, die nach einem Abwärtstrend auftritt. Sie ist das Spiegelbild des Diamant Top.',
                    characteristics: [
                        'Tritt nach einem signifikanten Abwärtstrend auf.',
                        'Beginnt mit auseinanderlaufenden Tiefs und Hochs (Broadening Phase).',
                        'Gefolgt von zusammenlaufenden Tiefs und Hochs (Triangle Phase).',
                        'Die vier Hauptpunkte bilden eine Diamantform.',
                        'Volumen ist oft unregelmäßig und kann beim Ausbruch ansteigen.'
                    ],
                    trading: 'Ein Kaufsignal entsteht, wenn der Kurs die obere rechte Trendlinie des Diamanten nach oben durchbricht. Das Kursziel wird oft durch Messen der größten vertikalen Distanz innerhalb des Diamanten und Projizieren nach oben vom Ausbruchspunkt bestimmt.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Mittel. Bestätigung des Ausbruchs ist wichtig.<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Long-Position nach dem Bruch der oberen rechten Trendlinie. SL: Unter dem letzten Tief innerhalb des Diamanten oder unter der rechten unteren Spitze. TP: Höhe des Diamanten vom Ausbruchspunkt nach oben projiziert.',
                    advancedConsiderations: '<strong>Volumen:</strong> Ähnlich wie beim Diamant Top, Volumenbestätigung beim Ausbruch ist wichtig.<br><strong>Kontext:</strong> Tritt häufiger in volatilen Märkten auf.',
                    performanceStats: 'Ähnlich wie Diamant Tops, aber für bullische Umkehrungen.',
                    drawFunction: (ctx, w, h) => { 
                        const midX = w / 2;
                        const midY = h / 2;
                        const diamondWidth = w * 0.6;
                        const diamondHeight = h * 0.5;

                        const p1x = midX - diamondWidth / 2; 
                        const p1y = midY;
                        const p2x = midX; 
                        const p2y = midY + diamondHeight / 2;
                        const p3x = midX + diamondWidth / 2; 
                        const p3y = midY;
                        const p4x = midX; 
                        const p4y = midY - diamondHeight / 2;
                        
                        drawLineWithLabel(ctx, w, h, p1x, p1y, p2x, p2y, '#e5e7eb', 2, 'Untere linke Seite');
                        drawLineWithLabel(ctx, w, h, p2x, p2y, p3x, p3y, '#e5e7eb', 2, 'Untere rechte Seite');
                        drawLineWithLabel(ctx, w, h, p3x, p3y, p4x, p4y, '#e5e7eb', 2, 'Obere rechte Seite');
                        drawLineWithLabel(ctx, w, h, p4x, p4y, p1x, p1y, '#e5e7eb', 2, 'Obere linke Seite');

                        ctx.beginPath();
                        ctx.moveTo(p1x + 10, p1y);
                        ctx.lineTo(midX - diamondWidth * 0.1, p2y - diamondHeight * 0.1);
                        ctx.lineTo(midX + diamondWidth * 0.1, p4y + diamondHeight * 0.1);
                        ctx.lineTo(p3x - 10, p3y);
                        ctx.lineTo(midX, p2y - diamondHeight * 0.3);
                        ctx.lineTo(midX, p4y + diamondHeight * 0.3);
                        ctx.strokeStyle = '#60a5fa'; ctx.lineWidth = 1.5; ctx.stroke();
                        addTooltipToPath(ctx.getCurrentPath ? ctx.getCurrentPath() : null, 'Simulierte Kursbewegung');

                        drawArrow(ctx, p3x - w*0.05, p3y - h*0.05, p3x - w*0.05, p3y - h*0.25, '#22c55e', 2, 'Bullischer Ausbruch');
                        drawText(ctx, 'Ausbruch', p3x - w*0.05, p3y - h*0.25 - 15, '#22c55e');
                    }
                },
                {
                    id: 'roundingTop',
                    name: 'Abgerundetes Top (Rounding Top)',
                    description: 'Ein abgerundetes Top ist eine bärische Umkehrformation, die einen allmählichen Übergang von einem Aufwärtstrend zu einem Abwärtstrend darstellt. Es hat eine umgekehrte U-Form.',
                    characteristics: [
                        'Allmähliche, abgerundete Spitze.',
                        'Volumen nimmt oft während der Bildung des Tops ab und kann beim Durchbruch der Unterstützungslinie (falls vorhanden) ansteigen.',
                        'Signalisiert eine nachlassende Kaufkraft und zunehmende Verkaufsbereitschaft.'
                    ],
                    trading: 'Ein Verkaufssignal kann entstehen, wenn der Kurs eine signifikante Unterstützungslinie unterhalb des Tops durchbricht oder wenn der Abwärtstrend nach der Rundung bestätigt wird. Mangels klarer Nackenlinie oft schwieriger zu timen.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Mittel. Das Muster entwickelt sich langsam, was mehr Zeit für Fehlinterpretationen lässt. Bestätigung des Abwärtstrends ist entscheidend.<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Short-Position nach dem Bruch einer identifizierten Unterstützungslinie unterhalb des Tops oder bei Bestätigung des neuen Abwärtstrends. SL: Über dem höchsten Punkt des Tops. TP: Kann basierend auf der Höhe des Tops oder vorherigen Unterstützungsniveaus projiziert werden.',
                    advancedConsiderations: '<strong>Dauer:</strong> Kann sich über Wochen oder Monate entwickeln. Je länger die Formation, desto signifikanter oft die anschließende Bewegung.<br><strong>Volumen:</strong> Typischerweise nimmt das Volumen während der Top-Bildung ab und steigt beim Ausbruch nach unten wieder an.',
                    performanceStats: 'Langfristige Umkehrformation. Die Performance ist oft gut, wenn der Ausbruch bestätigt wird, erfordert aber Geduld.',
                    drawFunction: (ctx, w, h) => { 
                        const topY = h * 0.2;
                        const bottomY = h * 0.7;
                        const controlX1 = w * 0.2;
                        const controlY1 = topY;
                        const controlX2 = w * 0.8;
                        const controlY2 = topY;
                        
                        ctx.beginPath();
                        ctx.moveTo(w * 0.1, bottomY * 0.8); 
                        ctx.bezierCurveTo(controlX1, controlY1, controlX2, controlY2, w * 0.9, bottomY * 0.8); 
                        ctx.strokeStyle = '#f87171'; 
                        ctx.lineWidth = 2.5;
                        ctx.stroke();
                        addTooltipToPath(ctx.getCurrentPath ? ctx.getCurrentPath() : null, 'Abgerundetes Top');

                        drawText(ctx, 'Allmähliche Umkehr', w / 2, topY + h*0.1, '#fde047');
                        const supportLineY = bottomY * 0.8 + h*0.05;
                        drawLine(ctx, w*0.05, supportLineY, w*0.95, supportLineY, '#e0e0e0', 1, 'Mögliche Unterstützung');
                        drawArrow(ctx, w * 0.8, supportLineY, w * 0.8, supportLineY + h*0.15, '#ef4444', 2, 'Ausbruchsrichtung');
                        drawText(ctx, 'Ausbruch', w * 0.8, supportLineY + h*0.15 + 15, '#ef4444');
                    }
                },
                {
                    id: 'roundingBottom',
                    name: 'Abgerundeter Boden (Rounding Bottom)',
                    description: 'Ein abgerundeter Boden (auch Saucer Bottom) ist eine bullische Umkehrformation, die einen allmählichen Übergang von einem Abwärtstrend zu einem Aufwärtstrend darstellt. Es hat eine U-Form.',
                    characteristics: [
                        'Allmählicher, abgerundeter Boden.',
                        'Volumen nimmt oft während der Bildung des Bodens ab und steigt beim Durchbruch der Widerstandslinie (falls vorhanden) oder bei Beginn des Aufwärtstrends stark an.',
                        'Signalisiert eine nachlassende Verkaufsbereitschaft und zunehmende Kaufkraft.'
                    ],
                    trading: 'Ein Kaufsignal kann entstehen, wenn der Kurs eine signifikante Widerstandslinie oberhalb des Bodens durchbricht oder wenn der Aufwärtstrend nach der Rundung bestätigt wird. Das Kursziel wird oft als die Tiefe des Bodens, addiert zum Ausbruchspunkt, berechnet.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Mittel. Ähnlich dem Rounding Top, Bestätigung des Aufwärtstrends ist entscheidend.<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Long-Position nach dem Bruch einer identifizierten Widerstandslinie oberhalb des Bodens oder bei Bestätigung des neuen Aufwärtstrends. SL: Unter dem tiefsten Punkt des Bodens. TP: Höhe des Bodens vom Ausbruchspunkt nach oben projiziert oder nächste signifikante Widerstandsniveaus.',
                    advancedConsiderations: '<strong>Dauer:</strong> Ähnlich wie Rounding Tops, oft langfristige Formationen.<br><strong>Volumen:</strong> Das Volumen ist oft am Tiefpunkt am geringsten und steigt bei der Aufwärtsbewegung und dem Ausbruch an.',
                    performanceStats: 'Langfristige Umkehrformation. Die Performance ist oft gut, wenn der Ausbruch bestätigt wird, erfordert aber Geduld.',
                    drawFunction: (ctx, w, h) => { 
                        const bottomY = h * 0.8;
                        const topY = h * 0.3;
                        const controlX1 = w * 0.2;
                        const controlY1 = bottomY;
                        const controlX2 = w * 0.8;
                        const controlY2 = bottomY;

                        ctx.beginPath();
                        ctx.moveTo(w * 0.1, topY / 0.8); 
                        ctx.bezierCurveTo(controlX1, controlY1, controlX2, controlY2, w * 0.9, topY / 0.8); 
                        ctx.strokeStyle = '#60a5fa'; 
                        ctx.lineWidth = 2.5;
                        ctx.stroke();
                        addTooltipToPath(ctx.getCurrentPath ? ctx.getCurrentPath() : null, 'Abgerundeter Boden');

                        drawText(ctx, 'Allmähliche Umkehr', w / 2, bottomY - h*0.1, '#fde047');
                        const resistanceLineY = topY / 0.8 - h*0.05;
                        drawLine(ctx, w*0.05, resistanceLineY, w*0.95, resistanceLineY, '#e0e0e0', 1, 'Möglicher Widerstand');
                        drawArrow(ctx, w * 0.8, resistanceLineY, w * 0.8, resistanceLineY - h*0.15, '#22c55e', 2, 'Ausbruchsrichtung');
                        drawText(ctx, 'Ausbruch', w * 0.8, resistanceLineY - h*0.15 - 15, '#22c55e');
                    }
                },
                {
                    id: 'broadeningTop',
                    name: 'Megafon Top (Broadening Top)',
                    description: 'Ein Broadening Top (auch Megafon Top) ist eine bärische Umkehrformation, die durch zunehmende Volatilität gekennzeichnet ist. Es besteht aus drei ansteigenden Hochs und zwei fallenden Tiefs, wobei die Trendlinien auseinanderlaufen.',
                    characteristics: [
                        'Zwei auseinanderlaufende Trendlinien: obere steigt, untere fällt.',
                        'Mindestens drei höhere Hochs und zwei tiefere Tiefs.',
                        'Signalisiert zunehmende Unsicherheit und Volatilität, oft am Ende eines Aufwärtstrends.',
                        'Volumen kann unregelmäßig sein.'
                    ],
                    trading: 'Ein Verkaufssignal kann entstehen, wenn der Kurs nach dem dritten Hoch unter die untere Trendlinie fällt oder eine wichtige Unterstützung durchbricht. Aufgrund der hohen Volatilität schwer zu handeln.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Mittel, da die hohe Volatilität zu Fehlsignalen führen kann. Der Bruch der unteren Trendlinie nach dem dritten Hoch ist das Hauptsignal.<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Short-Position nach dem Bruch der unteren Trendlinie (nach dem 3. Hoch). SL: Über dem dritten Hoch. TP: Die Höhe der Formation (größte vertikale Distanz zwischen den Trendlinien) vom Ausbruchspunkt nach unten projiziert.',
                    advancedConsiderations: '<strong>Volatilität:</strong> Dieses Muster ist per Definition volatil und kann zu schnellen, unvorhersehbaren Bewegungen führen. Erhöhtes Risiko.<br><strong>Fehlausbrüche:</strong> Fehlausbrüche über die obere Linie sind möglich, bevor die eigentliche Umkehr stattfindet.',
                    performanceStats: 'Diese Muster sind oft volatil und schwer zu handeln. Die Erfolgsquote kann geringer sein als bei konvergierenden Mustern.',
                    drawFunction: (ctx, w, h) => { 
                        const upperStartX = w * 0.1, upperStartY = h * 0.4;
                        const upperEndX = w * 0.9, upperEndY = h * 0.1;
                        const lowerStartX = w * 0.15, lowerStartY = h * 0.6;
                        const lowerEndX = w * 0.85, lowerEndY = h * 0.9;

                        drawLineWithLabel(ctx, w,h, upperStartX, upperStartY, upperEndX, upperEndY, '#e5e7eb', 2, 'Steigender Widerstand');
                        drawLineWithLabel(ctx, w,h, lowerStartX, lowerStartY, lowerEndX, lowerEndY, '#e5e7eb', 2, 'Fallende Unterstützung');

                        ctx.beginPath();
                        ctx.moveTo(w * 0.2, h * 0.55); 
                        ctx.lineTo(w * 0.3, h * 0.35); 
                        ctx.lineTo(w * 0.4, h * 0.65); 
                        ctx.lineTo(w * 0.55, h * 0.25); 
                        ctx.lineTo(w * 0.65, h * 0.75); 
                        ctx.lineTo(w * 0.8, h * 0.15); 
                        ctx.strokeStyle = '#f87171'; ctx.lineWidth = 1.5; ctx.stroke();
                        addTooltipToPath(ctx.getCurrentPath ? ctx.getCurrentPath() : null, 'Simulierte Kursbewegung');
                        
                        drawArrow(ctx, w*0.7, lowerEndY * 0.95, w*0.7, lowerEndY + h*0.05, '#ef4444', 2, 'Bärischer Ausbruch');
                        drawText(ctx, 'Ausbruch', w*0.7, lowerEndY + h*0.05 + 15, '#ef4444');
                    }
                },
                {
                    id: 'broadeningBottom',
                    name: 'Megafon Bottom (Broadening Bottom)',
                    description: 'Ein Broadening Bottom (auch Megafon Bottom oder Inverted Broadening Formation) ist eine bullische Umkehrformation, die durch zunehmende Volatilität gekennzeichnet ist. Es besteht aus drei fallenden Tiefs und zwei steigenden Hochs, wobei die Trendlinien auseinanderlaufen.',
                    characteristics: [
                        'Zwei auseinanderlaufende Trendlinien: obere steigt, untere fällt.',
                        'Mindestens drei tiefere Tiefs und zwei höhere Hochs.',
                        'Signalisiert zunehmende Unsicherheit und Volatilität, oft am Ende eines Abwärtstrends.',
                        'Volumen kann unregelmäßig sein.'
                    ],
                    trading: 'Ein Kaufsignal kann entstehen, wenn der Kurs nach dem dritten Tief über die obere Trendlinie steigt oder einen wichtigen Widerstand durchbricht. Aufgrund der hohen Volatilität schwer zu handeln.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Mittel. Der Bruch der oberen Trendlinie nach dem dritten Tief ist das Hauptsignal.<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Long-Position nach dem Bruch der oberen Trendlinie (nach dem 3. Tief). SL: Unter dem dritten Tief. TP: Die Höhe der Formation vom Ausbruchspunkt nach oben projiziert.',
                    advancedConsiderations: '<strong>Volatilität:</strong> Wie beim Broadening Top, hohe Volatilität und Risiko.<br><strong>Fehlausbrüche:</strong> Fehlausbrüche unter die untere Linie sind möglich.',
                    performanceStats: 'Ähnlich wie Broadening Tops, oft volatil.',
                    drawFunction: (ctx, w, h) => { 
                        const upperStartX = w * 0.15, upperStartY = h * 0.4;
                        const upperEndX = w * 0.85, upperEndY = h * 0.1;
                        const lowerStartX = w * 0.1, lowerStartY = h * 0.6;
                        const lowerEndX = w * 0.9, lowerEndY = h * 0.9;
                        
                        drawLineWithLabel(ctx, w,h, upperStartX, upperStartY, upperEndX, upperEndY, '#e5e7eb', 2, 'Steigender Widerstand');
                        drawLineWithLabel(ctx, w,h, lowerStartX, lowerStartY, lowerEndX, lowerEndY, '#e5e7eb', 2, 'Fallende Unterstützung');

                        ctx.beginPath();
                        ctx.moveTo(w * 0.2, h * 0.45); 
                        ctx.lineTo(w * 0.3, h * 0.65); 
                        ctx.lineTo(w * 0.4, h * 0.35); 
                        ctx.lineTo(w * 0.55, h * 0.75); 
                        ctx.lineTo(w * 0.65, h * 0.25); 
                        ctx.lineTo(w * 0.8, h * 0.85); 
                        ctx.strokeStyle = '#60a5fa'; ctx.lineWidth = 1.5; ctx.stroke();
                        addTooltipToPath(ctx.getCurrentPath ? ctx.getCurrentPath() : null, 'Simulierte Kursbewegung');

                        drawArrow(ctx, w*0.7, upperEndY * 1.1, w*0.7, upperEndY - h*0.05, '#22c55e', 2, 'Bullischer Ausbruch');
                        drawText(ctx, 'Ausbruch', w*0.7, upperEndY - h*0.05 - 15, '#22c55e');
                    }
                },
                {
                    id: 'islandReversal',
                    name: 'Umkehrinsel (Island Reversal)',
                    description: 'Eine Umkehrinsel ist eine starke Umkehrformation, die durch eine Kurslücke (Gap), eine Konsolidierungsphase und eine weitere Kurslücke in die entgegengesetzte Richtung gekennzeichnet ist. Die Konsolidierungsphase erscheint wie eine "Insel" im Chart.',
                    characteristics: [
                        'Ein Gap in Trendrichtung.',
                        'Eine Periode der Konsolidierung (die "Insel").',
                        'Ein Gap in die entgegengesetzte Richtung, das die Insel isoliert.',
                        'Signalisiert eine scharfe und oft emotionale Umkehr.'
                    ],
                    trading: 'Ein bärisches Island Reversal (Top) entsteht nach einem Aufwärtstrend mit einem Gap nach oben, Konsolidierung, dann Gap nach unten. Ein bullisches Island Reversal (Bottom) ist das Spiegelbild. Der Handel erfolgt oft nach dem zweiten Gap.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Hoch, da es ein starkes Umkehrsignal ist, wenn beide Gaps klar definiert sind.<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Nach dem zweiten Gap in die neue Richtung. Bei bullischer Insel: Long. Bei bärischer Insel: Short. SL: Auf der anderen Seite der Insel (jenseits des zweiten Gaps). TP: Oft signifikant, da es eine starke Umkehr anzeigt; kann basierend auf vorherigen Preisniveaus oder einem Vielfachen des Risikos gesetzt werden.',
                    advancedConsiderations: '<strong>Volumen:</strong> Das Volumen kann während der Inselbildung gering sein und bei den Gaps ansteigen. Ein hohes Volumen beim zweiten Gap (in die neue Richtung) verstärkt das Signal.',
                    performanceStats: 'Island Reversals gelten als starke und zuverlässige Umkehrsignale, sind aber relativ selten.',
                    drawFunction: (ctx, w, h) => { 
                        // Bullisches Island Reversal (Bottom)
                        const islandWidth = w * 0.2;
                        const islandHeight = h * 0.15;
                        const islandY = h * 0.65;
                        const islandStartX = w * 0.4;
                        
                        // Abwärtstrend
                        drawLine(ctx, w*0.1, h*0.2, islandStartX - w*0.05, islandY + islandHeight + h*0.05, '#f87171', 2, 'Vorheriger Trend');
                        // Gap 1 (Exhaustion Gap)
                        drawText(ctx, 'Gap 1', islandStartX - w*0.025, islandY + islandHeight + h*0.02, '#fde047', '10px');

                        // Insel (Konsolidierung)
                        ctx.beginPath();
                        ctx.rect(islandStartX, islandY, islandWidth, islandHeight);
                        ctx.fillStyle = '#374151AA'; // Leicht transparente Füllung für Insel
                        ctx.fill();
                        ctx.strokeStyle = '#a3e635'; // Grüne Umrandung für bullische Insel
                        ctx.stroke();
                        addTooltipToPath(ctx.getCurrentPath ? ctx.getCurrentPath() : null, 'Insel-Konsolidierung');
                        drawText(ctx, 'Insel', islandStartX + islandWidth/2, islandY + islandHeight/2, '#a3e635');

                        // Gap 2 (Breakaway Gap)
                        drawText(ctx, 'Gap 2', islandStartX + islandWidth + w*0.025, islandY - h*0.02, '#fde047', '10px');
                        // Aufwärtstrend
                        drawLine(ctx, islandStartX + islandWidth + w*0.05, islandY - h*0.05, w*0.9, h*0.2, '#22c55e', 2, 'Neuer Trend');
                        
                        drawArrow(ctx, islandStartX + islandWidth + w*0.05, islandY - h*0.05, islandStartX + islandWidth + w*0.05, islandY - h*0.2, '#22c55e', 2, 'Bullische Umkehr');
                    }
                },
                {
                    id: 'pipeBottom',
                    name: 'Pfeifenboden (Pipe Bottom)',
                    description: 'Ein Pfeifenboden ist eine bullische Umkehrformation, die durch zwei lange, parallele oder leicht konvergierende Abwärtskerzen (die "Pfeifen") mit tiefen Tiefs gekennzeichnet ist, gefolgt von einer starken Aufwärtsbewegung.',
                    characteristics: [
                        'Tritt nach einem Abwärtstrend auf.',
                        'Zwei lange bärische Kerzen (Pfeifen) mit ähnlichen oder tieferen Tiefs.',
                        'Die Körper der Pfeifen sind oft lang, die Schatten können variieren.',
                        'Signalisiert eine Kapitulation der Verkäufer, gefolgt von starkem Kaufinteresse.'
                    ],
                    trading: 'Ein Kaufsignal entsteht, wenn der Kurs nach den beiden Pfeifen deutlich ansteigt, idealerweise über das Hoch der zweiten Pfeife. Oft ein sehr schnelles Muster.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Mittel bis hoch. Das Muster zeigt eine starke Ablehnung tieferer Preise.<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Long-Position, wenn der Kurs nach den Pfeifen eine starke bullische Kerze bildet und idealerweise über das Hoch der Pfeifen steigt. SL: Unter den Tiefs der Pfeifen. TP: Basierend auf der Stärke der Umkehrbewegung, oft ein Vielfaches des Risikos oder nächste Widerstandsniveaus.',
                    advancedConsiderations: '<strong>Volumen:</strong> Ein Anstieg des Volumens bei der bullischen Umkehrkerze nach den Pipes verstärkt das Signal.<br><strong>Kerzenformation:</strong> Die "Pfeifen" sind im Wesentlichen lange bärische Kerzen. Die Umkehr wird oft durch eine nachfolgende starke bullische Kerze (z.B. Engulfing) bestätigt.',
                    performanceStats: 'Pipe Bottoms sind relativ seltene, aber oft starke Umkehrsignale, besonders wenn sie nach einem ausgedehnten Abwärtstrend auftreten.',
                    drawFunction: (ctx, w, h) => { 
                        const pipeWidth = w * 0.08;
                        const pipeBodyHeight = h * 0.3;
                        const pipeShadowHeight = h * 0.1;
                        const pipe1X = w * 0.35;
                        const pipe2X = w * 0.5;
                        const trendStartY = h * 0.2;
                        const pipeTopY = h * 0.4;

                        // Abwärtstrend davor
                        drawLine(ctx, w*0.1, trendStartY, pipe1X - pipeWidth, pipeTopY*0.9, '#f87171', 2, 'Vorheriger Trend');

                        // Pfeife 1 (bärisch)
                        ctx.fillStyle = '#ef4444'; // Rot
                        ctx.fillRect(pipe1X, pipeTopY, pipeWidth, pipeBodyHeight); // Körper
                        drawLine(ctx, pipe1X + pipeWidth/2, pipeTopY + pipeBodyHeight, pipe1X + pipeWidth/2, pipeTopY + pipeBodyHeight + pipeShadowHeight, '#ef4444', 2, 'Pfeife 1 Tief');
                        addTooltipToPath(null, 'Pfeife 1'); // Dummy für Bereich

                        // Pfeife 2 (bärisch)
                        ctx.fillRect(pipe2X, pipeTopY + h*0.02, pipeWidth, pipeBodyHeight); // Körper etwas tiefer
                        drawLine(ctx, pipe2X + pipeWidth/2, pipeTopY + h*0.02 + pipeBodyHeight, pipe2X + pipeWidth/2, pipeTopY + h*0.02 + pipeBodyHeight + pipeShadowHeight, '#ef4444', 2, 'Pfeife 2 Tief');
                        addTooltipToPath(null, 'Pfeife 2');

                        drawText(ctx, 'Pfeifen', (pipe1X+pipe2X+pipeWidth)/2, pipeTopY - 15, '#fde047');

                        // Starke Aufwärtsbewegung danach
                        const reversalStartX = pipe2X + pipeWidth * 1.5;
                        const reversalStartY = pipeTopY + pipeBodyHeight / 2;
                        drawArrow(ctx, reversalStartX, reversalStartY, reversalStartX + w*0.15, reversalStartY - h*0.3, '#22c55e', 3, 'Bullische Umkehr');
                        drawText(ctx, 'Starke Umkehr', reversalStartX + w*0.07, reversalStartY - h*0.3 - 15, '#22c55e');
                    }
                },
                {
                    id: 'pipeTop',
                    name: 'Pfeifenspitze (Pipe Top)',
                    description: 'Eine Pfeifenspitze ist eine bärische Umkehrformation, das Spiegelbild des Pfeifenbodens. Sie wird durch zwei lange, parallele oder leicht konvergierende Aufwärtskerzen (die "Pfeifen") mit hohen Hochs gekennzeichnet, gefolgt von einer starken Abwärtsbewegung.',
                    characteristics: [
                        'Tritt nach einem Aufwärtstrend auf.',
                        'Zwei lange bullische Kerzen (Pfeifen) mit ähnlichen oder höheren Hochs.',
                        'Die Körper der Pfeifen sind oft lang, die Schatten können variieren.',
                        'Signalisiert eine Erschöpfung der Käufer, gefolgt von starkem Verkaufsinteresse.'
                    ],
                    trading: 'Ein Verkaufssignal entsteht, wenn der Kurs nach den beiden Pfeifen deutlich fällt, idealerweise unter das Tief der zweiten Pfeife. Oft ein sehr schnelles Muster.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Mittel bis hoch.<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Short-Position, wenn der Kurs nach den Pfeifen eine starke bärische Kerze bildet und idealerweise unter das Tief der Pfeifen fällt. SL: Über den Hochs der Pfeifen. TP: Basierend auf der Stärke der Umkehrbewegung, oft ein Vielfaches des Risikos oder nächste Unterstützungsniveaus.',
                    advancedConsiderations: '<strong>Volumen:</strong> Ein Anstieg des Volumens bei der bärischen Umkehrkerze nach den Pipes verstärkt das Signal.<br><strong>Kerzenformation:</strong> Die "Pfeifen" sind im Wesentlichen lange bullische Kerzen. Die Umkehr wird oft durch eine nachfolgende starke bärische Kerze (z.B. Engulfing) bestätigt.',
                    performanceStats: 'Ähnlich wie Pipe Bottoms, aber für bärische Umkehrungen.',
                    drawFunction: (ctx, w, h) => { 
                        const pipeWidth = w * 0.08;
                        const pipeBodyHeight = h * 0.3;
                        const pipeShadowHeight = h * 0.1;
                        const pipe1X = w * 0.35;
                        const pipe2X = w * 0.5;
                        const trendStartY = h * 0.8;
                        const pipeBottomY = h * 0.3; // Umgekehrte Y-Achse

                        // Aufwärtstrend davor
                        drawLine(ctx, w*0.1, trendStartY, pipe1X - pipeWidth, pipeBottomY + pipeBodyHeight*1.1, '#22c55e', 2, 'Vorheriger Trend');

                        // Pfeife 1 (bullisch)
                        ctx.fillStyle = '#22c55e'; // Grün
                        ctx.fillRect(pipe1X, pipeBottomY, pipeWidth, pipeBodyHeight); // Körper
                        drawLine(ctx, pipe1X + pipeWidth/2, pipeBottomY, pipe1X + pipeWidth/2, pipeBottomY - pipeShadowHeight, '#22c55e', 2, 'Pfeife 1 Hoch');
                        addTooltipToPath(null, 'Pfeife 1');

                        // Pfeife 2 (bullisch)
                        ctx.fillRect(pipe2X, pipeBottomY - h*0.02, pipeWidth, pipeBodyHeight); // Körper etwas höher
                        drawLine(ctx, pipe2X + pipeWidth/2, pipeBottomY - h*0.02, pipe2X + pipeWidth/2, pipeBottomY - h*0.02 - pipeShadowHeight, '#22c55e', 2, 'Pfeife 2 Hoch');
                        addTooltipToPath(null, 'Pfeife 2');

                        drawText(ctx, 'Pfeifen', (pipe1X+pipe2X+pipeWidth)/2, pipeBottomY + pipeBodyHeight + 15, '#fde047');

                        // Starke Abwärtsbewegung danach
                        const reversalStartX = pipe2X + pipeWidth * 1.5;
                        const reversalStartY = pipeBottomY + pipeBodyHeight / 2;
                        drawArrow(ctx, reversalStartX, reversalStartY, reversalStartX + w*0.15, reversalStartY + h*0.3, '#ef4444', 3, 'Bärische Umkehr');
                        drawText(ctx, 'Starke Umkehr', reversalStartX + w*0.07, reversalStartY + h*0.3 + 15, '#ef4444');
                    }
                },
                {
                    id: 'bumpAndRunReversalTop',
                    name: 'Bump and Run Reversal Top (BARR Top)',
                    description: 'Das Bump and Run Reversal Top ist eine bärische Umkehrformation. Sie beginnt mit einem moderaten Aufwärtstrend (Lead-in), gefolgt von einem steilen, exzessiven Anstieg (Bump), der die ursprüngliche Trendlinie durchbricht. Nach dem Scheitern des Bumps fällt der Kurs oft stark, durchbricht die ursprüngliche Trendlinie und setzt den Abwärtstrend fort (Run).',
                    characteristics: [
                        'Lead-in Phase: Moderater Aufwärtstrend.',
                        'Bump Phase: Übermäßig steiler Anstieg, der die Lead-in Trendlinie durchbricht.',
                        'Run Phase: Nach dem Scheitern des Bumps fällt der Kurs unter die Lead-in Trendlinie.',
                        'Die Lead-in Trendlinie wird zum Widerstand.'
                    ],
                    trading: 'Ein Verkaufssignal kann entstehen, wenn der Kurs nach dem Bump die Lead-in Trendlinie nach unten durchbricht. Das Volumen kann im Bump-Teil hoch sein und beim Durchbruch der Trendlinie wieder ansteigen.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Mittel. Das Muster kann subjektiv sein und der "Bump" schwer zu definieren. Der Bruch der Lead-in-Trendlinie ist das Schlüsselsignal.<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Short-Position nach dem Bruch der Lead-in-Trendlinie nach unten, nachdem der Bump gescheitert ist. SL: Über dem Hoch des Bumps. TP: Kann signifikant sein, oft basierend auf der Höhe des Bumps oder vorherigen Unterstützungsniveaus.',
                    advancedConsiderations: '<strong>Trendlinienwinkel:</strong> Die Lead-in-Trendlinie sollte moderat geneigt sein (ca. 30-45 Grad). Die Bump-Phase ist deutlich steiler.<br><strong>Volumen:</strong> Das Volumen sollte während des Bumps zunehmen und beim Durchbruch der Lead-in-Trendlinie (Run-Phase) ebenfalls erhöht sein.',
                    performanceStats: 'BARR-Muster können starke Bewegungen signalisieren, sind aber aufgrund ihrer subjektiven Natur (Definition des "Bumps") schwieriger zu quantifizieren.',
                    drawFunction: (ctx, w, h) => { 
                        // Lead-in Trendlinie
                        const leadInStartX = w * 0.1, leadInStartY = h * 0.8;
                        const leadInEndX = w * 0.5, leadInEndY = h * 0.5;
                        drawLineWithLabel(ctx, w, h, leadInStartX, leadInStartY, leadInEndX, leadInEndY, '#e5e7eb', 2, 'Lead-in Trend');

                        // Bump Phase
                        const bumpStartX = leadInEndX - w*0.05, bumpStartY = leadInEndY - h*0.05;
                        const bumpPeakX = w * 0.65, bumpPeakY = h * 0.15;
                        const bumpEndX = w * 0.75, bumpEndY = h * 0.6; // Fällt unter Trendlinie

                        ctx.beginPath();
                        ctx.moveTo(bumpStartX, bumpStartY);
                        ctx.quadraticCurveTo(bumpPeakX - w*0.05, bumpPeakY*0.8, bumpPeakX, bumpPeakY); // Steiler Anstieg
                        ctx.quadraticCurveTo(bumpPeakX + w*0.05, bumpPeakY*1.2, bumpEndX, bumpEndY); // Abfall
                        ctx.strokeStyle = '#f87171'; ctx.lineWidth = 2; ctx.stroke();
                        addTooltipToPath(ctx.getCurrentPath ? ctx.getCurrentPath() : null, 'Bump Phase');
                        drawText(ctx, 'Bump', bumpPeakX, bumpPeakY - 15, '#f87171');

                        // Run Phase
                        drawArrow(ctx, bumpEndX, bumpEndY, bumpEndX + w*0.1, bumpEndY + h*0.2, '#ef4444', 2, 'Run Phase (Ausbruch)');
                        drawText(ctx, 'Run', bumpEndX + w*0.05, bumpEndY + h*0.2 + 15, '#ef4444');
                    }
                },
                {
                    id: 'bumpAndRunReversalBottom',
                    name: 'Bump and Run Reversal Bottom (BARR Bottom)',
                    description: 'Das Bump and Run Reversal Bottom ist eine bullische Umkehrformation, das Spiegelbild des BARR Top. Es beginnt mit einem moderaten Abwärtstrend (Lead-in), gefolgt von einem steilen, exzessiven Abfall (Bump), der die ursprüngliche Trendlinie durchbricht. Nach dem Scheitern des Bumps steigt der Kurs oft stark, durchbricht die ursprüngliche Trendlinie und setzt den Aufwärtstrend fort (Run).',
                    characteristics: [
                        'Lead-in Phase: Moderater Abwärtstrend.',
                        'Bump Phase: Übermäßig steiler Abfall, der die Lead-in Trendlinie durchbricht.',
                        'Run Phase: Nach dem Scheitern des Bumps steigt der Kurs über die Lead-in Trendlinie.',
                        'Die Lead-in Trendlinie wird zur Unterstützung.'
                    ],
                    trading: 'Ein Kaufsignal kann entstehen, wenn der Kurs nach dem Bump die Lead-in Trendlinie nach oben durchbricht. Das Volumen kann im Bump-Teil hoch sein und beim Durchbruch der Trendlinie wieder ansteigen.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Mittel.<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Long-Position nach dem Bruch der Lead-in-Trendlinie nach oben, nachdem der Bump gescheitert ist. SL: Unter dem Tief des Bumps. TP: Kann signifikant sein, oft basierend auf der Höhe des Bumps oder vorherigen Widerstandsniveaus.',
                    advancedConsiderations: '<strong>Trendlinienwinkel:</strong> Analog zum BARR Top, aber für Abwärtstrends.<br><strong>Volumen:</strong> Ähnliche Volumenmuster wie beim BARR Top sind wünschenswert.',
                    performanceStats: 'Ähnlich wie BARR Tops.',
                    drawFunction: (ctx, w, h) => { 
                        const leadInStartX = w * 0.1, leadInStartY = h * 0.2;
                        const leadInEndX = w * 0.5, leadInEndY = h * 0.5;
                        drawLineWithLabel(ctx, w, h, leadInStartX, leadInStartY, leadInEndX, leadInEndY, '#e5e7eb', 2, 'Lead-in Trend');
                        
                        const bumpStartX = leadInEndX - w*0.05, bumpStartY = leadInEndY + h*0.05;
                        const bumpTroughX = w * 0.65, bumpTroughY = h * 0.85;
                        const bumpEndX = w * 0.75, bumpEndY = h * 0.4; // Steigt über Trendlinie

                        ctx.beginPath();
                        ctx.moveTo(bumpStartX, bumpStartY);
                        ctx.quadraticCurveTo(bumpTroughX - w*0.05, bumpTroughY*1.2, bumpTroughX, bumpTroughY); // Steiler Abfall
                        ctx.quadraticCurveTo(bumpTroughX + w*0.05, bumpTroughY*0.8, bumpEndX, bumpEndY); // Anstieg
                        ctx.strokeStyle = '#60a5fa'; ctx.lineWidth = 2; ctx.stroke();
                        addTooltipToPath(ctx.getCurrentPath ? ctx.getCurrentPath() : null, 'Bump Phase');
                        drawText(ctx, 'Bump', bumpTroughX, bumpTroughY + 15, '#60a5fa');

                        drawArrow(ctx, bumpEndX, bumpEndY, bumpEndX + w*0.1, bumpEndY - h*0.2, '#22c55e', 2, 'Run Phase (Ausbruch)');
                        drawText(ctx, 'Run', bumpEndX + w*0.05, bumpEndY - h*0.2 - 15, '#22c55e');
                    }
                },
                {
                    id: 'spikeTop',
                    name: 'Spike Top (V-Top / Nadelspitze Oben)',
                    description: 'Ein Spike Top (auch V-Top oder Nadelspitze Oben) ist eine scharfe, schnelle Umkehrformation. Der Kurs steigt steil an und fällt dann ebenso schnell wieder ab, oft ohne signifikante Konsolidierung an der Spitze.',
                    characteristics: [
                        'Sehr schneller, oft fast senkrechter Anstieg.',
                        'Eine scharfe Spitze (Spike).',
                        'Sehr schneller, oft fast senkrechter Abfall.',
                        'Hohes Volumen kann an der Spitze auftreten, signalisiert Erschöpfung.',
                        'Schwierig vorherzusagen, da die Umkehr sehr abrupt erfolgt.'
                    ],
                    trading: 'Aufgrund der Schnelligkeit schwer zu handeln. Bestätigungssignale (z.B. Bruch einer kurzfristigen Unterstützung) sind wichtig. Oft ein Zeichen starker Volatilität und emotionaler Marktphasen.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Mittel bis gering, da das Timing extrem schwierig ist. Die Umkehr ist oft sehr schnell.<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Short-Position nach Bestätigung der Umkehr, z.B. wenn eine signifikante bärische Kerze nach dem Spike entsteht oder eine kurzfristige Unterstützung bricht. SL: Über dem Hoch des Spikes. TP: Kann auf Basis vorheriger Unterstützungsniveaus oder eines Vielfachen des Risikos festgelegt werden.',
                    advancedConsiderations: '<strong>Nachrichtenereignisse:</strong> Spikes treten oft im Zusammenhang mit wichtigen Nachrichten oder Ereignissen auf, die eine plötzliche Neubewertung des Marktes verursachen.',
                    performanceStats: 'Spikes sind oft schwer zu handeln, da sie schnell und ohne klare Konsolidierung auftreten. Die Erfolgsquote ist stark vom Timing und der Bestätigung abhängig.',
                    drawFunction: (ctx, w, h) => { 
                        const startX = w * 0.2, startY = h * 0.8;
                        const peakX = w * 0.5, peakY = h * 0.1;
                        const endX = w * 0.8, endY = h * 0.8;

                        drawLineWithLabel(ctx, w, h, startX, startY, peakX, peakY, '#f87171', 2.5, 'Steiler Anstieg');
                        drawLineWithLabel(ctx, w, h, peakX, peakY, endX, endY, '#ef4444', 2.5, 'Steiler Abfall');
                        drawText(ctx, 'Spike / V-Top', peakX, peakY - 15, '#fde047');
                        
                        // Andeutung einer gebrochenen Unterstützung
                        const supportBreakY = h*0.65;
                        drawLine(ctx, peakX - w*0.15, supportBreakY, peakX + w*0.15, supportBreakY, '#e0e0e0', 1, 'Kurzfr. Unterstützung');
                        drawArrow(ctx, peakX + w*0.05, supportBreakY, peakX + w*0.05, supportBreakY + h*0.1, '#ef4444', 2, 'Bruch');
                    }
                },
                {
                    id: 'spikeBottom',
                    name: 'Spike Bottom (V-Bottom / Nadelspitze Unten)',
                    description: 'Ein Spike Bottom (auch V-Bottom oder Nadelspitze Unten) ist das bullische Gegenstück zum Spike Top. Der Kurs fällt steil ab und steigt dann ebenso schnell wieder an, oft ohne signifikante Konsolidierung am Tiefpunkt.',
                    characteristics: [
                        'Sehr schneller, oft fast senkrechter Abfall.',
                        'Ein scharfes Tief (Spike).',
                        'Sehr schneller, oft fast senkrechter Anstieg.',
                        'Hohes Volumen kann am Tiefpunkt auftreten, signalisiert Kapitulation und Umkehr.',
                        'Schwierig vorherzusagen, da die Umkehr sehr abrupt erfolgt.'
                    ],
                    trading: 'Aufgrund der Schnelligkeit schwer zu handeln. Bestätigungssignale (z.B. Bruch eines kurzfristigen Widerstands) sind wichtig. Oft ein Zeichen starker Volatilität und emotionaler Marktphasen.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Mittel bis gering.<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Long-Position nach Bestätigung der Umkehr, z.B. wenn eine signifikante bullische Kerze nach dem Spike entsteht oder ein kurzfristiger Widerstand bricht. SL: Unter dem Tief des Spikes. TP: Kann auf Basis vorheriger Widerstandsniveaus oder eines Vielfachen des Risikos festgelegt werden.',
                    advancedConsiderations: '<strong>Nachrichtenereignisse:</strong> Ähnlich wie Spike Tops, oft durch Nachrichten getrieben.',
                    performanceStats: 'Ähnlich wie Spike Tops, erfordern schnelles Handeln und Bestätigung.',
                    drawFunction: (ctx, w, h) => { 
                        const startX = w * 0.2, startY = h * 0.2;
                        const troughX = w * 0.5, troughY = h * 0.9;
                        const endX = w * 0.8, endY = h * 0.2;

                        drawLineWithLabel(ctx, w, h, startX, startY, troughX, troughY, '#60a5fa', 2.5, 'Steiler Abfall');
                        drawLineWithLabel(ctx, w, h, troughX, troughY, endX, endY, '#22c55e', 2.5, 'Steiler Anstieg');
                        drawText(ctx, 'Spike / V-Bottom', troughX, troughY + 15, '#fde047');

                        const resistanceBreakY = h*0.35;
                        drawLine(ctx, troughX - w*0.15, resistanceBreakY, troughX + w*0.15, resistanceBreakY, '#e0e0e0', 1, 'Kurzfr. Widerstand');
                        drawArrow(ctx, troughX + w*0.05, resistanceBreakY, troughX + w*0.05, resistanceBreakY - h*0.1, '#22c55e', 2, 'Bruch');
                    }
                },
                {
                    id: 'threeDrivesTop',
                    name: 'Three Drives to a Top',
                    description: 'Das "Three Drives to a Top" Muster ist eine bärische Umkehrformation, die aus drei aufeinanderfolgenden, symmetrischen Hochs (Drives) besteht, wobei jedes Hoch höher ist als das vorherige und von Korrekturen gefolgt wird. Es ähnelt dem Elliot-Wellen-Muster.',
                    characteristics: [
                        'Drei aufeinanderfolgende Hochs (Drives), die neue Höchststände markieren.',
                        'Zwei Korrekturphasen (Retracements) zwischen den Drives.',
                        'Die Drives und Retracements zeigen oft Fibonacci-Beziehungen (z.B. Retracements von 61.8% oder 78.6% des vorherigen Drives; Drives sind oft 127.2% oder 161.8% Extensionen der Retracements).',
                        'Volumen kann beim dritten Drive abnehmen, was auf eine Erschöpfung hindeutet.'
                    ],
                    trading: 'Ein Verkaufssignal kann nach der Vollendung des dritten Drives entstehen, insbesondere wenn eine bärische Divergenz bei Indikatoren vorliegt oder eine wichtige Unterstützung durchbrochen wird. Stop-Loss oft über dem Hoch des dritten Drives.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Mittel bis hoch, wenn die Symmetrie und Fibonacci-Verhältnisse klar sind und eine Bestätigung (z.B. Divergenz, Bruch einer Trendlinie) vorliegt.<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Short-Position nach Vollendung des dritten Drives und ersten Anzeichen einer Umkehr. SL: Knapp über dem Hoch des dritten Drives. TP: Oft das Niveau des zweiten Retracements (B) oder tiefer, basierend auf Fibonacci-Projektionen.',
                    advancedConsiderations: '<strong>Fibonacci:</strong> Die Einhaltung der typischen Fibonacci-Verhältnisse zwischen den Drives und Retracements erhöht die Zuverlässigkeit des Musters. Suchen Sie nach 1.272 oder 1.618 Extensionen für die Drives und 0.618 oder 0.786 Retracements.<br><strong>Divergenzen:</strong> Bärische Divergenzen bei Oszillatoren (z.B. RSI, MACD) zwischen dem zweiten und dritten Drive können die Umkehrwahrscheinlichkeit erhöhen.<br><strong>Zeitliche Symmetrie:</strong> Idealerweise sollten die Zeiträume für die Bildung der einzelnen Drives und Retracements ähnlich sein.',
                    performanceStats: 'Dieses Muster kann eine hohe Zuverlässigkeit aufweisen, wenn es klar ausgebildet ist und die Fibonacci-Verhältnisse stimmen. Divergenzen im RSI können die Aussagekraft erhöhen.',
                    drawFunction: (ctx, w, h) => { 
                        const driveColor = '#f87171';
                        const retracementColor = '#fbbf24'; // Gelb für Korrektur
                        const textColor = '#fde047';

                        // Drive 1
                        const d1StartX = w * 0.1, d1StartY = h * 0.8;
                        const d1PeakX = w * 0.25, d1PeakY = h * 0.4;
                        drawLine(ctx, d1StartX, d1StartY, d1PeakX, d1PeakY, driveColor, 2, 'Drive 1');
                        drawText(ctx, '1', d1PeakX, d1PeakY - 10, textColor);

                        // Retracement 1
                        const r1EndX = w * 0.35, r1EndY = h * 0.55;
                        drawLine(ctx, d1PeakX, d1PeakY, r1EndX, r1EndY, retracementColor, 1.5, 'Retracement A');
                        drawText(ctx, 'A', r1EndX, r1EndY + 15, textColor);
                        
                        // Drive 2
                        const d2PeakX = w * 0.5, d2PeakY = h * 0.25;
                        drawLine(ctx, r1EndX, r1EndY, d2PeakX, d2PeakY, driveColor, 2, 'Drive 2');
                        drawText(ctx, '2', d2PeakX, d2PeakY - 10, textColor);

                        // Retracement 2
                        const r2EndX = w * 0.6, r2EndY = h * 0.4;
                        drawLine(ctx, d2PeakX, d2PeakY, r2EndX, r2EndY, retracementColor, 1.5, 'Retracement B');
                        drawText(ctx, 'B', r2EndX, r2EndY + 15, textColor);

                        // Drive 3
                        const d3PeakX = w * 0.75, d3PeakY = h * 0.1;
                        drawLine(ctx, r2EndX, r2EndY, d3PeakX, d3PeakY, driveColor, 2, 'Drive 3');
                        drawText(ctx, '3', d3PeakX, d3PeakY - 10, textColor);

                        // Ausbruchsrichtung
                        drawArrow(ctx, d3PeakX, d3PeakY + h*0.05, d3PeakX + w*0.1, d3PeakY + h*0.3, '#ef4444', 2.5, 'Bärische Umkehr');
                        drawText(ctx, 'Umkehr', d3PeakX + w*0.05, d3PeakY + h*0.3 + 15, '#ef4444');
                    }
                },
                {
                    id: 'threeDrivesBottom',
                    name: 'Three Drives to a Bottom',
                    description: 'Das "Three Drives to a Bottom" Muster ist eine bullische Umkehrformation, das Spiegelbild des "Three Drives to a Top". Es besteht aus drei aufeinanderfolgenden, symmetrischen Tiefs.',
                    characteristics: [
                        'Drei aufeinanderfolgende Tiefs (Drives), die neue Tiefststände markieren.',
                        'Zwei Korrekturphasen (Retracements) zwischen den Drives.',
                        'Die Drives und Retracements zeigen oft Fibonacci-Beziehungen.',
                        'Volumen kann beim dritten Drive abnehmen oder bei der Umkehr ansteigen.'
                    ],
                    trading: 'Ein Kaufsignal kann nach der Vollendung des dritten Drives entstehen, insbesondere wenn eine bullische Divergenz bei Indikatoren vorliegt oder ein wichtiger Widerstand durchbrochen wird. Stop-Loss oft unter dem Tief des dritten Drives.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Mittel bis hoch, analog zum Three Drives Top.<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Long-Position nach Vollendung des dritten Drives und ersten Anzeichen einer Umkehr. SL: Knapp unter dem Tief des dritten Drives. TP: Oft das Niveau des zweiten Retracements (B) oder höher, basierend auf Fibonacci-Projektionen.',
                    advancedConsiderations: '<strong>Fibonacci:</strong> Wie beim Three Drives Top sind Fibonacci-Verhältnisse wichtig für die Validierung.<br><strong>Divergenzen:</strong> Bullische Divergenzen bei Oszillatoren (z.B. RSI, MACD) zwischen dem zweiten und dritten Drive können die Umkehrwahrscheinlichkeit erhöhen.<br><strong>Zeitliche Symmetrie:</strong> Ähnliche Zeiträume für Drives und Retracements sind ideal.',
                    performanceStats: 'Ähnlich wie Three Drives Top, aber für bullische Umkehrungen.',
                    drawFunction: (ctx, w, h) => { 
                        const driveColor = '#60a5fa';
                        const retracementColor = '#fbbf24';
                        const textColor = '#fde047';

                        // Drive 1
                        const d1StartX = w * 0.1, d1StartY = h * 0.2;
                        const d1TroughX = w * 0.25, d1TroughY = h * 0.6;
                        drawLine(ctx, d1StartX, d1StartY, d1TroughX, d1TroughY, driveColor, 2, 'Drive 1');
                        drawText(ctx, '1', d1TroughX, d1TroughY + 15, textColor);

                        // Retracement 1
                        const r1EndX = w * 0.35, r1EndY = h * 0.45;
                        drawLine(ctx, d1TroughX, d1TroughY, r1EndX, r1EndY, retracementColor, 1.5, 'Retracement A');
                        drawText(ctx, 'A', r1EndX, r1EndY - 10, textColor);
                        
                        // Drive 2
                        const d2TroughX = w * 0.5, d2TroughY = h * 0.75;
                        drawLine(ctx, r1EndX, r1EndY, d2TroughX, d2TroughY, driveColor, 2, 'Drive 2');
                        drawText(ctx, '2', d2TroughX, d2TroughY + 15, textColor);

                        // Retracement 2
                        const r2EndX = w * 0.6, r2EndY = h * 0.6;
                        drawLine(ctx, d2TroughX, d2TroughY, r2EndX, r2EndY, retracementColor, 1.5, 'Retracement B');
                        drawText(ctx, 'B', r2EndX, r2EndY - 10, textColor);

                        // Drive 3
                        const d3TroughX = w * 0.75, d3TroughY = h * 0.9;
                        drawLine(ctx, r2EndX, r2EndY, d3TroughX, d3TroughY, driveColor, 2, 'Drive 3');
                        drawText(ctx, '3', d3TroughX, d3TroughY + 15, textColor);

                        // Ausbruchsrichtung
                        drawArrow(ctx, d3TroughX, d3TroughY - h*0.05, d3TroughX + w*0.1, d3TroughY - h*0.3, '#22c55e', 2.5, 'Bullische Umkehr');
                        drawText(ctx, 'Umkehr', d3TroughX + w*0.05, d3TroughY - h*0.3 - 15, '#22c55e');
                    }
                },
                {
                    id: 'deadCatBounce',
                    name: 'Dead Cat Bounce',
                    description: 'Ein "Dead Cat Bounce" ist eine temporäre, kurzfristige Erholung der Kurse nach einem starken Abverkauf oder inmitten eines Abwärtstrends. Diese Erholung ist oft nicht nachhaltig und wird von einer Fortsetzung des Abwärtstrends gefolgt.',
                    characteristics: [
                        'Tritt nach einem signifikanten Kursrückgang auf.',
                        'Kurze, oft schwache Erholung.',
                        'Volumen während der Erholung ist oft geringer als beim vorherigen Abverkauf.',
                        'Die Erholung scheitert, und der Abwärtstrend setzt sich fort, oft mit neuen Tiefs.'
                    ],
                    trading: 'Sehr riskant, auf einen Dead Cat Bounce zu setzen, da es schwer ist, ihn von einer echten Trendumkehr zu unterscheiden. Erfahrene Trader könnten versuchen, die Spitze der Erholung zu shorten, wenn Anzeichen einer Schwäche auftreten. Für die meisten ist es ein Warnsignal, nicht in die Erholung hineinzukaufen.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Gering für Long-Positionen, da es sich meist um eine Fortsetzung des Abwärtstrends handelt. Erfahrene Trader könnten die Spitze des Bounces für Short-Einstiege nutzen (höheres Risiko).<br><strong>Tradingeinstieg mit TP und SL:</strong> Short-Einstieg: Am Hoch des Bounces mit Bestätigung der Schwäche (z.B. bärische Kerzenmuster). SL: Über dem Hoch des Bounces. TP: Unterhalb des vorherigen Tiefs oder basierend auf der Stärke des ursprünglichen Abverkaufs.',
                    advancedConsiderations: '<strong>Fibonacci-Retracements:</strong> Der Bounce erreicht oft typische Fibonacci-Retracement-Levels (z.B. 38.2% oder 50%) des vorherigen Abverkaufs, bevor er scheitert.<br><strong>Kontext:</strong> Tritt häufiger in stark bärischen Märkten auf. Die Stärke und Dauer des Bounces kann variieren, ist aber meist proportional geringer als der vorherige Abverkauf.<br><strong>Fehlsignal:</strong> Wenn der Bounce sich als Beginn einer echten Bodenbildung herausstellt (z.B. durch Bildung eines Doppelbodens oder einer inversen SKS), war es kein klassischer Dead Cat Bounce.',
                    performanceStats: 'Kein klassisches Trading-Muster für einen Einstieg, sondern eher ein Warnsignal. Die "Performance" bezieht sich hier auf die hohe Wahrscheinlichkeit, dass der ursprüngliche Abwärtstrend fortgesetzt wird.',
                    drawFunction: (ctx, w, h) => { 
                        const startX = w * 0.1, startY = h * 0.15;
                        const firstDropX = w * 0.35, firstDropY = h * 0.7;
                        const bouncePeakX = w * 0.55, bouncePeakY = h * 0.5;
                        const finalDropX = w * 0.8, finalDropY = h * 0.85;

                        // Starker Abverkauf
                        drawLineWithLabel(ctx, w,h, startX, startY, firstDropX, firstDropY, '#ef4444', 2.5, 'Starker Abverkauf');
                        
                        // Dead Cat Bounce (Erholung)
                        drawLineWithLabel(ctx, w,h, firstDropX, firstDropY, bouncePeakX, bouncePeakY, '#a3e635', 2, 'Kurze Erholung (Bounce)');
                        drawText(ctx, 'Bounce', bouncePeakX, bouncePeakY - 10, '#a3e635');

                        // Fortsetzung des Abwärtstrends
                        drawLineWithLabel(ctx, w,h, bouncePeakX, bouncePeakY, finalDropX, finalDropY, '#ef4444', 2.5, 'Trendfortsetzung Abwärts');
                        drawText(ctx, 'Neues Tief', finalDropX, finalDropY + 15, '#ef4444');
                    }
                },
                {
                    id: 'hornTop',
                    name: 'Horn Top',
                    description: 'Ein Horn Top ist eine kurzfristige bärische Umkehrformation, die durch zwei relativ nahe beieinander liegende, spitze Hochs (die "Hörner") gekennzeichnet ist. Das zweite Hoch kann etwas höher oder tiefer als das erste sein. Es signalisiert oft eine schnelle Stimmungsänderung.',
                    characteristics: [
                        'Zwei scharfe, spitze Hochs (Hörner), die nahe beieinander liegen.',
                        'Tritt oft nach einem schnellen Anstieg auf.',
                        'Das Tief zwischen den Hörnern ist relativ flach.',
                        'Kann eine schnelle und scharfe Umkehr einleiten.'
                    ],
                    trading: 'Ein Verkaufssignal kann entstehen, wenn der Kurs unter das Tief zwischen den Hörnern fällt. Aufgrund der Schnelligkeit des Musters ist oft eine schnelle Reaktion erforderlich. Volumen kann bei den Hochs oder beim Bruch des Zwischentiefs ansteigen.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Mittel. Die Schnelligkeit macht das Timing schwierig.<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Short-Position nach dem Bruch des Zwischentiefs zwischen den Hörnern. SL: Über dem höchsten der beiden Hörner. TP: Basierend auf der Volatilität oder vorherigen Unterstützungsniveaus.',
                    advancedConsiderations: '<strong>Kerzenmuster:</strong> Achten Sie auf bärische Umkehrkerzen an den Spitzen der Hörner (z.B. Shooting Star, Bearish Engulfing).<br><strong>Volumen:</strong> Hohes Volumen an den Spitzen kann Erschöpfung signalisieren. Ein Anstieg des Volumens beim Bruch des Zwischentiefs bestätigt das Signal.<br><strong>Fehlausbruch:</strong> Ein Fehlausbruch über das zweite Horn, gefolgt von einer schnellen Umkehr unter das Zwischentief, kann ein noch stärkeres Signal sein.',
                    performanceStats: 'Horn Tops sind kurzfristige Muster. Ihre Zuverlässigkeit kann variieren; oft sind sie Indikatoren für erhöhte Volatilität und schnelle Umkehrungen.',
                    drawFunction: (ctx, w, h) => { 
                        const baseY = h * 0.7;
                        const horn1PeakX = w * 0.4, horn1PeakY = h * 0.2;
                        const horn2PeakX = w * 0.6, horn2PeakY = h * 0.25; // Kann leicht variieren
                        const valleyX = (horn1PeakX + horn2PeakX) / 2, valleyY = h * 0.4;

                        // Anstieg zum ersten Horn
                        drawLine(ctx, w*0.2, baseY, horn1PeakX, horn1PeakY, '#fca5a5', 2, 'Anstieg');
                        drawText(ctx, 'Horn 1', horn1PeakX, horn1PeakY - 10, '#fde047');
                        
                        // Zum Zwischentief
                        drawLine(ctx, horn1PeakX, horn1PeakY, valleyX, valleyY, '#fca5a5', 1.5);
                        
                        // Zweites Horn
                        drawLine(ctx, valleyX, valleyY, horn2PeakX, horn2PeakY, '#ef4444', 2, 'Horn 2');
                        drawText(ctx, 'Horn 2', horn2PeakX, horn2PeakY - 10, '#fde047');

                        // Abfall nach dem zweiten Horn
                        drawLine(ctx, horn2PeakX, horn2PeakY, w*0.8, baseY*1.1, '#ef4444', 2.5, 'Abfall');
                        
                        // Unterstützungslinie (Zwischentief)
                        drawLine(ctx, valleyX - w*0.1, valleyY, valleyX + w*0.1, valleyY, '#e0e0e0', 1, 'Zwischentief-Unterstützung');
                        drawArrow(ctx, valleyX + w*0.05, valleyY, valleyX + w*0.05, valleyY + h*0.15, '#ef4444', 2, 'Bruchsignal');
                    }
                },
                {
                    id: 'hornBottom',
                    name: 'Horn Bottom',
                    description: 'Ein Horn Bottom ist eine kurzfristige bullische Umkehrformation, das Spiegelbild des Horn Top. Es besteht aus zwei relativ nahe beieinander liegenden, spitzen Tiefs.',
                    characteristics: [
                        'Zwei scharfe, spitze Tiefs (Hörner), die nahe beieinander liegen.',
                        'Tritt oft nach einem schnellen Abfall auf.',
                        'Das Hoch zwischen den Hörnern ist relativ flach.',
                        'Kann eine schnelle und scharfe Umkehr einleiten.'
                    ],
                    trading: 'Ein Kaufsignal kann entstehen, wenn der Kurs über das Hoch zwischen den Hörnern steigt. Aufgrund der Schnelligkeit des Musters ist oft eine schnelle Reaktion erforderlich.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Mittel.<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Long-Position nach dem Bruch des Zwischenhochs zwischen den Hörnern. SL: Unter dem tiefsten der beiden Hörner. TP: Basierend auf der Volatilität oder vorherigen Widerstandsniveaus.',
                    advancedConsiderations: '<strong>Kerzenmuster:</strong> Achten Sie auf bullische Umkehrkerzen an den Tiefs der Hörner (z.B. Hammer, Bullish Engulfing).<br><strong>Volumen:</strong> Hohes Volumen an den Tiefs kann Kapitulation signalisieren. Ein Anstieg des Volumens beim Bruch des Zwischenhochs bestätigt das Signal.<br><strong>Fehlausbruch:</strong> Ein Fehlausbruch unter das zweite Horn, gefolgt von einer schnellen Umkehr über das Zwischenhoch, kann ein noch stärkeres Signal sein.',
                    performanceStats: 'Ähnlich wie Horn Tops, aber für bullische Umkehrungen.',
                    drawFunction: (ctx, w, h) => { 
                        const baseY = h * 0.3; // Obere Basis für Abfall
                        const horn1TroughX = w * 0.4, horn1TroughY = h * 0.8;
                        const horn2TroughX = w * 0.6, horn2TroughY = h * 0.75; // Kann leicht variieren
                        const peakX = (horn1TroughX + horn2TroughX) / 2, peakY = h * 0.6;

                        // Abfall zum ersten Horn
                        drawLine(ctx, w*0.2, baseY, horn1TroughX, horn1TroughY, '#86efac', 2, 'Abfall');
                        drawText(ctx, 'Horn 1', horn1TroughX, horn1TroughY + 15, '#fde047');
                        
                        // Zum Zwischenhoch
                        drawLine(ctx, horn1TroughX, horn1TroughY, peakX, peakY, '#86efac', 1.5);
                        
                        // Zweites Horn
                        drawLine(ctx, peakX, peakY, horn2TroughX, horn2TroughY, '#22c55e', 2, 'Horn 2');
                        drawText(ctx, 'Horn 2', horn2TroughX, horn2TroughY + 15, '#fde047');

                        // Anstieg nach dem zweiten Horn
                        drawLine(ctx, horn2TroughX, horn2TroughY, w*0.8, baseY*0.9, '#22c55e', 2.5, 'Anstieg');
                        
                        // Widerstandslinie (Zwischenhoch)
                        drawLine(ctx, peakX - w*0.1, peakY, peakX + w*0.1, peakY, '#e0e0e0', 1, 'Zwischenhoch-Widerstand');
                        drawArrow(ctx, peakX + w*0.05, peakY, peakX + w*0.05, peakY - h*0.15, '#22c55e', 2, 'Bruchsignal');
                    }
                },
                {
                    id: 'eveAdamTop',
                    name: 'Eve & Adam Top',
                    description: 'Ein Eve & Adam Top ist eine bärische Umkehrformation, die aus einem abgerundeten Hoch (Eve) gefolgt von einem spitzeren, V-förmigen Hoch (Adam) besteht. Das Zwischentief ist oft V-förmig. Es signalisiert eine Verteilung und eine bevorstehende Abwärtsbewegung.',
                    characteristics: [
                        'Eve Top: Ein breites, abgerundetes Hoch, das eine längere Verteilungsphase darstellt.',
                        'Adam Top: Ein engeres, spitzeres Hoch, oft mit einem schnellen Anstieg und Abfall.',
                        'Das Adam-Hoch ist typischerweise niedriger oder auf ähnlichem Niveau wie das Eve-Hoch.',
                        'Ein Bruch der Unterstützungslinie (Nackenlinie), die die Tiefs verbindet, bestätigt das Muster.'
                    ],
                    trading: 'Ein Verkaufssignal entsteht beim Bruch der Nackenlinie. Das Kursziel ist oft die Höhe vom höchsten Punkt des Musters zur Nackenlinie, nach unten projiziert.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Mittel bis hoch, besonders wenn das Adam-Top nicht signifikant höher als das Eve-Top ist und der Bruch der Nackenlinie mit Volumen erfolgt.<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Short-Position nach dem Bruch der Nackenlinie. SL: Über der Nackenlinie oder über dem Adam-Hoch. TP: Höhe des Musters (vom höchsten Punkt bis zur Nackenlinie) vom Ausbruchspunkt nach unten projiziert.',
                    advancedConsiderations: '<strong>Volumen:</strong> Das Volumen kann beim Eve-Top abnehmen und beim Adam-Top kurzzeitig ansteigen, bevor es beim Bruch der Nackenlinie wieder zunimmt.<br><strong>Formen:</strong> Das Eve-Top ist typischerweise breiter und runder, was auf eine längere Verteilungsphase hindeutet. Das Adam-Top ist schmaler und spitzer, oft ein schneller Test des vorherigen Hochs.<br><strong>Nackenlinie:</strong> Ein klarer Bruch der Nackenlinie ist entscheidend für die Bestätigung.',
                    performanceStats: 'Diese Muster gelten als relativ zuverlässig, insbesondere wenn das Adam-Element eine klare Spitze bildet und das Volumen den Ausbruch bestätigt.',
                    drawFunction: (ctx, w, h) => { 
                        const neckY = h * 0.7;
                        const eveTopY = h * 0.2;
                        const eveCenterX = w * 0.3;
                        const eveWidth = w * 0.3;
                        
                        const adamPeakY = h * 0.25; // Kann etwas tiefer sein
                        const adamCenterX = w * 0.7;
                        const adamWidth = w * 0.15;

                        // Eve Top (abgerundet)
                        ctx.beginPath();
                        ctx.moveTo(eveCenterX - eveWidth/2, neckY * 0.9);
                        ctx.quadraticCurveTo(eveCenterX, eveTopY - h*0.05, eveCenterX + eveWidth/2, neckY * 0.9);
                        ctx.strokeStyle = '#fca5a5'; ctx.lineWidth = 2; ctx.stroke();
                        addTooltipToPath(ctx.getCurrentPath ? ctx.getCurrentPath() : null, 'Eve Top (abgerundet)');
                        drawText(ctx, 'Eve', eveCenterX, eveTopY - 10, '#fde047');

                        // Verbindungstief (kann V-förmig sein)
                        drawLine(ctx, eveCenterX + eveWidth/2, neckY * 0.9, w * 0.5, neckY, '#e5e7eb', 1.5);
                        
                        // Adam Top (spitz)
                        drawPeak(ctx, adamCenterX, adamPeakY, adamWidth, neckY, '#ef4444', 'Adam Top (spitz)');
                        drawText(ctx, 'Adam', adamCenterX, adamPeakY - 10, '#fde047');

                        // Nackenlinie
                        drawLine(ctx, w*0.15, neckY, w*0.85, neckY, '#e0e0e0', 1.5, 'Nackenlinie');

                        // Ausbruch
                        drawArrow(ctx, w*0.6, neckY, w*0.6, neckY + h*0.2, '#ef4444', 2, 'Ausbruchsrichtung');
                        drawText(ctx, 'Ausbruch', w*0.6, neckY + h*0.2 + 15, '#ef4444');
                    }
                },
                {
                    id: 'eveAdamBottom',
                    name: 'Eve & Adam Bottom',
                    description: 'Ein Eve & Adam Bottom ist eine bullische Umkehrformation, das Spiegelbild des Eve & Adam Top. Es besteht aus einem abgerundeten Tief (Eve) gefolgt von einem spitzeren, V-förmigen Tief (Adam).',
                    characteristics: [
                        'Eve Bottom: Ein breites, abgerundetes Tief.',
                        'Adam Bottom: Ein engeres, spitzeres Tief.',
                        'Das Adam-Tief ist typischerweise höher oder auf ähnlichem Niveau wie das Eve-Tief.',
                        'Ein Bruch der Widerstandslinie (Nackenlinie) bestätigt das Muster.'
                    ],
                    trading: 'Ein Kaufsignal entsteht beim Bruch der Nackenlinie. Das Kursziel ist oft die Höhe vom tiefsten Punkt des Musters zur Nackenlinie, nach oben projiziert.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Mittel bis hoch.<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Long-Position nach dem Bruch der Nackenlinie. SL: Unter der Nackenlinie oder unter dem Adam-Tief. TP: Höhe des Musters vom Ausbruchspunkt nach oben projiziert.',
                    advancedConsiderations: '<strong>Volumen:</strong> Das Volumen kann beim Eve-Bottom abnehmen und beim Adam-Bottom kurzzeitig ansteigen, bevor es beim Bruch der Nackenlinie wieder zunimmt.<br><strong>Formen:</strong> Das Eve-Bottom ist typischerweise breiter und runder, was auf eine längere Akkumulationsphase hindeutet. Das Adam-Bottom ist schmaler und spitzer, oft ein schneller Test des vorherigen Tiefs.<br><strong>Nackenlinie:</strong> Ein klarer Bruch der Nackenlinie ist entscheidend für die Bestätigung.',
                    performanceStats: 'Ähnlich wie Eve & Adam Tops, aber für bullische Umkehrungen.',
                    drawFunction: (ctx, w, h) => { 
                        const neckY = h * 0.3;
                        const eveBottomY = h * 0.8;
                        const eveCenterX = w * 0.3;
                        const eveWidth = w * 0.3;
                        
                        const adamTroughY = h * 0.75; 
                        const adamCenterX = w * 0.7;
                        const adamWidth = w * 0.15;

                        // Eve Bottom (abgerundet)
                        ctx.beginPath();
                        ctx.moveTo(eveCenterX - eveWidth/2, neckY * 1.1);
                        ctx.quadraticCurveTo(eveCenterX, eveBottomY + h*0.05, eveCenterX + eveWidth/2, neckY * 1.1);
                        ctx.strokeStyle = '#86efac'; ctx.lineWidth = 2; ctx.stroke();
                        addTooltipToPath(ctx.getCurrentPath ? ctx.getCurrentPath() : null, 'Eve Bottom (abgerundet)');
                        drawText(ctx, 'Eve', eveCenterX, eveBottomY + 10, '#fde047');

                        // Verbindungshoch
                        drawLine(ctx, eveCenterX + eveWidth/2, neckY * 1.1, w * 0.5, neckY, '#e5e7eb', 1.5);
                        
                        // Adam Bottom (spitz)
                        drawTrough(ctx, adamCenterX, adamTroughY, adamWidth, neckY, '#22c55e', 'Adam Bottom (spitz)');
                        drawText(ctx, 'Adam', adamCenterX, adamTroughY + 15, '#fde047');

                        // Nackenlinie
                        drawLine(ctx, w*0.15, neckY, w*0.85, neckY, '#e0e0e0', 1.5, 'Nackenlinie');

                        // Ausbruch
                        drawArrow(ctx, w*0.6, neckY, w * 0.6, neckY - h*0.2, '#22c55e', 2, 'Ausbruchsrichtung');
                        drawText(ctx, 'Ausbruch', w*0.6, neckY - h*0.2 - 15, '#22c55e');
                    }
                },
                {
                    id: 'invertedCupAndHandleReversal',
                    name: 'Invertierte Tasse mit Henkel (Umkehr)',
                    description: 'Die invertierte Tasse mit Henkel als Umkehrmuster ist eine bärische Formation, die typischerweise am Ende eines Aufwärtstrends auftritt und eine bevorstehende Trendwende nach unten signalisiert. Sie ist das Spiegelbild der bullischen "Tasse mit Henkel"-Formation.',
                    characteristics: ['Tritt nach einem signifikanten Aufwärtstrend auf.', // Unterschied
                    'Die "Tasse" bildet sich als abgerundetes Hoch und stellt eine Verteilungsphase dar.',
                    'Der "Henkel" ist eine kleinere, oft leicht aufwärts oder seitwärts gerichtete Konsolidierung (Pullback) auf der rechten Seite der Tasse. Der Henkel sollte idealerweise nicht über das obere Drittel der Tassenhöhe hinausragen und ein geringeres Volumen aufweisen.',
                    'Eine Unterstützungslinie kann am unteren Rand des Henkels und/oder der Tasse identifiziert werden.',
                    'Das Volumen ist oft während der Bildung des Tassenhochs und des Henkels rückläufig und steigt beim bärischen Ausbruch unter die Unterstützungslinie des Henkels an.'],
                    trading: 'Ein Verkaufssignal entsteht, wenn der Kurs unter die Unterstützungslinie des Henkels (und idealerweise der Tasse) ausbricht, insbesondere bei erhöhtem Volumen. Das Kursziel wird oft durch Messen der Höhe der Tasse (vom höchsten Punkt bis zur Unterstützungslinie am Tassenrand) und Subtrahieren dieses Wertes vom Ausbruchspunkt bestimmt.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Mittel bis hoch, wenn der vorherige Aufwärtstrend etabliert war und der Ausbruch überzeugend ist.<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Short-Position beim oder nach dem Ausbruch unter die Unterkante des Henkels/Tassenrandes. SL: Oberhalb des Henkelhochs oder knapp über der durchbrochenen Unterstützungslinie (die nun Widerstand darstellt). TP: Mindestens die Höhe der Tasse, vom Ausbruchspunkt nach unten projiziert.',
                    advancedConsiderations: '<strong>Kontext als Umkehrmuster:</strong> Dieses Muster ist besonders signifikant, wenn es nach einem längeren und überdehnten Aufwärtstrend erscheint. Es zeigt, dass die Käufer an Kraft verlieren und die Verkäufer beginnen, die Kontrolle zu übernehmen. Die abgerundete Form der "Tasse" deutet auf eine allmähliche Verteilung hin, während der "Henkel" einen letzten, schwachen Versuch der Käufer darstellt, den Trend fortzusetzen, bevor die Verkäufer dominieren.', // Unterschied betont
                    performanceStats: 'Die Zuverlässigkeit als Umkehrmuster ist oft gut, erfordert aber eine klare Ausprägung, eine Bestätigung durch Volumen und die Berücksichtigung des Gesamtmarktkontextes. Fehlausbrüche sind möglich, daher ist eine Bestätigung des Bruchs abzuwarten.',
                    drawFunction: (ctx, w, h) => { 
                        const cupRimY = h * 0.7; // Unterer Rand der Tasse
                        const cupTopY = h * 0.3;  // Oberer Punkt der Tasse
                        const cupWidth = w * 0.6;
                        const cupCenterX = w * 0.4;

                        // Invertierte Tasse (abgerundetes Hoch)
                        ctx.beginPath();
                        ctx.moveTo(cupCenterX - cupWidth / 2, cupRimY);
                        ctx.quadraticCurveTo(cupCenterX, cupTopY - h*0.1, cupCenterX + cupWidth / 2, cupRimY);
                        ctx.strokeStyle = '#f87171'; // Rötlich für bärisch
                        ctx.lineWidth = 2;
                        ctx.stroke();
                        addTooltipToPath(ctx.getCurrentPath ? ctx.getCurrentPath() : null, 'Invertierte Tasse');

                        // Unterstützungslinie der Tasse
                        drawLineWithLabel(ctx, w, h, cupCenterX - cupWidth / 2, cupRimY, cupCenterX + cupWidth / 2 + w*0.15, cupRimY, '#e5e7eb', 1.5, 'Unterstützung');

                        // Henkel (leicht aufwärts)
                        const handleStartX = cupCenterX + cupWidth / 2;
                        const handleStartY = cupRimY;
                        const handleEndX = handleStartX + w * 0.15;
                        const handleEndY = cupRimY - h * 0.1; // Leicht aufwärts
                        const handlePeakX = handleStartX + w * 0.075;
                        const handlePeakY = cupRimY - h * 0.15; // Höchster Punkt des Henkels

                        ctx.beginPath();
                        ctx.moveTo(handleStartX, handleStartY);
                        ctx.lineTo(handlePeakX - w*0.02, handlePeakY + h*0.03); 
                        ctx.quadraticCurveTo(handlePeakX, handlePeakY, handleEndX - w*0.02, handleEndY - h*0.01); 
                        ctx.lineTo(handleEndX, handleEndY); 
                        ctx.strokeStyle = '#fca5a5'; // Hellrot für Henkel
                        ctx.lineWidth = 2;
                        ctx.stroke();
                        addTooltipToPath(ctx.getCurrentPath ? ctx.getCurrentPath() : null, 'Henkel');

                        drawText(ctx, 'Inv. Tasse', cupCenterX, cupTopY + 10, '#f87171');
                        drawText(ctx, 'Henkel', handlePeakX, handlePeakY - 15, '#fca5a5');

                        // Ausbruch
                        const breakoutX = handleEndX;
                        const breakoutY = cupRimY; 
                        drawArrow(ctx, breakoutX, breakoutY, breakoutX + w*0.1, breakoutY + h*0.15, '#ef4444', 2, 'Ausbruchsrichtung');
                        drawText(ctx, 'Ausbruch', breakoutX + w*0.05, breakoutY + h*0.15 +10, '#ef4444');
                    }
                }
            ],
            "Fortsetzungsmuster": [
                {
                    id: 'ascendingTriangle',
                    name: 'Aufsteigendes Dreieck',
                    description: 'Ein aufsteigendes Dreieck ist typischerweise eine bullische Fortsetzungsformation. Es wird durch eine horizontale obere Widerstandslinie und eine ansteigende untere Unterstützungslinie gebildet.',
                    characteristics: [ 'Horizontale obere Linie (Widerstand).', 'Ansteigende untere Linie (Unterstützung).', 'Die Linien konvergieren.', 'Volumen nimmt tendenziell ab, während sich das Muster bildet, und steigt beim Ausbruch.'],
                    trading: 'Ein Kaufsignal entsteht oft, wenn der Kurs über die horizontale Widerstandslinie ausbricht. Das Kursziel kann durch Messen der breitesten Stelle des Dreiecks und Addieren zum Ausbruchspunkt bestimmt werden.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Hoch, da es eine klare Akkumulationsphase zeigt. Bestätigung durch Volumen beim Ausbruch erhöht die Wahrscheinlichkeit.<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Long-Position nach dem Ausbruch über die Widerstandslinie. SL: Unter dem Ausbruchsniveau oder unter der ansteigenden Unterstützungslinie. TP: Höhe des Dreiecks (breiteste Stelle) vom Ausbruchspunkt nach oben projiziert.',
                    advancedConsiderations: '<strong>Fehlausbrüche:</strong> Ein kurzer Ausbruch nach unten, der schnell wieder in das Dreieck zurückkehrt, kann ein starkes Kaufsignal sein (Bärenfalle).<br><strong>Kontext:</strong> Besonders stark in einem etablierten Aufwärtstrend.',
                    performanceStats: 'Aufsteigende Dreiecke gelten als zuverlässige bullische Fortsetzungsmuster mit einer guten Erfolgsquote, besonders wenn der Ausbruch von hohem Volumen begleitet wird.',
                    drawFunction: (ctx, w, h) => { 
                        const resistanceY = h * 0.3;
                        const startSupportY = h * 0.8;
                        const meetingX = w * 0.85;
                        drawLine(ctx, w * 0.1, resistanceY, meetingX, resistanceY, '#e5e7eb', 2, 'Widerstandslinie');
                        drawLine(ctx, w * 0.1, startSupportY, meetingX, resistanceY, '#e5e7eb', 2, 'Unterstützungslinie');
                        ctx.beginPath(); ctx.moveTo(w * 0.12, startSupportY * 0.98); ctx.lineTo(w * 0.25, resistanceY * 1.05); ctx.lineTo(w * 0.38, startSupportY * 0.85); ctx.lineTo(w * 0.51, resistanceY * 1.05); ctx.lineTo(w * 0.64, startSupportY * 0.72); ctx.lineTo(w * 0.77, resistanceY * 1.05); ctx.strokeStyle = '#60a5fa'; ctx.lineWidth = 2; ctx.stroke(); addTooltipToPath(ctx.getCurrentPath ? ctx.getCurrentPath() : null, 'Simulierte Kursbewegung');
                        drawText(ctx, 'Widerstand', w * 0.4, resistanceY - 10, '#e5e7eb');
                        drawText(ctx, 'Unterstützung', w * 0.4, (startSupportY + resistanceY)/2 + 30, '#e5e7eb');
                        drawArrow(ctx, meetingX * 0.95, resistanceY, meetingX * 0.95, resistanceY - h*0.15, '#22c55e', 2, 'Ausbruchsrichtung');
                        drawText(ctx, 'Ausbruch', meetingX * 0.95, resistanceY - h*0.15 - 15, '#22c55e');
                    }
                },
                {
                    id: 'descendingTriangle',
                    name: 'Absteigendes Dreieck',
                    description: 'Ein absteigendes Dreieck ist typischerweise eine bärische Fortsetzungsformation. Es wird durch eine horizontale untere Unterstützungslinie und eine fallende obere Widerstandslinie gebildet.',
                    characteristics: [ 'Horizontale untere Linie (Unterstützung).', 'Fallende obere Linie (Widerstand).', 'Die Linien konvergieren.', 'Volumen nimmt tendenziell ab und steigt beim Ausbruch.' ],
                    trading: 'Ein Verkaufssignal entsteht oft, wenn der Kurs unter die horizontale Unterstützungslinie ausbricht. Das Kursziel kann durch Messen der breitesten Stelle des Dreiecks und Subtrahieren vom Ausbruchspunkt bestimmt werden.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Hoch, da es eine klare Distributionsphase zeigt. Bestätigung durch Volumen beim Ausbruch erhöht die Wahrscheinlichkeit.<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Short-Position nach dem Ausbruch unter die Unterstützungslinie. SL: Über dem Ausbruchsniveau oder über der fallenden Widerstandslinie. TP: Höhe des Dreiecks (breiteste Stelle) vom Ausbruchspunkt nach unten projiziert.',
                    advancedConsiderations: '<strong>Fehlausbrüche:</strong> Ein kurzer Ausbruch nach oben, der schnell wieder in das Dreieck zurückkehrt, kann ein starkes Verkaufssignal sein (Bullenfalle).<br><strong>Kontext:</strong> Besonders stark in einem etablierten Abwärtstrend.',
                    performanceStats: 'Absteigende Dreiecke gelten als zuverlässige bärische Fortsetzungsmuster.',
                    drawFunction: (ctx, w, h) => { 
                        const supportY = h * 0.7;
                        const startResistanceY = h * 0.2;
                        const meetingX = w * 0.85;
                        drawLine(ctx, w * 0.1, supportY, meetingX, supportY, '#e5e7eb', 2, 'Unterstützungslinie');
                        drawLine(ctx, w * 0.1, startResistanceY, meetingX, supportY, '#e5e7eb', 2, 'Widerstandslinie');
                        ctx.beginPath(); ctx.moveTo(w * 0.12, startResistanceY * 1.05); ctx.lineTo(w * 0.25, supportY * 0.95); ctx.lineTo(w * 0.38, startResistanceY * 1.3); ctx.lineTo(w * 0.51, supportY * 0.95); ctx.lineTo(w * 0.64, startResistanceY * 1.5); ctx.lineTo(w * 0.77, supportY * 0.95); ctx.strokeStyle = '#f87171'; ctx.lineWidth = 2; ctx.stroke(); addTooltipToPath(ctx.getCurrentPath ? ctx.getCurrentPath() : null, 'Simulierte Kursbewegung');
                        drawText(ctx, 'Widerstand', w * 0.4, (startResistanceY+supportY)/2 - 40, '#e5e7eb');
                        drawText(ctx, 'Unterstützung', w * 0.4, supportY + 20, '#e5e7eb');
                        drawArrow(ctx, meetingX * 0.95, supportY, meetingX * 0.95, supportY + h*0.15, '#ef4444', 2, 'Ausbruchsrichtung');
                        drawText(ctx, 'Ausbruch', meetingX * 0.95, supportY + h*0.15 + 15, '#ef4444');
                    }
                },
                {
                    id: 'symmetricalTriangleContinuationBullish',
                    name: 'Symmetr. Dreieck (Forts. Bullisch)',
                    description: 'Ein symmetrisches Dreieck kann auch als Fortsetzungsmuster auftreten. In einem Aufwärtstrend deutet ein Ausbruch nach oben auf eine Fortsetzung des Trends hin.',
                    characteristics: [
                        'Vorhergehender Aufwärtstrend.',
                        'Fallende obere Trendlinie und steigende untere Trendlinie, die konvergieren.',
                        'Volumen nimmt während der Bildung ab und steigt beim Ausbruch nach oben.'
                    ],
                    trading: 'Ein Kaufsignal entsteht beim Ausbruch über die obere Trendlinie.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Mittel bis hoch, wenn der vorherige Trend stark war und der Ausbruch mit Volumen erfolgt.<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Long nach dem Ausbruch über die obere Dreieckslinie. SL: Unterhalb der oberen Dreieckslinie oder unter dem letzten Tiefpunkt innerhalb des Dreiecks. TP: Höhe des Dreiecks (breiteste Stelle) vom Ausbruchspunkt nach oben projiziert.',
                    advancedConsiderations: '<strong>Ausbruchsrichtung:</strong> Obwohl als Fortsetzungsmuster klassifiziert, ist die Ausbruchsrichtung bei symmetrischen Dreiecken weniger vorhersagbar als bei auf- oder absteigenden Dreiecken. Warten auf Bestätigung ist entscheidend.',
                    performanceStats: 'Als Fortsetzungsmuster ist die Zuverlässigkeit gut, wenn der Ausbruch in Richtung des vorherigen Trends erfolgt.',
                    drawFunction: (ctx, w, h) => { 
                        // Vorheriger Aufwärtstrend
                        drawLine(ctx, w * 0.05, h * 0.85, w * 0.15, h * 0.6, '#22c55e', 2, 'Vorheriger Aufwärtstrend');

                        const apexX = w * 0.75;
                        const upperStartY = h * 0.4;
                        const lowerStartY = h * 0.8;
                        const midYApex = (upperStartY + lowerStartY) / 2 * 0.9; // Apex etwas höher für bullische Tendenz

                        drawLineWithLabel(ctx, w,h, w * 0.15, upperStartY, apexX, midYApex, '#e5e7eb', 2, 'Fallender Widerstand');
                        drawLineWithLabel(ctx, w,h, w * 0.15, lowerStartY, apexX, midYApex, '#e5e7eb', 2, 'Steigende Unterstützung');

                        ctx.beginPath();
                        ctx.moveTo(w * 0.18, lowerStartY * 0.98);
                        ctx.lineTo(w * 0.3, upperStartY * 1.05);
                        ctx.lineTo(w * 0.42, lowerStartY * 0.9);
                        ctx.lineTo(w * 0.55, upperStartY * 1.1);
                        ctx.strokeStyle = '#60a5fa'; ctx.lineWidth = 1.5; ctx.stroke();
                        addTooltipToPath(ctx.getCurrentPath ? ctx.getCurrentPath() : null, 'Konsolidierung');

                        drawArrow(ctx, apexX * 0.9, midYApex - h*0.02, apexX + w*0.1, midYApex - h*0.2, '#22c55e', 2, 'Bullischer Ausbruch');
                        drawText(ctx, 'Fortsetzung', apexX + w*0.05, midYApex - h*0.2 -10, '#22c55e');
                    }
                },
                {
                    id: 'symmetricalTriangleContinuationBearish',
                    name: 'Symmetr. Dreieck (Forts. Bärisch)',
                    description: 'Ein symmetrisches Dreieck kann auch als Fortsetzungsmuster auftreten. In einem Abwärtstrend deutet ein Ausbruch nach unten auf eine Fortsetzung des Trends hin.',
                    characteristics: [
                        'Vorhergehender Abwärtstrend.',
                        'Fallende obere Trendlinie und steigende untere Trendlinie, die konvergieren.',
                        'Volumen nimmt während der Bildung ab und steigt beim Ausbruch nach unten.'
                    ],
                    trading: 'Ein Verkaufssignal entsteht beim Ausbruch unter die untere Trendlinie.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Mittel bis hoch, wenn der vorherige Trend stark war und der Ausbruch mit Volumen erfolgt.<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Short nach dem Ausbruch unter die untere Dreieckslinie. SL: Oberhalb der unteren Dreieckslinie oder über dem letzten Hochpunkt innerhalb des Dreiecks. TP: Höhe des Dreiecks (breiteste Stelle) vom Ausbruchspunkt nach unten projiziert.',
                    advancedConsiderations: '<strong>Ausbruchsrichtung:</strong> Wie bei der bullischen Variante, Bestätigung des Ausbruchs abwarten.',
                    performanceStats: 'Als Fortsetzungsmuster ist die Zuverlässigkeit gut, wenn der Ausbruch in Richtung des vorherigen Trends erfolgt.',
                     drawFunction: (ctx, w, h) => { 
                        // Vorheriger Abwärtstrend
                        drawLine(ctx, w * 0.05, h * 0.15, w * 0.15, h * 0.4, '#ef4444', 2, 'Vorheriger Abwärtstrend');
                        
                        const apexX = w * 0.75;
                        const upperStartY = h * 0.2;
                        const lowerStartY = h * 0.6;
                        const midYApex = (upperStartY + lowerStartY) / 2 * 1.1; // Apex etwas tiefer für bärische Tendenz

                        drawLineWithLabel(ctx, w,h, w * 0.15, upperStartY, apexX, midYApex, '#e5e7eb', 2, 'Fallender Widerstand');
                        drawLineWithLabel(ctx, w,h, w * 0.15, lowerStartY, apexX, midYApex, '#e5e7eb', 2, 'Steigende Unterstützung');

                        ctx.beginPath();
                        ctx.moveTo(w * 0.18, upperStartY * 1.02);
                        ctx.lineTo(w * 0.3, lowerStartY * 0.95);
                        ctx.lineTo(w * 0.42, upperStartY * 1.1);
                        ctx.lineTo(w * 0.55, lowerStartY * 0.9);
                        ctx.strokeStyle = '#f87171'; ctx.lineWidth = 1.5; ctx.stroke();
                        addTooltipToPath(ctx.getCurrentPath ? ctx.getCurrentPath() : null, 'Konsolidierung');

                        drawArrow(ctx, apexX*0.9, midYApex + h*0.02, apexX + w*0.1, midYApex + h*0.2, '#ef4444', 2, 'Bärischer Ausbruch');
                        drawText(ctx, 'Fortsetzung', apexX + w*0.05, midYApex + h*0.2 + 15, '#ef4444');
                    }
                },
                {
                    id: 'bullFlag',
                    name: 'Bullische Flagge',
                    description: 'Eine bullische Flagge ist eine kurzfristige Fortsetzungsformation, die nach einem starken Aufwärtstrend (dem Flaggenmast) auftritt. Die Flagge selbst ist ein kleiner, nach unten geneigter Konsolidierungskanal.',
                    characteristics: [ 'Starker, schneller Anstieg (Flaggenmast).', 'Konsolidierungsphase in Form eines leicht abwärts geneigten Rechtecks oder Parallelogramms (Flagge).', 'Volumen nimmt während der Flaggenbildung ab und steigt beim Ausbruch.'],
                    trading: 'Ein Kaufsignal entsteht, wenn der Kurs über die obere Begrenzung der Flagge ausbricht. Das Kursziel wird oft durch Addieren der Höhe des Flaggenmasts zum Ausbruchspunkt bestimmt.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Hoch, da es eine kurze Pause in einem starken Trend darstellt.<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Long-Position beim Ausbruch über die obere Flaggenlinie. SL: Unterhalb der unteren Flaggenlinie oder unter dem Ausbruchspunkt. TP: Höhe des Flaggenmasts, addiert zum Ausbruchspunkt.',
                    advancedConsiderations: '<strong>Dauer der Flagge:</strong> Idealerweise kurz (wenige Tage bis wenige Wochen). Zu lange Konsolidierungen können die Aussagekraft schwächen.<br><strong>Neigung:</strong> Leicht abwärts geneigt ist typisch. Eine horizontale Flagge ist auch möglich (dann eher ein Rechteck).',
                    performanceStats: 'Flaggen und Wimpel gehören zu den zuverlässigsten Fortsetzungsformationen. Die Erfolgsquote ist oft hoch, wenn sie in starken Trends auftreten.',
                    drawFunction: (ctx, w, h) => { 
                        const mastBottomX = w * 0.2; const mastBottomY = h * 0.9;
                        const mastTopX = w * 0.2; const mastTopY = h * 0.2;
                        drawLineWithLabel(ctx, w, h, mastBottomX, mastBottomY, mastTopX, mastTopY, '#22c55e', 3, 'Flaggenmast');
                        const flagTopLeftX = mastTopX; const flagTopLeftY = mastTopY;
                        const flagTopRightX = w * 0.5; const flagTopRightY = h * 0.3;
                        const flagBottomLeftX = mastTopX + (w*0.05); const flagBottomLeftY = mastTopY + (h*0.2);
                        const flagBottomRightX = flagTopRightX + (w*0.05); const flagBottomRightY = flagTopRightY + (h*0.2);
                        drawLineWithLabel(ctx, w, h, flagTopLeftX, flagTopLeftY, flagTopRightX, flagTopRightY, '#a3e635', 2, 'Obere Flaggenlinie');
                        drawLineWithLabel(ctx, w, h, flagBottomLeftX, flagBottomLeftY, flagBottomRightX, flagBottomRightY, '#a3e635', 2, 'Untere Flaggenlinie');
                        drawLine(ctx, flagTopLeftX, flagTopLeftY, flagBottomLeftX, flagBottomLeftY, '#a3e635', 1);
                        drawLine(ctx, flagTopRightX, flagTopRightY, flagBottomRightX, flagBottomRightY, '#a3e635', 1);
                        ctx.beginPath(); ctx.moveTo(flagTopLeftX + 5, flagTopLeftY + 5); ctx.lineTo(flagBottomLeftX + 5, flagBottomLeftY - 5); ctx.lineTo(flagTopLeftX + 25, flagTopLeftY + 15); ctx.lineTo(flagBottomLeftX + 25, flagBottomLeftY - 15); ctx.strokeStyle = '#60a5fa'; ctx.lineWidth = 1.5; ctx.stroke(); addTooltipToPath(ctx.getCurrentPath ? ctx.getCurrentPath() : null, 'Konsolidierung');
                        drawArrow(ctx, flagTopRightX, flagTopRightY, flagTopRightX + w*0.1, flagTopRightY - h*0.15, '#22c55e', 2, 'Ausbruchsrichtung');
                        drawText(ctx, 'Ausbruch', flagTopRightX + w*0.1, flagTopRightY - h*0.15 - 10, '#22c55e');
                    }
                },
                {
                    id: 'bearFlag',
                    name: 'Bärische Flagge',
                    description: 'Eine bärische Flagge ist eine kurzfristige Fortsetzungsformation, die nach einem starken Abwärtstrend (dem Flaggenmast) auftritt. Die Flagge selbst ist ein kleiner, nach oben geneigter Konsolidierungskanal.',
                    characteristics: [ 'Starker, schneller Abfall (Flaggenmast).', 'Konsolidierungsphase in Form eines leicht aufwärts geneigten Rechtecks oder Parallelogramms (Flagge).', 'Volumen nimmt während der Flaggenbildung ab und steigt beim Ausbruch.'],
                    trading: 'Ein Verkaufssignal entsteht, wenn der Kurs unter die untere Begrenzung der Flagge ausbricht. Das Kursziel wird oft durch Subtrahieren der Höhe des Flaggenmasts vom Ausbruchspunkt bestimmt.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Hoch.<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Short-Position beim Ausbruch unter die untere Flaggenlinie. SL: Oberhalb der oberen Flaggenlinie oder über dem Ausbruchspunkt. TP: Höhe des Flaggenmasts, subtrahiert vom Ausbruchspunkt.',
                    advancedConsiderations: '<strong>Dauer und Neigung:</strong> Analog zur bullischen Flagge, aber die Flagge ist leicht aufwärts geneigt.',
                    performanceStats: 'Analog zur bullischen Flagge.',
                    drawFunction: (ctx, w, h) => { 
                        const mastTopX = w * 0.2; const mastTopY = h * 0.1;
                        const mastBottomX = w * 0.2; const mastBottomY = h * 0.8;
                        drawLineWithLabel(ctx, w, h, mastTopX, mastTopY, mastBottomX, mastBottomY, '#ef4444', 3, 'Flaggenmast');
                        const flagBottomLeftX = mastBottomX; const flagBottomLeftY = mastBottomY;
                        const flagBottomRightX = w * 0.5; const flagBottomRightY = h * 0.7;
                        const flagTopLeftX = mastBottomX + (w*0.05); const flagTopLeftY = mastBottomY - (h*0.2);
                        const flagTopRightX = flagBottomRightX + (w*0.05); const flagTopRightY = flagBottomRightY - (h*0.2);
                        drawLineWithLabel(ctx, w, h, flagBottomLeftX, flagBottomLeftY, flagBottomRightX, flagBottomRightY, '#fca5a5', 2, 'Untere Flaggenlinie');
                        drawLineWithLabel(ctx, w, h, flagTopLeftX, flagTopLeftY, flagTopRightX, flagTopRightY, '#fca5a5', 2, 'Obere Flaggenlinie');
                        drawLine(ctx, flagBottomLeftX, flagBottomLeftY, flagTopLeftX, flagTopLeftY, '#fca5a5', 1);
                        drawLine(ctx, flagBottomRightX, flagBottomRightY, flagTopRightX, flagTopRightY, '#fca5a5', 1);
                        ctx.beginPath(); ctx.moveTo(flagBottomLeftX + 5, flagBottomLeftY - 5); ctx.lineTo(flagTopLeftX + 5, flagTopLeftY + 5); ctx.lineTo(flagBottomLeftX + 25, flagBottomLeftY - 15); ctx.lineTo(flagTopLeftX + 25, flagTopLeftY + 15); ctx.strokeStyle = '#f87171'; ctx.lineWidth = 1.5; ctx.stroke(); addTooltipToPath(ctx.getCurrentPath ? ctx.getCurrentPath() : null, 'Konsolidierung');
                        drawArrow(ctx, flagBottomRightX, flagBottomRightY, flagBottomRightX + w*0.1, flagBottomRightY + h*0.15, '#ef4444', 2, 'Ausbruchsrichtung');
                        drawText(ctx, 'Ausbruch', flagBottomRightX + w*0.1, flagBottomRightY + h*0.15 + 10, '#ef4444');
                    }
                },
                {
                    id: 'cupAndHandle',
                    name: 'Tasse mit Henkel',
                    description: 'Die "Tasse mit Henkel" ist eine bullische Fortsetzungsformation, die eine Konsolidierungsphase gefolgt von einem Ausbruch nach oben signalisiert. Die "Tasse" hat eine abgerundete U-Form, und der "Henkel" ist eine kleinere, oft leicht abwärts gerichtete Konsolidierung.',
                    characteristics: [ 'Vorhergehender Aufwärtstrend.', 'Die "Tasse" bildet sich als abgerundeter Boden, ähnlich einer Schüssel.', 'Der "Henkel" ist eine kleinere Konsolidierung rechts von der Tasse, typischerweise nicht tiefer als 50% der Tassenhöhe.', 'Widerstandslinie am oberen Rand der Tasse.', 'Volumen nimmt oft während der Tassenbildung ab und steigt beim Ausbruch aus dem Henkel.'],
                    trading: 'Ein Kaufsignal entsteht, wenn der Kurs über die Widerstandslinie des Henkels (und idealerweise der Tasse) ausbricht. Das Kursziel wird oft durch Messen der Tiefe der Tasse und Addieren zum Ausbruchspunkt bestimmt.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Hoch, gilt als zuverlässiges Fortsetzungsmuster.<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Long-Position beim Ausbruch über die Oberkante des Henkels. SL: Unterhalb des Henkeltiefs. TP: Tiefe der Tasse, addiert zum Ausbruchspunkt am Tassenrand.',
                    advancedConsiderations: '<strong>Henkel-Tiefe:</strong> Der Henkel sollte idealerweise nicht mehr als ein Drittel bis die Hälfte der Tassentiefe korrigieren. Ein zu tiefer Henkel schwächt das Muster.<br><strong>Dauer:</strong> Die Tasse kann sich über mehrere Wochen oder Monate bilden, der Henkel ist meist kürzer.',
                    performanceStats: 'Gilt als eines der zuverlässigeren bullischen Fortsetzungsmuster, besonders wenn der Henkel nicht zu tief korrigiert und der Ausbruch mit Volumen erfolgt.',
                    drawFunction: (ctx, w, h) => { 
                        const cupRimY = h * 0.3; const cupBottomY = h * 0.7;
                        const cupWidth = w * 0.6; const cupCenterX = w * 0.4;
                        ctx.beginPath(); ctx.moveTo(cupCenterX - cupWidth / 2, cupRimY); ctx.quadraticCurveTo(cupCenterX, cupBottomY + h*0.1, cupCenterX + cupWidth / 2, cupRimY); ctx.strokeStyle = '#60a5fa'; ctx.lineWidth = 2; ctx.stroke(); addTooltipToPath(ctx.getCurrentPath ? ctx.getCurrentPath() : null, 'Tasse');
                        drawLineWithLabel(ctx, w, h, cupCenterX - cupWidth / 2, cupRimY, cupCenterX + cupWidth / 2 + w*0.15, cupRimY, '#e5e7eb', 1.5, 'Widerstand');
                        const handleStartX = cupCenterX + cupWidth / 2; const handleStartY = cupRimY;
                        const handleEndX = handleStartX + w * 0.15; const handleEndY = cupRimY + h * 0.1;
                        const handleDipX = handleStartX + w * 0.075; const handleDipY = cupRimY + h * 0.15;
                        ctx.beginPath(); ctx.moveTo(handleStartX, handleStartY); ctx.lineTo(handleDipX - w*0.02, handleDipY - h*0.03); ctx.quadraticCurveTo(handleDipX, handleDipY, handleEndX - w*0.02, handleEndY + h*0.01); ctx.lineTo(handleEndX, handleEndY); ctx.strokeStyle = '#a3e635'; ctx.lineWidth = 2; ctx.stroke(); addTooltipToPath(ctx.getCurrentPath ? ctx.getCurrentPath() : null, 'Henkel');
                        drawText(ctx, 'Tasse', cupCenterX, cupBottomY - 10, '#60a5fa');
                        drawText(ctx, 'Henkel', handleDipX, handleDipY + 15, '#a3e635');
                        const breakoutX = handleEndX; const breakoutY = cupRimY;
                        drawArrow(ctx, breakoutX, breakoutY, breakoutX + w*0.1, breakoutY - h*0.15, '#22c55e', 2, 'Ausbruchsrichtung');
                        drawText(ctx, 'Ausbruch', breakoutX + w*0.05, breakoutY - h*0.15 -10, '#22c55e');
                    }
                },
                {
                     id: 'invertedCupAndHandleContinuation', // Angepasste ID
                     name: 'Invertierte Tasse mit Henkel (Fortsetzung)',
                    description: 'Die invertierte Tasse mit Henkel als Fortsetzungsmuster ist eine bärische Formation, die inmitten eines Abwärtstrends auftritt. Sie signalisiert eine temporäre Konsolidierung, bevor der übergeordnete Abwärtstrend wieder aufgenommen wird.',
                    characteristics: ['Tritt inmitten eines etablierten Abwärtstrends auf.', // Unterschied
                    'Die "Tasse" bildet sich als abgerundetes Hoch und stellt eine Konsolidierungs- oder Distributionsphase dar, bevor der Trend fortgesetzt wird.',
                    'Der "Henkel" ist eine kleinere, oft leicht aufwärts oder seitwärts gerichtete Konsolidierung (Gegenbewegung) auf der rechten Seite der Tasse. Der Henkel sollte idealerweise nicht über das obere Drittel der Tassenhöhe hinausragen und ein geringeres Volumen aufweisen.',
                    'Eine Unterstützungslinie kann am unteren Rand des Henkels und/oder der Tasse identifiziert werden.',
                    'Das Volumen ist oft während der Bildung des Tassenhochs und des Henkels rückläufig und steigt beim bärischen Ausbruch unter die Unterstützungslinie des Henkels wieder an, was die Fortsetzung des Abwärtstrends bestätigt.'],
                    trading: 'Ein Verkaufssignal zur Fortsetzung des Abwärtstrends entsteht, wenn der Kurs unter die Unterstützungslinie des Henkels (und idealerweise der Tasse) ausbricht, insbesondere bei erhöhtem Volumen. Das Kursziel wird oft durch Messen der Höhe der Tasse und Subtrahieren dieses Wertes vom Ausbruchspunkt bestimmt.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Mittel bis hoch, wenn der übergeordnete Abwärtstrend stark ist und der Ausbruch die Trendrichtung bestätigt.<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Short-Position beim oder nach dem Ausbruch unter die Unterkante des Henkels/Tassenrandes. SL: Oberhalb des Henkelhochs oder knapp über der durchbrochenen Unterstützungslinie. TP: Mindestens die Höhe der Tasse, vom Ausbruchspunkt nach unten projiziert, oft auch Fortsetzung des vorherigen Abwärtsimpulses.',
                    advancedConsiderations: '<strong>Kontext als Fortsetzungsmuster:</strong> In diesem Szenario stellt das Muster eine Pause oder Konsolidierung im bestehenden Abwärtstrend dar. Der Markt sammelt neue Kräfte für die nächste Abwärtsbewegung. Der "Henkel" zeigt oft eine schwache Erholung oder einen gescheiterten Versuch der Käufer, den Trend zu wenden, bevor die bärische Dominanz zurückkehrt und den ursprünglichen Trend fortsetzt.', 
                    performanceStats: 'Die Zuverlässigkeit als Fortsetzungsmuster ist oft gut, da es im Einklang mit dem etablierten Trend gehandelt wird. Eine Bestätigung durch Volumen beim Ausbruch ist dennoch wichtig.',
                    drawFunction: (ctx, w, h) => { 
                        const cupRimY = h * 0.7; // Unterer Rand der Tasse
                        const cupTopY = h * 0.3;  // Oberer Punkt der Tasse
                        const cupWidth = w * 0.6;
                        const cupCenterX = w * 0.4;

                        // Invertierte Tasse (abgerundetes Hoch)
                        ctx.beginPath();
                        ctx.moveTo(cupCenterX - cupWidth / 2, cupRimY);
                        ctx.quadraticCurveTo(cupCenterX, cupTopY - h*0.1, cupCenterX + cupWidth / 2, cupRimY);
                        ctx.strokeStyle = '#f87171'; // Rötlich für bärisch
                        ctx.lineWidth = 2;
                        ctx.stroke();
                        addTooltipToPath(ctx.getCurrentPath ? ctx.getCurrentPath() : null, 'Invertierte Tasse');

                        // Unterstützungslinie der Tasse
                        drawLineWithLabel(ctx, w, h, cupCenterX - cupWidth / 2, cupRimY, cupCenterX + cupWidth / 2 + w*0.15, cupRimY, '#e5e7eb', 1.5, 'Unterstützung');

                        // Henkel (leicht aufwärts)
                        const handleStartX = cupCenterX + cupWidth / 2;
                        const handleStartY = cupRimY;
                        const handleEndX = handleStartX + w * 0.15;
                        const handleEndY = cupRimY - h * 0.1; // Leicht aufwärts
                        const handlePeakX = handleStartX + w * 0.075;
                        const handlePeakY = cupRimY - h * 0.15; // Höchster Punkt des Henkels

                        ctx.beginPath();
                        ctx.moveTo(handleStartX, handleStartY);
                        ctx.lineTo(handlePeakX - w*0.02, handlePeakY + h*0.03); 
                        ctx.quadraticCurveTo(handlePeakX, handlePeakY, handleEndX - w*0.02, handleEndY - h*0.01); 
                        ctx.lineTo(handleEndX, handleEndY); 
                        ctx.strokeStyle = '#fca5a5'; // Hellrot für Henkel
                        ctx.lineWidth = 2;
                        ctx.stroke();
                        addTooltipToPath(ctx.getCurrentPath ? ctx.getCurrentPath() : null, 'Henkel');

                        drawText(ctx, 'Inv. Tasse', cupCenterX, cupTopY + 10, '#f87171');
                        drawText(ctx, 'Henkel', handlePeakX, handlePeakY - 15, '#fca5a5');

                        // Ausbruch
                        const breakoutX = handleEndX;
                        const breakoutY = cupRimY; 
                        drawArrow(ctx, breakoutX, breakoutY, breakoutX + w*0.1, breakoutY + h*0.15, '#ef4444', 2, 'Ausbruchsrichtung');
                        drawText(ctx, 'Ausbruch', breakoutX + w*0.05, breakoutY + h*0.15 +10, '#ef4444');
                    }
                },
                {
                    id: 'bullishPennant',
                    name: 'Bullischer Wimpel',
                    description: 'Ein bullischer Wimpel ist eine kurzfristige Fortsetzungsformation, die nach einem starken Aufwärtstrend (Flaggenmast) auftritt. Der Wimpel selbst ist eine kleine Konsolidierung in Form eines symmetrischen Dreiecks.',
                    characteristics: [
                        'Starker, schneller Anstieg (Flaggenmast).',
                        'Konsolidierungsphase in Form eines kleinen symmetrischen Dreiecks (Wimpel).',
                        'Volumen nimmt während der Wimpelbildung ab und steigt beim Ausbruch.'
                    ],
                    trading: 'Ein Kaufsignal entsteht, wenn der Kurs über die obere Begrenzung des Wimpels ausbricht. Das Kursziel wird oft durch Addieren der Höhe des Flaggenmasts zum Ausbruchspunkt bestimmt.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Hoch.<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Long-Position beim Ausbruch über die obere Wimpellinie. SL: Unterhalb der unteren Wimpellinie. TP: Höhe des Flaggenmasts, addiert zum Ausbruchspunkt.',
                    advancedConsiderations: '<strong>Dauer:</strong> Wimpel sind typischerweise sehr kurzfristig (wenige Tage).<br><strong>Form:</strong> Die konvergierenden Linien des Wimpels sollten relativ symmetrisch sein.',
                    performanceStats: 'Wimpel sind ähnlich wie Flaggen starke Fortsetzungsmuster. Die Erfolgsrate ist tendenziell hoch.',
                    drawFunction: (ctx, w, h) => { 
                        const mastBottomX = w * 0.2; const mastBottomY = h * 0.9;
                        const mastTopX = w * 0.2; const mastTopY = h * 0.2;
                        drawLineWithLabel(ctx, w, h, mastBottomX, mastBottomY, mastTopX, mastTopY, '#22c55e', 3, 'Flaggenmast');

                        const pennantStartX = mastTopX;
                        const pennantStartY = mastTopY;
                        const pennantPointX = w * 0.5;
                        const pennantTopY = pennantStartY - h * 0.1;
                        const pennantBottomY = pennantStartY + h * 0.1;

                        drawLineWithLabel(ctx, w, h, pennantStartX, pennantStartY, pennantPointX, pennantTopY, '#a3e635', 2, 'Obere Wimpellinie');
                        drawLineWithLabel(ctx, w, h, pennantStartX, pennantStartY, pennantPointX, pennantBottomY, '#a3e635', 2, 'Untere Wimpellinie');
                        drawLine(ctx, pennantPointX, pennantTopY, pennantPointX, pennantBottomY, '#a3e635', 2); 

                        ctx.beginPath();
                        ctx.moveTo(pennantStartX + w*0.02, pennantStartY);
                        ctx.lineTo(pennantStartX + w*0.1, pennantStartY - h*0.05);
                        ctx.lineTo(pennantStartX + w*0.1, pennantStartY + h*0.05);
                        ctx.closePath();
                        ctx.strokeStyle = '#60a5fa'; ctx.lineWidth = 1.5; ctx.stroke();
                        addTooltipToPath(ctx.getCurrentPath ? ctx.getCurrentPath() : null, 'Konsolidierung');
                        
                        drawArrow(ctx, pennantPointX, pennantTopY, pennantPointX + w*0.1, pennantTopY - h*0.1, '#22c55e', 2, 'Ausbruchsrichtung');
                        drawText(ctx, 'Ausbruch', pennantPointX + w*0.1, pennantTopY - h*0.1 - 10, '#22c55e');
                    }
                },
                {
                    id: 'bearishPennant',
                    name: 'Bärischer Wimpel',
                    description: 'Ein bärischer Wimpel ist eine kurzfristige Fortsetzungsformation, die nach einem starken Abwärtstrend (Flaggenmast) auftritt. Der Wimpel selbst ist eine kleine Konsolidierung in Form eines symmetrischen Dreiecks.',
                    characteristics: [
                        'Starker, schneller Abfall (Flaggenmast).',
                        'Konsolidierungsphase in Form eines kleinen symmetrischen Dreiecks (Wimpel).',
                        'Volumen nimmt während der Wimpelbildung ab und steigt beim Ausbruch.'
                    ],
                    trading: 'Ein Verkaufssignal entsteht, wenn der Kurs unter die untere Begrenzung des Wimpels ausbricht. Das Kursziel wird oft durch Subtrahieren der Höhe des Flaggenmasts vom Ausbruchspunkt bestimmt.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Hoch.<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Short-Position beim Ausbruch unter die untere Wimpellinie. SL: Oberhalb der oberen Wimpellinie. TP: Höhe des Flaggenmasts, subtrahiert vom Ausbruchspunkt.',
                    advancedConsiderations: '<strong>Dauer und Form:</strong> Analog zum bullischen Wimpel.',
                    performanceStats: 'Analog zum bullischen Wimpel.',
                    drawFunction: (ctx, w, h) => { 
                        const mastTopX = w * 0.2; const mastTopY = h * 0.1;
                        const mastBottomX = w * 0.2; const mastBottomY = h * 0.8;
                        drawLineWithLabel(ctx, w, h, mastTopX, mastTopY, mastBottomX, mastBottomY, '#ef4444', 3, 'Flaggenmast');

                        const pennantStartX = mastBottomX;
                        const pennantStartY = mastBottomY;
                        const pennantPointX = w * 0.5;
                        const pennantTopY = pennantStartY - h * 0.1;
                        const pennantBottomY = pennantStartY + h * 0.1;

                        drawLineWithLabel(ctx, w, h, pennantStartX, pennantStartY, pennantPointX, pennantTopY, '#fca5a5', 2, 'Obere Wimpellinie');
                        drawLineWithLabel(ctx, w, h, pennantStartX, pennantStartY, pennantPointX, pennantBottomY, '#fca5a5', 2, 'Untere Wimpellinie');
                        drawLine(ctx, pennantPointX, pennantTopY, pennantPointX, pennantBottomY, '#fca5a5', 2);

                        ctx.beginPath();
                        ctx.moveTo(pennantStartX + w*0.02, pennantStartY);
                        ctx.lineTo(pennantStartX + w*0.1, pennantStartY - h*0.05);
                        ctx.lineTo(pennantStartX + w*0.1, pennantStartY + h*0.05);
                        ctx.closePath();
                        ctx.strokeStyle = '#f87171'; ctx.lineWidth = 1.5; ctx.stroke();
                        addTooltipToPath(ctx.getCurrentPath ? ctx.getCurrentPath() : null, 'Konsolidierung');

                        drawArrow(ctx, pennantPointX, pennantBottomY, pennantPointX + w*0.1, pennantBottomY + h*0.1, '#ef4444', 2, 'Ausbruchsrichtung');
                        drawText(ctx, 'Ausbruch', pennantPointX + w*0.1, pennantBottomY + h*0.1 + 10, '#ef4444');
                    }
                },
                {
                    id: 'ascendingChannel',
                    name: 'Aufsteigender Kanal',
                    description: 'Ein aufsteigender Kanal wird durch zwei parallele, aufwärts gerichtete Trendlinien gebildet. Die obere Linie verbindet die Hochs (Widerstand), die untere Linie die Tiefs (Unterstützung). Er signalisiert einen stetigen Aufwärtstrend.',
                    characteristics: [
                        'Zwei parallele, aufwärts geneigte Trendlinien.',
                        'Der Kurs bewegt sich zwischen diesen Linien auf und ab.',
                        'Jedes neue Hoch ist höher als das vorherige, jedes neue Tief ist höher als das vorherige (HH, HL).',
                        'Signalisiert einen gesunden Aufwärtstrend.'
                    ],
                    trading: 'Trades können in Richtung des Trends (Long) an der unteren Kanallinie oder bei Ausbrüchen über die obere Kanallinie (mit Vorsicht, da dies eine Übertreibung sein kann) erfolgen. Ein Bruch der unteren Kanallinie kann eine Trendumkehr signalisieren.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Hoch für Trades in Trendrichtung innerhalb des Kanals. Mittel für Ausbruchstrades.<br><strong>Tradingeinstieg mit TP und SL:</strong> Long-Einstieg: Nahe der unteren Kanallinie mit Bestätigung (z.B. bullische Kerze). SL: Unterhalb der unteren Kanallinie. TP: Nahe der oberen Kanallinie. Short-Einstieg (bei Bruch): Nach bestätigtem Bruch der unteren Kanallinie. SL: Über der gebrochenen Unterstützungslinie. TP: Basierend auf der Kanalbreite oder vorherigen Unterstützungsniveaus.',
                    advancedConsiderations: '<strong>Kanalbreite:</strong> Die Breite des Kanals kann Hinweise auf die Volatilität geben.<br><strong>Fehlausbrüche:</strong> Ein Fehlausbruch aus dem Kanal kann ein starkes Umkehrsignal sein.',
                    performanceStats: 'Kanäle sind grundlegende Trendinstrumente. Trades innerhalb des Kanals in Trendrichtung haben oft eine höhere Erfolgswahrscheinlichkeit als Trades gegen den Trend oder auf Ausbrüche.',
                    drawFunction: (ctx, w, h) => { 
                        const channelTopStartY = h * 0.3, channelTopEndY = h * 0.1;
                        const channelBottomStartY = h * 0.7, channelBottomEndY = h * 0.5;
                        const startX = w * 0.1, endX = w * 0.9;

                        drawLineWithLabel(ctx, w, h, startX, channelTopStartY, endX, channelTopEndY, '#e5e7eb', 2, 'Oberer Kanalrand (Widerstand)');
                        drawLineWithLabel(ctx, w, h, startX, channelBottomStartY, endX, channelBottomEndY, '#e5e7eb', 2, 'Unterer Kanalrand (Unterstützung)');

                        // Kursbewegung andeuten
                        ctx.beginPath();
                        ctx.moveTo(startX + w*0.05, channelBottomStartY - h*0.03);
                        ctx.lineTo(startX + w*0.2, channelTopStartY + h*0.03);
                        ctx.lineTo(startX + w*0.35, channelBottomStartY - h*0.08);
                        ctx.lineTo(startX + w*0.5, channelTopStartY - h*0.02);
                        ctx.lineTo(startX + w*0.65, channelBottomEndY + h*0.03);
                        ctx.lineTo(startX + w*0.8, channelTopEndY + h*0.05);
                        ctx.strokeStyle = '#22c55e'; ctx.lineWidth = 1.5; ctx.stroke();
                        addTooltipToPath(ctx.getCurrentPath ? ctx.getCurrentPath() : null, 'Kurs im Kanal');

                        drawArrow(ctx, endX*0.9, channelTopEndY, endX*0.9, channelTopEndY - h*0.1, '#22c55e', 1.5, 'Mögl. Fortsetzung');
                        drawArrow(ctx, endX*0.7, channelBottomEndY, endX*0.7, channelBottomEndY + h*0.1, '#ef4444', 1.5, 'Mögl. Bruch');
                    }
                },
                {
                    id: 'descendingChannel',
                    name: 'Absteigender Kanal',
                    description: 'Ein absteigender Kanal wird durch zwei parallele, abwärts gerichtete Trendlinien gebildet. Die obere Linie verbindet die Tiefs (Unterstützung), die untere Linie die Hochs (Widerstand). Er signalisiert einen stetigen Abwärtstrend.',
                    characteristics: [
                        'Zwei parallele, abwärts geneigte Trendlinien.',
                        'Der Kurs bewegt sich zwischen diesen Linien auf und ab.',
                        'Jedes neue Tief ist tiefer als das vorherige, jedes neue Hoch ist tiefer als das vorherige (LH, LL).',
                        'Signalisiert einen gesunden Abwärtstrend.'
                    ],
                    trading: 'Trades können in Richtung des Trends (Short) an der oberen Kanallinie oder bei Ausbrüchen unter die untere Kanallinie (mit Vorsicht) erfolgen. Ein Bruch der oberen Kanallinie kann eine Trendumkehr signalisieren.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Hoch für Trades in Trendrichtung innerhalb des Kanals.<br><strong>Tradingeinstieg mit TP und SL:</strong> Short-Einstieg: Nahe der oberen Kanallinie mit Bestätigung (z.B. bärische Kerze). SL: Oberhalb der oberen Kanallinie. TP: Nahe der unteren Kanallinie. Long-Einstieg (bei Bruch): Nach bestätigtem Bruch der oberen Kanallinie. SL: Unter der gebrochenen Widerstandslinie. TP: Basierend auf der Kanalbreite oder vorherigen Widerstandsniveaus.',
                    advancedConsiderations: '<strong>Kanalbreite und Fehlausbrüche:</strong> Analog zum aufsteigenden Kanal.',
                    performanceStats: 'Ähnlich wie aufsteigende Kanäle, aber für Abwärtstrends.',
                    drawFunction: (ctx, w, h) => { 
                        const channelTopStartY = h * 0.1, channelTopEndY = h * 0.3;
                        const channelBottomStartY = h * 0.5, channelBottomEndY = h * 0.7;
                        const startX = w * 0.1, endX = w * 0.9;

                        drawLineWithLabel(ctx, w, h, startX, channelTopStartY, endX, channelTopEndY, '#e5e7eb', 2, 'Oberer Kanalrand (Widerstand)');
                        drawLineWithLabel(ctx, w, h, startX, channelBottomStartY, endX, channelBottomEndY, '#e5e7eb', 2, 'Unterer Kanalrand (Unterstützung)');

                        ctx.beginPath();
                        ctx.moveTo(startX + w*0.05, channelTopStartY + h*0.03);
                        ctx.lineTo(startX + w*0.2, channelBottomStartY - h*0.03);
                        ctx.lineTo(startX + w*0.35, channelTopStartY + h*0.08);
                        ctx.lineTo(startX + w*0.5, channelBottomStartY - h*0.02);
                        ctx.lineTo(startX + w*0.65, channelTopEndY + h*0.03);
                        ctx.lineTo(startX + w*0.8, channelBottomEndY - h*0.05);
                        ctx.strokeStyle = '#ef4444'; ctx.lineWidth = 1.5; ctx.stroke();
                        addTooltipToPath(ctx.getCurrentPath ? ctx.getCurrentPath() : null, 'Kurs im Kanal');
                        
                        drawArrow(ctx, endX*0.9, channelBottomEndY, endX*0.9, channelBottomEndY + h*0.1, '#ef4444', 1.5, 'Mögl. Fortsetzung');
                        drawArrow(ctx, endX*0.7, channelTopEndY, endX*0.7, channelTopEndY - h*0.1, '#22c55e', 1.5, 'Mögl. Bruch');
                    }
                },
                {
                    id: 'rectangleContinuationBullish',
                    name: 'Rechteck (Forts. Bullisch)',
                    description: 'Ein Rechteck kann als bullische Fortsetzungsformation auftreten, wenn es sich nach einem Aufwärtstrend bildet und der Kurs anschließend nach oben ausbricht.',
                    characteristics: [
                        'Vorhergehender Aufwärtstrend.',
                        'Zwei parallele horizontale Trendlinien (Widerstand oben, Unterstützung unten).',
                        'Kurs konsolidiert seitwärts zwischen den Linien.',
                        'Ausbruch nach oben mit erhöhtem Volumen.'
                    ],
                    trading: 'Ein Kaufsignal entsteht beim Ausbruch über die obere Widerstandslinie des Rechtecks.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Hoch, wenn der vorherige Trend stark war und der Ausbruch überzeugend ist.<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Long nach dem Ausbruch über die Widerstandslinie. SL: Unterhalb der Widerstandslinie (die nun Unterstützung ist) oder in der Mitte des Rechtecks. TP: Höhe des Rechtecks, addiert zum Ausbruchspunkt.',
                    advancedConsiderations: '<strong>Dauer:</strong> Längere Rechtecke können stärkere Ausbrüche signalisieren, aber auch das Risiko von Fehlausbrüchen erhöhen, wenn die Konsolidierung zu lange dauert.',
                    performanceStats: 'Rechtecke als Fortsetzungsformationen sind oft zuverlässig, besonders wenn der Ausbruch in Richtung des vorherigen Trends erfolgt und von Volumen unterstützt wird.',
                    drawFunction: (ctx, w, h) => {
                        const resistanceY = h * 0.4;
                        const supportY = h * 0.6;
                        const rectStartX = w * 0.25, rectEndX = w * 0.75;

                        // Vorheriger Aufwärtstrend
                        drawLine(ctx, w*0.1, h*0.8, rectStartX - w*0.02, supportY + h*0.02, '#22c55e', 2, 'Vorheriger Aufwärtstrend');

                        drawLineWithLabel(ctx, w, h, rectStartX, resistanceY, rectEndX, resistanceY, '#e5e7eb', 2, 'Widerstand');
                        drawLineWithLabel(ctx, w, h, rectStartX, supportY, rectEndX, supportY, '#e5e7eb', 2, 'Unterstützung');

                        // Kursbewegung im Rechteck
                        ctx.beginPath();
                        ctx.moveTo(rectStartX + w*0.02, supportY - h*0.02);
                        ctx.lineTo(rectStartX + w*0.1, resistanceY + h*0.02);
                        ctx.lineTo(rectStartX + w*0.2, supportY - h*0.02);
                        ctx.lineTo(rectStartX + w*0.3, resistanceY + h*0.02);
                        ctx.strokeStyle = '#60a5fa'; ctx.lineWidth = 1.5; ctx.stroke();
                        addTooltipToPath(ctx.getCurrentPath ? ctx.getCurrentPath() : null, 'Konsolidierung im Rechteck');
                        
                        drawArrow(ctx, rectEndX, resistanceY, rectEndX + w*0.1, resistanceY - h*0.15, '#22c55e', 2, 'Bullischer Ausbruch');
                        drawText(ctx, 'Fortsetzung', rectEndX + w*0.05, resistanceY - h*0.15 -10, '#22c55e');
                    }
                },
                {
                    id: 'rectangleContinuationBearish',
                    name: 'Rechteck (Forts. Bärisch)',
                    description: 'Ein Rechteck kann als bärische Fortsetzungsformation auftreten, wenn es sich nach einem Abwärtstrend bildet und der Kurs anschließend nach unten ausbricht.',
                    characteristics: [
                        'Vorhergehender Abwärtstrend.',
                        'Zwei parallele horizontale Trendlinien (Widerstand oben, Unterstützung unten).',
                        'Kurs konsolidiert seitwärts zwischen den Linien.',
                        'Ausbruch nach unten mit erhöhtem Volumen.'
                    ],
                    trading: 'Ein Verkaufssignal entsteht beim Ausbruch unter die untere Unterstützungslinie des Rechtecks.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Hoch, wenn der vorherige Trend stark war und der Ausbruch überzeugend ist.<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Short nach dem Ausbruch unter die Unterstützungslinie. SL: Oberhalb der Unterstützungslinie (die nun Widerstand ist) oder in der Mitte des Rechtecks. TP: Höhe des Rechtecks, subtrahiert vom Ausbruchspunkt.',
                    advancedConsiderations: '<strong>Dauer:</strong> Analog zur bullischen Variante.',
                    performanceStats: 'Analog zum bullischen Rechteck.',
                    drawFunction: (ctx, w, h) => {
                        const resistanceY = h * 0.4;
                        const supportY = h * 0.6;
                        const rectStartX = w * 0.25, rectEndX = w * 0.75;

                        // Vorheriger Abwärtstrend
                        drawLine(ctx, w*0.1, h*0.2, rectStartX - w*0.02, resistanceY - h*0.02, '#ef4444', 2, 'Vorheriger Abwärtstrend');

                        drawLineWithLabel(ctx, w, h, rectStartX, resistanceY, rectEndX, resistanceY, '#e5e7eb', 2, 'Widerstand');
                        drawLineWithLabel(ctx, w, h, rectStartX, supportY, rectEndX, supportY, '#e5e7eb', 2, 'Unterstützung');

                        // Kursbewegung im Rechteck
                        ctx.beginPath();
                        ctx.moveTo(rectStartX + w*0.02, resistanceY + h*0.02);
                        ctx.lineTo(rectStartX + w*0.1, supportY - h*0.02);
                        ctx.lineTo(rectStartX + w*0.2, resistanceY + h*0.02);
                        ctx.lineTo(rectStartX + w*0.3, supportY - h*0.02);
                        ctx.strokeStyle = '#f87171'; ctx.lineWidth = 1.5; ctx.stroke();
                        addTooltipToPath(ctx.getCurrentPath ? ctx.getCurrentPath() : null, 'Konsolidierung im Rechteck');
                        
                        drawArrow(ctx, rectEndX, supportY, rectEndX + w*0.1, supportY + h*0.15, '#ef4444', 2, 'Bärischer Ausbruch');
                        drawText(ctx, 'Fortsetzung', rectEndX + w*0.05, supportY + h*0.15 + 15, '#ef4444');
                    }
                }
            ],
            "Bilaterale Muster": [
                 {
                    id: 'symmetricalTriangle',
                    name: 'Symmetrisches Dreieck',
                    description: 'Ein symmetrisches Dreieck ist ein Chartmuster, bei dem sich zwei konvergierende Trendlinien bilden, wobei die obere abfällt und die untere ansteigt. Es signalisiert eine Konsolidierungsphase mit abnehmender Volatilität und kann sowohl bullisch als auch bärisch ausbrechen.',
                    characteristics: [
                        'Fallende obere Trendlinie (Widerstand).',
                        'Steigende untere Trendlinie (Unterstützung).',
                        'Die Linien konvergieren zu einer Spitze (Apex).',
                        'Volumen nimmt typischerweise während der Bildung ab und steigt beim Ausbruch stark an.'
                    ],
                    trading: 'Ein Ausbruch über die obere Trendlinie ist ein Kaufsignal, ein Ausbruch unter die untere Trendlinie ein Verkaufssignal. Das Kursziel wird oft durch Messen der breitesten Stelle des Dreiecks und Projizieren vom Ausbruchspunkt bestimmt.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Mittel bis hoch, *nachdem* die Ausbruchsrichtung mit Volumen bestätigt wurde.<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Long oder Short nach dem bestätigten Ausbruch aus dem Dreieck. SL: Auf der anderen Seite der Ausbruchslinie, innerhalb des Dreiecks. TP: Höhe des Dreiecks (breiteste Stelle) vom Ausbruchspunkt projiziert.',
                    advancedConsiderations: '<strong>Ausbruchszeitpunkt:</strong> Der Ausbruch erfolgt idealerweise zwischen der Hälfte und drei Vierteln der Strecke bis zum Apex des Dreiecks. Zu späte Ausbrüche sind oft weniger zuverlässig.',
                    performanceStats: 'Symmetrische Dreiecke sind oft Fortsetzungsmuster, können aber auch Umkehrungen signalisieren. Die Ausbruchsrichtung ist entscheidend.',
                    drawFunction: (ctx, w, h) => {
                        const apexX = w * 0.9;
                        const upperStartY = h * 0.2;
                        const lowerStartY = h * 0.8;
                        const midY = h * 0.5; 

                        drawLineWithLabel(ctx, w, h, w * 0.1, upperStartY, apexX, midY, '#e5e7eb', 2, 'Fallender Widerstand');
                        drawLineWithLabel(ctx, w, h, w * 0.1, lowerStartY, apexX, midY, '#e5e7eb', 2, 'Steigende Unterstützung');

                        ctx.beginPath();
                        ctx.moveTo(w * 0.12, lowerStartY * 0.98);
                        ctx.lineTo(w * 0.25, upperStartY * 1.1);
                        ctx.lineTo(w * 0.38, lowerStartY * 0.9);
                        ctx.lineTo(w * 0.51, upperStartY * 1.2);
                        ctx.lineTo(w * 0.64, lowerStartY * 0.82);
                        ctx.lineTo(w * 0.77, midY); 
                        ctx.strokeStyle = '#fbbf24'; 
                        ctx.lineWidth = 1.5;
                        ctx.stroke();
                        addTooltipToPath(ctx.getCurrentPath ? ctx.getCurrentPath() : null, 'Simulierte Kursbewegung');

                        drawArrow(ctx, apexX * 0.95, midY - h*0.05, apexX * 0.95, midY - h*0.2, '#22c55e', 2, 'Bullischer Ausbruch');
                        drawText(ctx, 'Ausbruch?', apexX * 0.95, midY - h*0.2 -10, '#22c55e');
                        drawArrow(ctx, apexX * 0.95, midY + h*0.05, apexX * 0.95, midY + h*0.2, '#ef4444', 2, 'Bärischer Ausbruch');
                        drawText(ctx, 'Ausbruch?', apexX * 0.95, midY + h*0.2 + 15, '#ef4444');
                    }
                },
                {
                    id: 'rectangle',
                    name: 'Rechteck (Rectangle)',
                    description: 'Ein Rechteck ist eine Konsolidierungsformation, die durch zwei parallele horizontale Linien (Unterstützung und Widerstand) begrenzt wird. Der Kurs bewegt sich seitwärts zwischen diesen Linien. Es kann sowohl eine Fortsetzung des vorherigen Trends als auch eine Umkehr signalisieren, abhängig von der Ausbruchsrichtung.',
                    characteristics: [
                        'Zwei parallele horizontale Trendlinien.',
                        'Obere Linie fungiert als Widerstand, untere als Unterstützung.',
                        'Der Kurs testet diese Linien mehrmals.',
                        'Volumen kann während der Formation abnehmen und beim Ausbruch ansteigen.'
                    ],
                    trading: 'Ein Ausbruch über die Widerstandslinie ist ein Kaufsignal. Ein Ausbruch unter die Unterstützungslinie ist ein Verkaufssignal. Das Kursziel wird oft durch die Höhe des Rechtecks bestimmt, projiziert vom Ausbruchspunkt.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Mittel bis hoch, *nachdem* die Ausbruchsrichtung mit Volumen bestätigt wurde.<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Long oder Short nach dem bestätigten Ausbruch aus dem Rechteck. SL: Auf der anderen Seite der Ausbruchslinie, innerhalb des Rechtecks. TP: Höhe des Rechtecks vom Ausbruchspunkt projiziert.',
                    advancedConsiderations: '<strong>Dauer:</strong> Rechtecke können kurz- oder langfristig sein. Längere Rechtecke können stärkere Ausbrüche nach sich ziehen.<br><strong>Fehlausbrüche ("Shakeouts"):</strong> Ein kurzer Ausbruch in eine Richtung, gefolgt von einer schnellen Umkehr und einem Ausbruch in die entgegengesetzte Richtung, kann ein starkes Signal sein.',
                    performanceStats: 'Rechtecke sind häufige Konsolidierungsmuster. Die Ausbruchsrichtung ist entscheidend für die Interpretation als Fortsetzungs- oder Umkehrmuster.',
                    drawFunction: (ctx, w, h) => {
                        const resistanceY = h * 0.3;
                        const supportY = h * 0.7;
                        const startX = w * 0.1;
                        const endX = w * 0.9;

                        drawLineWithLabel(ctx, w, h, startX, resistanceY, endX, resistanceY, '#e5e7eb', 2, 'Widerstand');
                        drawLineWithLabel(ctx, w, h, startX, supportY, endX, supportY, '#e5e7eb', 2, 'Unterstützung');

                        ctx.beginPath();
                        ctx.moveTo(startX + w*0.05, supportY - h*0.05);
                        ctx.lineTo(startX + w*0.2, resistanceY + h*0.05);
                        ctx.lineTo(startX + w*0.35, supportY - h*0.05);
                        ctx.lineTo(startX + w*0.5, resistanceY + h*0.05);
                        ctx.lineTo(startX + w*0.65, supportY - h*0.05);
                        ctx.lineTo(startX + w*0.8, resistanceY + h*0.05);
                        ctx.strokeStyle = '#fbbf24'; 
                        ctx.lineWidth = 1.5;
                        ctx.stroke();
                        addTooltipToPath(ctx.getCurrentPath ? ctx.getCurrentPath() : null, 'Simulierte Kursbewegung');

                        drawArrow(ctx, endX * 0.8, resistanceY, endX * 0.8, resistanceY - h*0.15, '#22c55e', 2, 'Bullischer Ausbruch');
                        drawText(ctx, 'Ausbruch?', endX * 0.8, resistanceY - h*0.15 -10, '#22c55e');
                        drawArrow(ctx, endX * 0.8, supportY, endX * 0.8, supportY + h*0.15, '#ef4444', 2, 'Bärischer Ausbruch');
                        drawText(ctx, 'Ausbruch?', endX * 0.8, supportY + h*0.15 + 15, '#ef4444');
                    }
                }
            ],
            "Gap-Typen": [
                {
                    id: 'commonGap',
                    name: 'Gewöhnliche Lücke (Common Gap)',
                    description: 'Eine gewöhnliche Lücke (Area Gap) tritt oft in Handelsspannen oder Bereichen geringer Marktaktivität auf und hat in der Regel keine große prognostische Bedeutung. Sie wird oft relativ schnell wieder geschlossen.',
                    characteristics: [
                        'Tritt in Konsolidierungsphasen oder trendlosen Märkten auf.',
                        'Geringes Volumen bei der Entstehung der Lücke.',
                        'Wird häufig geschlossen (Kurs kehrt zurück, um die Lücke zu füllen).',
                        'Kein starkes Signal für eine Trendfortsetzung oder -umkehr.'
                    ],
                    trading: 'Gewöhnliche Lücken bieten selten klare Handelssignale. Das Schließen der Lücke kann für kurzfristige Trades genutzt werden, ist aber nicht sehr zuverlässig.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Gering für direktionale Trades basierend auf dem Gap selbst. Mittel für Fading-Strategien (Schließen der Lücke), wenn Marktbedingungen dies unterstützen.<br><strong>Tradingeinstieg mit TP und SL:</strong> Fading-Strategie: Short bei Aufwärtslücke nahe dem Hoch der Lücke, Long bei Abwärtslücke nahe dem Tief der Lücke. SL: Jenseits des Gap-Extremums (z.B. Hoch der Kerze vor dem Gap bei Aufwärtslücke). TP: Schließen der Lücke (am anderen Rand des Gaps).',
                    advancedConsiderations: '<strong>Identifikation:</strong> Manchmal schwer von anderen Gap-Typen zu unterscheiden, bis sie geschlossen wird.',
                    performanceStats: 'Haben die höchste Wahrscheinlichkeit, geschlossen zu werden. Ihre prognostische Aussagekraft für die weitere Trendrichtung ist gering.',
                    drawFunction: (ctx, w, h) => {
                        const bodyHeight = h * 0.1;
                        const gapSize = h * 0.08;
                        const candleWidth = w * 0.05;

                        // Vorherige Kerze(n) - Konsolidierung
                        drawCandle(ctx, w*0.2, h*0.5, candleWidth, bodyHeight, '#9ca3af', 'Vorherige Konsolidierung');
                        drawCandle(ctx, w*0.3, h*0.52, candleWidth, bodyHeight*0.8, '#9ca3af', 'Vorherige Konsolidierung');

                        // Common Gap
                        const firstCandleTop = h*0.5 - bodyHeight/2;
                        const secondCandleBottom = firstCandleTop - gapSize;
                        const secondCandleTop = secondCandleBottom - bodyHeight;
                        
                        drawCandle(ctx, w*0.45, (firstCandleTop + secondCandleBottom)/2 - bodyHeight*0.4 , candleWidth, bodyHeight*0.8, '#9ca3af', 'Kerze vor Gap'); // Kerze vor Gap
                        
                        ctx.beginPath();
                        ctx.rect(w*0.52, secondCandleBottom, candleWidth*2, firstCandleTop - secondCandleBottom);
                        ctx.fillStyle = '#4b556333'; // Transparente Füllung für Gap Bereich
                        ctx.fill();
                        ctx.strokeStyle = '#4b5563';
                        ctx.stroke();
                        addTooltipToPath(ctx.getCurrentPath ? ctx.getCurrentPath() : null, 'Common Gap');
                        drawText(ctx, 'Common Gap', w*0.52 + candleWidth, firstCandleTop - gapSize/2, '#e5e7eb', '10px');

                        drawCandle(ctx, w*0.62, secondCandleTop + bodyHeight/2, candleWidth, bodyHeight, '#9ca3af', 'Kerze nach Gap'); // Kerze nach Gap
                        drawCandle(ctx, w*0.72, h*0.5, candleWidth, bodyHeight, '#9ca3af', 'Spätere Konsolidierung'); // Lücke wird oft geschlossen
                    }
                },
                {
                    id: 'breakawayGap',
                    name: 'Ausbruchslücke (Breakaway Gap)',
                    description: 'Eine Ausbruchslücke entsteht, wenn der Kurs mit hohem Volumen aus einer Konsolidierungsformation (z.B. Dreieck, Rechteck) oder über/unter ein wichtiges Unterstützungs-/Widerstandsniveau ausbricht. Sie signalisiert oft den Beginn eines neuen Trends.',
                    characteristics: [
                        'Tritt am Ende einer Konsolidierungsphase oder beim Bruch wichtiger Niveaus auf.',
                        'Hohes Volumen bei der Entstehung der Lücke.',
                        'Wird seltener geschlossen als Common Gaps.',
                        'Starkes Signal für den Beginn eines neuen Trends in Richtung der Lücke.'
                    ],
                    trading: 'Ein Kaufsignal (bei Aufwärtslücke) oder Verkaufssignal (bei Abwärtslücke). Die Lücke selbst kann als Unterstützungs- (Aufwärtslücke) oder Widerstandsniveau (Abwärtslücke) dienen, falls der Kurs zurückkehrt.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Hoch, besonders wenn von hohem Volumen begleitet.<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: In Richtung des Gaps, oft am Eröffnungskurs der Kerze nach dem Gap oder bei einem kleinen Pullback zum Gap-Rand (der nun Unterstützung/Widerstand ist). SL: Innerhalb oder knapp jenseits des Gaps (z.B. Mitte des Gaps oder anderer Rand des Gaps). TP: Basierend auf der Stärke des neuen Trends, oft ein Vielfaches des Risikos oder nächste signifikante Preisstruktur.',
                    advancedConsiderations: '<strong>Volumen:</strong> Ein hohes Volumen beim Gap ist ein starkes Bestätigungsmerkmal.',
                    performanceStats: 'Gilt als starkes Signal für den Beginn eines neuen Trends. Die Wahrscheinlichkeit, dass diese Lücken nicht geschlossen werden, ist höher als bei Common Gaps.',
                    drawFunction: (ctx, w, h) => {
                        const bodyHeight = h * 0.08;
                        const gapSize = h * 0.1;
                        const candleWidth = w * 0.04;
                        
                        // Konsolidierung davor
                        drawLine(ctx, w*0.1, h*0.6, w*0.4, h*0.6, '#e5e7eb', 1.5, 'Widerstandszone');
                        drawCandle(ctx, w*0.15, h*0.65, candleWidth, bodyHeight, '#9ca3af');
                        drawCandle(ctx, w*0.25, h*0.63, candleWidth, bodyHeight, '#9ca3af');
                        drawCandle(ctx, w*0.35, h*0.66, candleWidth, bodyHeight, '#9ca3af');

                        // Breakaway Gap nach oben
                        const firstCandleTop = h*0.6 - bodyHeight/2; // Oberkante der Konsolidierung
                        const gapBottom = firstCandleTop;
                        const gapTop = gapBottom - gapSize;
                        const secondCandleBottom = gapTop;
                        const secondCandleTop = secondCandleBottom - bodyHeight*1.5; // Stärkere Kerze nach Gap

                        ctx.beginPath();
                        ctx.rect(w*0.45, gapTop, candleWidth*1.5, gapSize);
                        ctx.fillStyle = '#22c55e33'; ctx.fill();
                        ctx.strokeStyle = '#22c55e'; ctx.stroke();
                        addTooltipToPath(ctx.getCurrentPath ? ctx.getCurrentPath() : null, 'Breakaway Gap');
                        drawText(ctx, 'Breakaway Gap', w*0.45 + candleWidth*0.75, gapBottom - gapSize/2, '#22c55e', '10px');
                        
                        drawCandle(ctx, w*0.55, secondCandleTop + (bodyHeight*1.5)/2, candleWidth*1.2, bodyHeight*1.5, '#22c55e', 'Starke Kerze nach Gap');
                        
                        // Trendfortsetzung
                        drawArrow(ctx, w*0.65, secondCandleTop, w*0.85, secondCandleTop - h*0.2, '#22c55e', 2, 'Neuer Aufwärtstrend');
                    }
                },
                {
                    id: 'runawayGap',
                    name: 'Fortsetzungslücke (Runaway/Measuring Gap)',
                    description: 'Eine Fortsetzungslücke (auch Messlücke) tritt inmitten eines etablierten Trends auf und signalisiert eine Beschleunigung des Trends. Sie entsteht oft bei starkem Kauf- oder Verkaufsinteresse.',
                    characteristics: [
                        'Tritt in einem bereits etablierten Trend auf.',
                        'Oft mittleres bis hohes Volumen.',
                        'Wird seltener geschlossen; wenn doch, kann es eine Trendabschwächung signalisieren.',
                        'Kann als "Messlücke" dienen: Die Distanz vom Beginn des Trends bis zur Lücke wird oft nach der Lücke nochmals zurückgelegt.'
                    ],
                    trading: 'Bestätigt die Stärke des aktuellen Trends. Einstieg in Trendrichtung. Die Lücke kann als Unterstützung (Aufwärtstrend) oder Widerstand (Abwärtstrend) dienen.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Sehr hoch für eine Trendfortsetzung.<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: In Trendrichtung, oft aggressiv bei Entstehung oder bei einem kleinen Test des Gap-Randes. SL: Innerhalb oder knapp jenseits des Gaps. TP: Oft wird das "Messprinzip" angewendet: Die Distanz vom Beginn des Trends bis zum Gap wird ab dem Gap erneut projiziert. Alternativ Trailing-Stop verwenden.',
                    advancedConsiderations: '<strong>Messprinzip:</strong> Die Distanz, die der Kurs vor dem Gap zurückgelegt hat, wird oft nach dem Gap noch einmal erreicht. Dies kann zur Zielbestimmung verwendet werden.',
                    performanceStats: 'Starke Bestätigung eines bestehenden Trends. Die Wahrscheinlichkeit, dass der Trend anhält, ist hoch.',
                    drawFunction: (ctx, w, h) => {
                        const bodyHeight = h * 0.08;
                        const gapSize = h * 0.08;
                        const candleWidth = w * 0.04;

                        // Etablierter Aufwärtstrend
                        drawCandle(ctx, w*0.15, h*0.7, candleWidth, bodyHeight, '#22c55e');
                        drawCandle(ctx, w*0.25, h*0.6, candleWidth, bodyHeight*1.2, '#22c55e');
                        drawCandle(ctx, w*0.35, h*0.5, candleWidth, bodyHeight*1.3, '#22c55e', 'Trend vor Gap');

                        // Runaway Gap
                        const firstCandleTop = h*0.5 - (bodyHeight*1.3)/2;
                        const gapBottom = firstCandleTop;
                        const gapTop = gapBottom - gapSize;
                        const secondCandleBottom = gapTop;
                        const secondCandleTop = secondCandleBottom - bodyHeight*1.2;

                        ctx.beginPath();
                        ctx.rect(w*0.45, gapTop, candleWidth*1.5, gapSize);
                        ctx.fillStyle = '#22c55e33'; ctx.fill();
                        ctx.strokeStyle = '#22c55e'; ctx.stroke();
                        addTooltipToPath(ctx.getCurrentPath ? ctx.getCurrentPath() : null, 'Runaway Gap');
                        drawText(ctx, 'Runaway Gap', w*0.45 + candleWidth*0.75, gapBottom - gapSize/2, '#22c55e', '10px');

                        drawCandle(ctx, w*0.55, secondCandleTop + (bodyHeight*1.2)/2, candleWidth, bodyHeight*1.2, '#22c55e', 'Trend nach Gap');
                        drawCandle(ctx, w*0.65, secondCandleTop - bodyHeight*0.8, candleWidth, bodyHeight*1.5, '#22c55e');
                        
                        drawArrow(ctx, w*0.1, h*0.75, w*0.85, h*0.1, '#22c55e', 1.5, 'Starker Trend');
                    }
                },
                {
                    id: 'exhaustionGap',
                    name: 'Erschöpfungslücke (Exhaustion Gap)',
                    description: 'Eine Erschöpfungslücke tritt am Ende eines starken Trends auf und signalisiert eine mögliche Trendumkehr. Nach einem letzten Kurssprung (dem Gap) fehlt die Kraft, den Trend fortzusetzen, und es kommt oft zu einer schnellen Umkehr.',
                    characteristics: [
                        'Tritt nach einem längeren, etablierten Trend auf.',
                        'Kann mit sehr hohem Volumen (Blow-off) oder niedrigem Volumen (letztes Aufbäumen) einhergehen.',
                        'Wird oft relativ schnell geschlossen.',
                        'Starkes Signal für eine bevorstehende Trendumkehr.'
                    ],
                    trading: 'Signalisiert das Ende des aktuellen Trends. Das Schließen der Lücke ist ein starkes Bestätigungssignal für die Umkehr. Vorsicht, da es sich um eine finale Übertreibung handeln kann.<br><br><strong>Wahrscheinlichkeit eines guten Trades:</strong> Hoch für eine Umkehr, *nachdem* die Umkehr bestätigt wird (z.B. durch Schließen des Gaps und Bildung von Umkehrkerzen).<br><strong>Tradingeinstieg mit TP und SL:</strong> Einstieg: Gegen die Richtung des Gaps *nach* deutlicher Bestätigung der Umkehr (z.B. Schließen des Gaps und Bruch der Kerze, die das Gap verursacht hat, oder Bildung eines Umkehr-Chartmusters nach dem Gap). SL: Jenseits des extremen Punktes des Gaps/der Umkehrkerze. TP: Signifikante Korrektur des vorherigen Trends oder nächste wichtige Unterstützungs-/Widerstandsniveaus.',
                    advancedConsiderations: '<strong>Volumen:</strong> Ein sehr hohes Volumen beim Gap kann eine finale Kapitulation/Euphorie anzeigen. Ein niedriges Volumen kann auf mangelnde Überzeugung für die Fortsetzung des Trends hindeuten.',
                    performanceStats: 'Erschöpfungslücken sind oft Vorboten signifikanter Trendwenden. Das Schließen des Gaps ist ein wichtiges Bestätigungssignal.',
                    drawFunction: (ctx, w, h) => {
                        const bodyHeight = h * 0.07;
                        const gapSize = h * 0.1;
                        const candleWidth = w * 0.035;

                        // Langer Aufwärtstrend
                        drawCandle(ctx, w*0.1, h*0.8, candleWidth, bodyHeight, '#22c55e');
                        drawCandle(ctx, w*0.2, h*0.65, candleWidth, bodyHeight*1.2, '#22c55e');
                        drawCandle(ctx, w*0.3, h*0.5, candleWidth, bodyHeight*1.3, '#22c55e');
                        drawCandle(ctx, w*0.4, h*0.35, candleWidth, bodyHeight*1.5, '#22c55e', 'Letzte Trendphase');

                        // Exhaustion Gap nach oben
                        const firstCandleTop = h*0.35 - (bodyHeight*1.5)/2;
                        const gapBottom = firstCandleTop;
                        const gapTop = gapBottom - gapSize;
                        const secondCandleBottom = gapTop;
                        const secondCandleTop = secondCandleBottom - bodyHeight*0.8; // Kleinere Kerze nach Gap

                        ctx.beginPath();
                        ctx.rect(w*0.5, gapTop, candleWidth*1.5, gapSize);
                        ctx.fillStyle = '#ef444433'; ctx.fill(); // Rot für bärische Implikation
                        ctx.strokeStyle = '#ef4444'; ctx.stroke();
                        addTooltipToPath(ctx.getCurrentPath ? ctx.getCurrentPath() : null, 'Exhaustion Gap');
                        drawText(ctx, 'Exhaustion Gap', w*0.5 + candleWidth*0.75, gapBottom - gapSize/2, '#ef4444', '10px');
                        
                        drawCandle(ctx, w*0.6, secondCandleTop + (bodyHeight*0.8)/2, candleWidth*0.8, bodyHeight*0.8, '#fca5a5', 'Schwache Kerze nach Gap');
                        
                        // Umkehr
                        drawArrow(ctx, w*0.65, secondCandleTop + bodyHeight, w*0.85, h*0.7, '#ef4444', 2, 'Trendumkehr');
                        drawCandle(ctx, w*0.75, h*0.5, candleWidth*1.2, bodyHeight*1.5, '#ef4444', 'Umkehrkerze');
                    }
                }
            ]
        };


        // --- Hilfsfunktionen für das Zeichnen ---
        const interactiveElements = []; 
        let tooltipElement = document.querySelector('.tooltip');
        if (!tooltipElement) {
            tooltipElement = document.createElement('div');
            tooltipElement.className = 'tooltip';
            document.body.appendChild(tooltipElement);
        }

        function drawLine(ctx, x1, y1, x2, y2, color = '#e5e7eb', width = 1, tooltipText = '') {
            ctx.beginPath(); ctx.moveTo(x1, y1); ctx.lineTo(x2, y2); ctx.strokeStyle = color; ctx.lineWidth = width; ctx.stroke();
            if (tooltipText) { const midX = (x1 + x2) / 2; const midY = (y1 + y2) / 2; const path = new Path2D(); path.rect(midX - 20, midY - 10, 40, 20); interactiveElements.push({ path, tooltip: tooltipText, isLine: true, x1, y1, x2, y2, color, width });}
        }
        function drawLineWithLabel(ctx, w, h, x1, y1, x2, y2, color = '#e5e7eb', width = 1, label = '', labelOffset = 15) {
            drawLine(ctx, x1, y1, x2, y2, color, width, label); 
            if (label) { const midX = (x1 + x2) / 2; const midY = (y1 + y2) / 2; const angle = Math.atan2(y2 - y1, x2 - x1); ctx.save(); ctx.translate(midX, midY); ctx.textAlign = 'center'; ctx.fillStyle = color; let offsetX = labelOffset * Math.sin(angle); let offsetY = -labelOffset * Math.cos(angle); if (Math.abs(Math.sin(angle)) < 0.1) { offsetY = (y1 < h/2) ? -labelOffset : labelOffset; offsetX = 0; } else if (Math.abs(Math.cos(angle)) < 0.1) { offsetX = (x1 < w/2) ? -labelOffset : labelOffset; offsetY = 0;} drawText(ctx, label, offsetX, offsetY, color, '10px'); ctx.restore();}
        }
        function drawPeak(ctx, centerX, peakY, width, baseY, color, tooltipText = '') { const halfWidth = width / 2; ctx.beginPath(); ctx.moveTo(centerX - halfWidth, baseY); ctx.lineTo(centerX, peakY); ctx.lineTo(centerX + halfWidth, baseY); ctx.strokeStyle = color; ctx.lineWidth = 2; ctx.stroke(); if (tooltipText) { const path = new Path2D(); path.moveTo(centerX - halfWidth, baseY); path.lineTo(centerX, peakY); path.lineTo(centerX + halfWidth, baseY); path.closePath(); interactiveElements.push({ path, tooltip: tooltipText });}}
        function drawTrough(ctx, centerX, troughY, width, baseY, color, tooltipText = '') { const halfWidth = width / 2; ctx.beginPath(); ctx.moveTo(centerX - halfWidth, baseY); ctx.lineTo(centerX, troughY); ctx.lineTo(centerX + halfWidth, baseY); ctx.strokeStyle = color; ctx.lineWidth = 2; ctx.stroke(); if (tooltipText) { const path = new Path2D(); path.moveTo(centerX - halfWidth, baseY); path.lineTo(centerX, troughY); path.lineTo(centerX + halfWidth, baseY); path.closePath(); interactiveElements.push({ path, tooltip: tooltipText });}}
        function drawText(ctx, text, x, y, color = '#e5e7eb', size = '12px') { ctx.fillStyle = color; ctx.font = `${size} Inter`; ctx.textAlign = 'center'; ctx.fillText(text, x, y);}
        function drawArrow(ctx, fromX, fromY, toX, toY, color = '#e5e7eb', width = 2, tooltipText = '') { const headLength = 10; const angle = Math.atan2(toY - fromY, toX - fromX); drawLine(ctx, fromX, fromY, toX, toY, color, width, tooltipText);  const path = new Path2D(); path.moveTo(toX, toY); path.lineTo(toX - headLength * Math.cos(angle - Math.PI / 6), toY - headLength * Math.sin(angle - Math.PI / 6)); path.moveTo(toX, toY); path.lineTo(toX - headLength * Math.cos(angle + Math.PI / 6), toY - headLength * Math.sin(angle + Math.PI / 6)); ctx.strokeStyle = color; ctx.lineWidth = width; ctx.stroke(path); }
        function drawCandle(ctx, x, y, width, height, color, tooltipText = '') { const top = y - height / 2; ctx.beginPath(); ctx.fillStyle = color; ctx.fillRect(x - width / 2, top, width, height); if (tooltipText) { const path = new Path2D(); path.rect(x - width/2 - 2, top - 2, width + 4, height + 4); interactiveElements.push({ path, tooltip: tooltipText });}}
        function addTooltipToPath(path, tooltipText) { if (path && tooltipText) { const currentPath = path instanceof Path2D ? path : (ctx.getCurrentPath ? ctx.getCurrentPath() : null); if(currentPath){ interactiveElements.push({ path: currentPath, tooltip: tooltipText }); } else if (path && path.rect) {  interactiveElements.push({ path, tooltip: tooltipText });}}}
        
        function drawGrid(ctx, w, h, step = 50, color = '#374151') {
            ctx.beginPath(); ctx.strokeStyle = color; ctx.lineWidth = 0.5;
            for (let x = 0; x <= w; x += step) { ctx.moveTo(x, 0); ctx.lineTo(x, h);}
            for (let y = 0; y <= h; y += step) { ctx.moveTo(0, y); ctx.lineTo(w, y);}
            ctx.stroke();
        }
        
        // --- Indikator Zeichenfunktionen (Illustrativ) ---
        function drawIllustrativeMA(mainCtx, w, h, patternId) {
            mainCtx.beginPath();
            mainCtx.strokeStyle = '#f97316'; // Orange für MA
            mainCtx.lineWidth = 1.5;
            mainCtx.setLineDash([5, 3]); // Gestrichelte Linie

            // Beispielhafte MA-Logik (sehr vereinfacht)
            switch (patternId) {
                case 'headAndShoulders':
                    mainCtx.moveTo(w * 0.1, h * 0.65);
                    mainCtx.bezierCurveTo(w * 0.25, h * 0.45, w * 0.4, h * 0.3, w * 0.5, h * 0.35);
                    mainCtx.bezierCurveTo(w * 0.6, h * 0.4, w * 0.75, h * 0.55, w * 0.9, h * 0.7);
                    break;
                case 'inverseHeadAndShoulders':
                     mainCtx.moveTo(w * 0.1, h * 0.35);
                     mainCtx.bezierCurveTo(w * 0.25, h * 0.55, w * 0.4, h * 0.7, w * 0.5, h * 0.65);
                     mainCtx.bezierCurveTo(w * 0.6, h * 0.6, w * 0.75, h * 0.45, w * 0.9, h * 0.3);
                    break;
                case 'bullFlag':
                case 'ascendingTriangle':
                case 'rectangleContinuationBullish':
                case 'symmetricalTriangleContinuationBullish':
                case 'cupAndHandle':
                case 'ascendingChannel':
                    mainCtx.moveTo(w * 0.1, h * 0.8);
                    mainCtx.quadraticCurveTo(w * 0.4, h * 0.5, w*0.7, h*0.4);
                    mainCtx.lineTo(w * 0.9, h*0.3);
                    break;
                case 'bearFlag':
                case 'descendingTriangle':
                case 'rectangleContinuationBearish':
                case 'symmetricalTriangleContinuationBearish':
                case 'invertedCupAndHandle':
                case 'descendingChannel':
                    mainCtx.moveTo(w * 0.1, h * 0.2);
                    mainCtx.quadraticCurveTo(w * 0.4, h * 0.5, w*0.7, h*0.6);
                    mainCtx.lineTo(w * 0.9, h*0.7);
                    break;
                default: // Generischer steigender MA
                    mainCtx.moveTo(w * 0.1, h * 0.7);
                    mainCtx.bezierCurveTo(w * 0.3, h * 0.6, w * 0.6, h * 0.4, w * 0.9, h * 0.3);
            }
            mainCtx.stroke();
            mainCtx.setLineDash([]); // Strichmuster zurücksetzen
            addTooltipToPath(null, 'Illustrativer MA');
        }

        function drawIllustrativeRSI(rsiCtx, w, h, patternId) {
            rsiCtx.clearRect(0, 0, w, h);
            drawGrid(rsiCtx, w, h, 20, '#2a313c'); // Feineres Grid für RSI

            // RSI Skala
            rsiCtx.strokeStyle = '#6b7280';
            rsiCtx.lineWidth = 1;
            const rsiLevels = {70: h * 0.3, 50: h * 0.5, 30: h * 0.7};
            for (const level in rsiLevels) {
                rsiCtx.beginPath();
                rsiCtx.moveTo(0, rsiLevels[level]);
                rsiCtx.lineTo(w, rsiLevels[level]);
                rsiCtx.stroke();
                drawText(rsiCtx, level, w - 20, rsiLevels[level] - 5, '#9ca3af', '10px');
            }
             drawText(rsiCtx, 'RSI', 25, 15, '#9ca3af');


            rsiCtx.beginPath();
            rsiCtx.strokeStyle = '#a78bfa'; // Lila für RSI
            rsiCtx.lineWidth = 1.5;

            // Beispielhafte RSI-Logik (sehr vereinfacht)
            switch (patternId) {
                case 'headAndShoulders': 
                case 'tripleTop':
                case 'eveAdamTop':
                case 'hornTop':
                case 'risingWedge': // Oft mit bärischer Divergenz
                case 'diamondTop':
                case 'roundingTop':
                    rsiCtx.moveTo(w * 0.1, rsiLevels[70] - 5); 
                    rsiCtx.lineTo(w * 0.25, rsiLevels[70]); 
                    rsiCtx.lineTo(w * 0.4, rsiLevels[50]); 
                    rsiCtx.lineTo(w * 0.5, rsiLevels[70] + 5); 
                    rsiCtx.lineTo(w * 0.6, rsiLevels[50] + 5);
                    rsiCtx.lineTo(w * 0.75, rsiLevels[70] + 10); 
                    rsiCtx.lineTo(w * 0.9, rsiLevels[30] + 10); 
                    break;
                case 'inverseHeadAndShoulders': 
                case 'tripleBottom':
                case 'eveAdamBottom':
                case 'hornBottom':
                case 'fallingWedge': // Oft mit bullischer Divergenz
                case 'diamondBottom':
                case 'roundingBottom':
                    rsiCtx.moveTo(w * 0.1, rsiLevels[30] + 5); 
                    rsiCtx.lineTo(w * 0.25, rsiLevels[30]); 
                    rsiCtx.lineTo(w * 0.4, rsiLevels[50]); 
                    rsiCtx.lineTo(w * 0.5, rsiLevels[30] - 5); 
                    rsiCtx.lineTo(w * 0.6, rsiLevels[50] - 5);
                    rsiCtx.lineTo(w * 0.75, rsiLevels[30] - 10); 
                    rsiCtx.lineTo(w * 0.9, rsiLevels[70] - 10); 
                    break;
                 case 'bullFlag':
                 case 'ascendingTriangle':
                 case 'cupAndHandle':
                 case 'symmetricalTriangleContinuationBullish':
                 case 'rectangleContinuationBullish':
                 case 'ascendingChannel':
                 case 'bullishPennant':
                    rsiCtx.moveTo(w * 0.1, rsiLevels[50]);
                    rsiCtx.lineTo(w * 0.3, rsiLevels[70] -10);
                    rsiCtx.lineTo(w * 0.4, rsiLevels[50] + 5); 
                    rsiCtx.lineTo(w * 0.5, rsiLevels[70] -5);
                    rsiCtx.lineTo(w * 0.6, rsiLevels[50]);
                    rsiCtx.lineTo(w * 0.9, rsiLevels[70] + 5); 
                    break;
                case 'bearFlag':
                case 'descendingTriangle':
                case 'invertedCupAndHandle':
                case 'symmetricalTriangleContinuationBearish':
                case 'rectangleContinuationBearish':
                case 'descendingChannel':
                case 'bearishPennant':
                    rsiCtx.moveTo(w * 0.1, rsiLevels[50]);
                    rsiCtx.lineTo(w * 0.3, rsiLevels[30] +10);
                    rsiCtx.lineTo(w * 0.4, rsiLevels[50] - 5); 
                    rsiCtx.lineTo(w * 0.5, rsiLevels[30] +5);
                    rsiCtx.lineTo(w * 0.6, rsiLevels[50]);
                    rsiCtx.lineTo(w * 0.9, rsiLevels[30] - 5); 
                    break;
                default: // Generischer RSI
                    rsiCtx.moveTo(w * 0.1, rsiLevels[30]);
                    rsiCtx.bezierCurveTo(w * 0.3, rsiLevels[70], w * 0.6, rsiLevels[30], w * 0.9, rsiLevels[50]);
            }
            rsiCtx.stroke();
            addTooltipToPath(null, 'Illustrativer RSI');
        }


        // --- Canvas und App Logik ---
        function resizeCanvas() {
            const dpr = window.devicePixelRatio || 1;
            const containerRect = chartsContainer.getBoundingClientRect(); 
            baseWidth = containerRect.width; 

            let mainCanvasHeight;
            if (showIllustrativeRSI) {
                rsiCanvas.style.display = 'block';
                mainCanvasHeight = (baseWidth * (9/16)) * 0.75; 
                rsiHeight = (baseWidth * (9/16)) * 0.25 -16; 
                if (mainCanvasHeight < 150) mainCanvasHeight = 150; 
                if (rsiHeight < 60) rsiHeight = 60;
                
                rsiCanvas.width = baseWidth * dpr;
                rsiCanvas.height = rsiHeight * dpr;
                rsiCanvas.style.width = `${baseWidth}px`;
                rsiCanvas.style.height = `${rsiHeight}px`;
                rsiCtx.scale(dpr, dpr);
            } else {
                rsiCanvas.style.display = 'none';
                mainCanvasHeight = baseWidth * (9/16);
            }
            
            chartCanvas.width = baseWidth * dpr;
            chartCanvas.height = mainCanvasHeight * dpr;
            chartCanvas.style.width = `${baseWidth}px`;
            chartCanvas.style.height = `${mainCanvasHeight}px`;
            ctx.scale(dpr, dpr);
            
            baseChartHeight = mainCanvasHeight; 

            if (currentPattern) {
                redrawEverything();
            } else {
                drawInitialMessage();
            }
        }
        
        function drawInitialMessage() {
            ctx.clearRect(0, 0, baseWidth, baseChartHeight);
            ctx.fillStyle = '#9ca3af'; 
            ctx.font = '16px Inter';
            ctx.textAlign = 'center';
            ctx.fillText('Bitte wählen Sie ein Chartmuster aus der Liste.', baseWidth / 2, baseChartHeight / 2);
            
            mainFavoriteButton.disabled = true; 
            mainFavoriteButton.classList.remove('is-favorite');
            mainFavoriteButton.textContent = '☆';


            if(showIllustrativeRSI) {
                rsiCtx.clearRect(0, 0, baseWidth, rsiHeight);
                drawGrid(rsiCtx, baseWidth, rsiHeight, 20, '#2a313c');
                 const rsiLevels = {70: rsiHeight * 0.3, 50: rsiHeight * 0.5, 30: rsiHeight * 0.7};
                for (const level in rsiLevels) {
                    rsiCtx.beginPath(); rsiCtx.moveTo(0, rsiLevels[level]); rsiCtx.lineTo(baseWidth, rsiLevels[level]); rsiCtx.strokeStyle = '#6b7280'; rsiCtx.lineWidth = 1; rsiCtx.stroke();
                    drawText(rsiCtx, level, baseWidth - 20, rsiLevels[level] - 5, '#9ca3af', '10px');
                }
                drawText(rsiCtx, 'RSI', 25, 15, '#9ca3af');
                drawText(rsiCtx, 'RSI wird hier angezeigt.', baseWidth/2, rsiHeight/2, '#9ca3af');
            }
             updateMainFavoriteButtonState(); // Stellt sicher, dass der Button-Zustand korrekt ist
        }

        function updatePatternInfo(pattern) {
            patternNameEl.textContent = pattern.name;
            patternDescriptionEl.innerHTML = pattern.description; 
            characteristicsListEl.innerHTML = ''; 
            pattern.characteristics.forEach(char => { const li = document.createElement('li'); li.textContent = char; characteristicsListEl.appendChild(li);});
            tradingTextEl.innerHTML = pattern.trading; 
            advancedTextEl.innerHTML = pattern.advancedConsiderations || 'Keine detaillierteren Informationen für dieses Muster verfügbar.';
            performanceTextEl.innerHTML = pattern.performanceStats || 'Keine spezifischen Performance-Hinweise für dieses Muster verfügbar.'; 
            updateMainFavoriteButtonState(); 
        }
        
        function redrawEverything() {
            if (!currentPattern) {
                drawInitialMessage();
                return;
            }
            interactiveElements.length = 0; 
            ctx.clearRect(0, 0, baseWidth, baseChartHeight); 
            drawGrid(ctx, baseWidth, baseChartHeight);
            currentPattern.drawFunction(ctx, baseWidth, baseChartHeight);
            updatePatternInfo(currentPattern);

            if (showIllustrativeMA) {
                drawIllustrativeMA(ctx, baseWidth, baseChartHeight, currentPattern.id);
            }

            if (showIllustrativeRSI) {
                rsiCanvas.style.display = 'block'; 
                drawIllustrativeRSI(rsiCtx, baseWidth, rsiHeight, currentPattern.id);
            } else {
                rsiCanvas.style.display = 'none';
            }
        }
        
        showMACheckbox.addEventListener('change', (event) => {
            showIllustrativeMA = event.target.checked;
            if (currentPattern) redrawEverything(); else drawInitialMessage();
        });

        showRSICheckbox.addEventListener('change', (event) => {
            showIllustrativeRSI = event.target.checked;
            resizeCanvas(); 
        });

        window.addEventListener('resize', resizeCanvas);

        chartCanvas.addEventListener('mousemove', (event) => {
            const rect = chartCanvas.getBoundingClientRect();
            const dpr = window.devicePixelRatio || 1;
            const x = (event.clientX - rect.left);
            const y = (event.clientY - rect.top);

            let onInteractiveElement = false;
            for (const el of interactiveElements) {
                let isHovered = false;
                if (el.isLine) {  const midX = (el.x1 + el.x2) / 2 / dpr;  const midY = (el.y1 + el.y2) / 2 / dpr; const dist = Math.sqrt(Math.pow(x - midX, 2) + Math.pow(y - midY, 2)); if (dist < 20) { isHovered = true;}
                } else if (el.path && ctx.isPointInPath(el.path, x * dpr, y * dpr)) { isHovered = true;}

                if (isHovered) { tooltipElement.textContent = el.tooltip; tooltipElement.style.left = `${event.pageX + 10}px`; tooltipElement.style.top = `${event.pageY + 10}px`; tooltipElement.style.visibility = 'visible'; tooltipElement.style.opacity = '1'; onInteractiveElement = true; chartCanvas.style.cursor = 'help'; break; }
            }
            if (!onInteractiveElement) { tooltipElement.style.visibility = 'hidden'; tooltipElement.style.opacity = '0'; chartCanvas.style.cursor = 'default';}
        });
        chartCanvas.addEventListener('mouseleave', () => { tooltipElement.style.visibility = 'hidden'; tooltipElement.style.opacity = '0'; chartCanvas.style.cursor = 'default';});
        
        rsiCanvas.addEventListener('mousemove', (event) => {
             if (showIllustrativeRSI) {
                tooltipElement.textContent = 'Illustrativer RSI Verlauf';
                tooltipElement.style.left = `${event.pageX + 10}px`;
                tooltipElement.style.top = `${event.pageY + 10}px`;
                tooltipElement.style.visibility = 'visible';
                tooltipElement.style.opacity = '1';
                rsiCanvas.style.cursor = 'help';
             }
        });
        rsiCanvas.addEventListener('mouseleave', () => {
            tooltipElement.style.visibility = 'hidden';
            tooltipElement.style.opacity = '0';
            rsiCanvas.style.cursor = 'default';
        });


        // Muster-Buttons nach Kategorie generieren
        function generatePatternButtons() {
            const currentActivePatternId = currentPattern ? currentPattern.id : null;
            const currentScrollTop = patternSelectContainer.scrollTop;

            const indicatorControlsDiv = patternSelectContainer.querySelector('.indicator-controls');
            patternSelectContainer.innerHTML = '<h2 class="pattern-select-title">Chartmuster wählen:</h2>'; // Titel wiederherstellen
            if (indicatorControlsDiv) { // Indikator-Steuerung wieder anhängen
                patternSelectContainer.appendChild(indicatorControlsDiv);
            }


            // Favoriten-Kategorie (falls Favoriten vorhanden)
            if (favoritePatterns.length > 0) {
                const favCategoryTitle = document.createElement('h3');
                favCategoryTitle.textContent = '⭐ Favoriten';
                favCategoryTitle.className = 'category-title';
                patternSelectContainer.insertBefore(favCategoryTitle, indicatorControlsDiv);

                const allPatterns = Object.values(chartPatternsByCategory).flat();
                favoritePatterns.forEach(favId => {
                    const pattern = allPatterns.find(p => p.id === favId);
                    if (pattern) {
                         createPatternButton(pattern, patternSelectContainer, true);
                    }
                });
            }

            // Reguläre Kategorien
            for (const category in chartPatternsByCategory) {
                const categoryTitle = document.createElement('h3');
                categoryTitle.textContent = category;
                categoryTitle.className = 'category-title';
                patternSelectContainer.insertBefore(categoryTitle, indicatorControlsDiv);

                chartPatternsByCategory[category].forEach(pattern => {
                    createPatternButton(pattern, patternSelectContainer, true);
                });
            }
            
            if (currentActivePatternId) {
                 const currentActiveButton = patternSelectContainer.querySelector(`.pattern-button[data-id="${currentActivePatternId}"]`);
                if (currentActiveButton) currentActiveButton.classList.add('active');
            }
            patternSelectContainer.scrollTop = currentScrollTop;
        }

        function createPatternButton(pattern, container, insertBeforeIndicators = false) {
            const button = document.createElement('button');
            button.textContent = pattern.name;
            button.className = 'pattern-button';
            button.dataset.id = pattern.id; 
            button.addEventListener('click', () => {
                document.querySelectorAll('.pattern-button').forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                currentPattern = pattern; 
                resizeCanvas(); 
            });
            
            if (insertBeforeIndicators) {
                container.insertBefore(button, container.querySelector('.indicator-controls'));
            } else {
                container.appendChild(button);
            }
        }
        
        loadFavorites(); 
        generatePatternButtons(); 
        updateMainFavoriteButtonState(); 

        resizeCanvas(); 

    </script>
</body>
</html>
