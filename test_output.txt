
> cachy-app@0.94.2 test
> vitest --run

The following Vite config options will be overridden by SvelteKit:
  - base

[1m[46m RUN [49m[22m [36mv4.0.17 [39m[90m/home/pat/Dokumente/GitHub/cachy-app[39m

 [32mâœ“[39m src/utils/inputUtils.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 87[2mms[22m[39m
 [31mâ¯[39m src/services/apiService.test.ts [2m([22m[2m7 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[32m 104[2mms[22m[39m
     [32mâœ“[39m should normalize basic coin symbols to USDT pair[32m 3[2mms[22m[39m
     [32mâœ“[39m should keep existing USDT symbols[32m 1[2mms[22m[39m
     [32mâœ“[39m should strip .P suffix[32m 0[2mms[22m[39m
[31m     [31mÃ—[31m should strip P from USDTP symbols[39m[32m 36[2mms[22m[39m
     [32mâœ“[39m should handle symbols containing USD but not ending in P[32m 1[2mms[22m[39m
     [32mâœ“[39m should not strip P from other pairs unless specified[32m 0[2mms[22m[39m
[31m     [31mÃ—[31m should handle lowercase input[39m[32m 1[2mms[22m[39m
 [32mâœ“[39m src/lib/calculator.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 41[2mms[22m[39m
 [32mâœ“[39m src/lib/calculator_charts.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 46[2mms[22m[39m
[90mstdout[2m | src/services/technicalsService.test.ts[2m > [22m[2mtechnicalsService[2m > [22m[2mshould calculate new oscillators correctly
[22m[39mWaiting for talib-web initialization...

[90mstderr[2m | src/services/technicalsService.test.ts[2m > [22m[2mtechnicalsService[2m > [22m[2mshould calculate new oscillators correctly
[22m[39mtalib-web initialization failed or timed out.

[90mstdout[2m | src/services/technicalsService.test.ts[2m > [22m[2mtechnicalsService[2m > [22m[2mshould respect custom settings
[22m[39mWaiting for talib-web initialization...

[90mstderr[2m | src/services/technicalsService.test.ts[2m > [22m[2mtechnicalsService[2m > [22m[2mshould respect custom settings
[22m[39mtalib-web initialization failed or timed out.

 [31mâ¯[39m src/services/technicalsService.test.ts [2m([22m[2m2 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[32m 64[2mms[22m[39m
[31m     [31mÃ—[31m should calculate new oscillators correctly[39m[32m 48[2mms[22m[39m
[31m     [31mÃ—[31m should respect custom settings[39m[32m 9[2mms[22m[39m
 [32mâœ“[39m src/stores/accountStore.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 17[2mms[22m[39m
 [32mâœ“[39m src/utils/indicators.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 50[2mms[22m[39m
 [32mâœ“[39m src/routes/api/chat-v2/server.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 29[2mms[22m[39m
 [32mâœ“[39m src/utils/utils.test.ts [2m([22m[2m20 tests[22m[2m)[22m[32m 23[2mms[22m[39m
 [32mâœ“[39m src/services/backupService.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 48[2mms[22m[39m
 [32mâœ“[39m src/services/julesService.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 25[2mms[22m[39m
[90mstderr[2m | src/services/app.test.ts[2m > [22m[2mapp service - ATR and Locking Logic[2m > [22m[2mshould backward-calculate risk percentage when risk amount is locked
[22m[39mMatomo Tag Manager not available. Skipping custom event.

 [31mâ¯[39m src/services/app.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m | [22m[33m1 skipped[39m[2m)[22m[32m 96[2mms[22m[39m
     [32mâœ“[39m should distribute surplus evenly when another TP is decreased[32m 18[2mms[22m[39m
     [32mâœ“[39m should distribute surplus to other unlocked TPs if one is locked[32m 5[2mms[22m[39m
     [32mâœ“[39m should take deficit from other TPs in reverse order (T3 then T2)[32m 2[2mms[22m[39m
     [32mâœ“[39m should take deficit from T3, then T2 if T3 is depleted[32m 1[2mms[22m[39m
     [32mâœ“[39m should not take deficit from locked TPs[32m 2[2mms[22m[39m
     [32mâœ“[39m should revert change if only one unlocked TP is edited (increase)[32m 1[2mms[22m[39m
     [32mâœ“[39m should revert change if only one unlocked TP is edited (decrease)[32m 1[2mms[22m[39m
     [32mâœ“[39m should ignore changes to a locked field[32m 1[2mms[22m[39m
     [32mâœ“[39m should re-balance correctly when a lock is released[32m 2[2mms[22m[39m
     [2m[90mâ†“[39m[22m should create a production build output
     [32mâœ“[39m should fetch ATR and update the trade store[32m 10[2mms[22m[39m
     [32mâœ“[39m should toggle risk amount lock[32m 2[2mms[22m[39m
     [32mâœ“[39m should enforce mutual exclusion: locking risk amount unlocks position size[32m 1[2mms[22m[39m
     [32mâœ“[39m should enforce mutual exclusion: locking position size unlocks risk amount[32m 1[2mms[22m[39m
     [32mâœ“[39m should backward-calculate risk percentage when risk amount is locked[32m 11[2mms[22m[39m
     [32mâœ“[39m should set atrMode to auto when useAtrSl is toggled on[32m 1[2mms[22m[39m
[31m     [31mÃ—[31m should parse trade history date correctly (number and string)[39m[32m 26[2mms[22m[39m
 [32mâœ“[39m src/lib/calculator_duration.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 10[2mms[22m[39m
 [32mâœ“[39m src/utils/utils_timestamp.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 15[2mms[22m[39m
 [32mâœ“[39m src/utils/errorUtils.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 7[2mms[22m[39m
 [32mâœ“[39m src/stores/marketStore.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 8[2mms[22m[39m
 [32mâœ“[39m src/services/hotkeyService.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 17[2mms[22m[39m

[31mâ¯â¯â¯â¯â¯â¯â¯[39m[1m[41m Failed Tests 5 [49m[22m[31mâ¯â¯â¯â¯â¯â¯â¯[39m

[41m[1m FAIL [22m[49m src/services/apiService.test.ts[2m > [22mapiService - normalizeSymbol[2m > [22mshould strip P from USDTP symbols
[31m[1mAssertionError[22m: expected 'BTCUSDTP' to be 'BTCUSDT' // Object.is equality[39m

Expected: [32m"BTCUSDT"[39m
Received: [31m"BTCUSDT[7mP[27m"[39m

[36m [2mâ¯[22m src/services/apiService.test.ts:[2m19:63[22m[39m
    [90m 17| [39m
    [90m 18| [39m  [34mit[39m([32m"should strip P from USDTP symbols"[39m[33m,[39m () [33m=>[39m {
    [90m 19| [39m    expect(apiService.normalizeSymbol("BTCUSDTP", "bitunix")).toBe("BTâ€¦
    [90m   | [39m                                                              [31m^[39m
    [90m 20| [39m  })[33m;[39m
    [90m 21| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/5]â¯[22m[39m

[41m[1m FAIL [22m[49m src/services/apiService.test.ts[2m > [22mapiService - normalizeSymbol[2m > [22mshould handle lowercase input
[31m[1mAssertionError[22m: expected 'BTCUSDTP' to be 'BTCUSDT' // Object.is equality[39m

Expected: [32m"BTCUSDT"[39m
Received: [31m"BTCUSDT[7mP[27m"[39m

[36m [2mâ¯[22m src/services/apiService.test.ts:[2m32:63[22m[39m
    [90m 30| [39m
    [90m 31| [39m  [34mit[39m([32m"should handle lowercase input"[39m[33m,[39m () [33m=>[39m {
    [90m 32| [39m    expect(apiService.normalizeSymbol("btcusdtp", "bitunix")).toBe("BTâ€¦
    [90m   | [39m                                                              [31m^[39m
    [90m 33| [39m  })[33m;[39m
    [90m 34| [39m})[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/5]â¯[22m[39m

[41m[1m FAIL [22m[49m src/services/app.test.ts[2m > [22mapp service - ATR and Locking Logic[2m > [22mshould parse trade history date correctly (number and string)
[31m[1mTypeError[22m: store.subscribe is not a function[39m
[36m [2mâ¯[22m node_modules/svelte/src/store/utils.js:[2m26:9[22m[39m
    [90m 24| [39m // StartStopNotifier could mutate state, and we want to silence the câ€¦
    [90m 25| [39m [35mconst[39m unsub [33m=[39m [34muntrack[39m(() [33m=>[39m
    [90m 26| [39m  store[33m.[39m[34msubscribe[39m(
    [90m   | [39m        [31m^[39m
    [90m 27| [39m   run[33m,[39m
    [90m 28| [39m   [90m// @ts-expect-error[39m
[90m [2mâ¯[22m untrack node_modules/svelte/src/internal/client/runtime.js:[2m726:10[22m[39m
[90m [2mâ¯[22m subscribe_to_store node_modules/svelte/src/store/utils.js:[2m25:23[22m[39m
[90m [2mâ¯[22m get node_modules/svelte/src/store/shared/index.js:[2m206:20[22m[39m
[90m [2mâ¯[22m Object.syncBitunixPositions src/services/syncService.ts:[2m23:9[22m[39m
[90m [2mâ¯[22m Object.syncBitunixHistory src/services/app.ts:[2m572:23[22m[39m
[90m [2mâ¯[22m src/services/app.test.ts:[2m462:15[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/5]â¯[22m[39m

[41m[1m FAIL [22m[49m src/services/technicalsService.test.ts[2m > [22mtechnicalsService[2m > [22mshould calculate new oscillators correctly
[31m[1mAssertionError[22m: expected undefined to be defined[39m
[36m [2mâ¯[22m src/services/technicalsService.test.ts:[2m59:17[22m[39m
    [90m 57| [39m
    [90m 58| [39m    [35mconst[39m cci [33m=[39m result[33m.[39moscillators[33m.[39m[34mfind[39m((o) [33m=>[39m o[33m.[39mname [33m===[39m [32m"CCI"[39m)[33m;[39m
    [90m 59| [39m    [34mexpect[39m(cci)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m   | [39m                [31m^[39m
    [90m 60| [39m    [34mexpect[39m([33mDecimal[39m[33m.[39m[34misDecimal[39m(cci[33m?.[39mvalue))[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m 61| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/5]â¯[22m[39m

[41m[1m FAIL [22m[49m src/services/technicalsService.test.ts[2m > [22mtechnicalsService[2m > [22mshould respect custom settings
[31m[1mAssertionError[22m: expected undefined to be defined[39m
[36m [2mâ¯[22m src/services/technicalsService.test.ts:[2m94:17[22m[39m
    [90m 92| [39m    [90m// Verify CCI params[39m
    [90m 93| [39m    [35mconst[39m cci [33m=[39m result[33m.[39moscillators[33m.[39m[34mfind[39m((o) [33m=>[39m o[33m.[39mname [33m===[39m [32m"CCI"[39m)[33m;[39m
    [90m 94| [39m    [34mexpect[39m(cci)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m   | [39m                [31m^[39m
    [90m 95| [39m    [34mexpect[39m(cci[33m?.[39mparams)[33m.[39m[34mtoBe[39m([32m"10"[39m)[33m;[39m
    [90m 96| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[5/5]â¯[22m[39m


[2m Test Files [22m [1m[31m3 failed[39m[22m[2m | [22m[1m[32m14 passed[39m[22m[90m (17)[39m
[2m      Tests [22m [1m[31m5 failed[39m[22m[2m | [22m[1m[32m114 passed[39m[22m[2m | [22m[33m1 skipped[39m[90m (120)[39m
[2m   Start at [22m 00:19:09
[2m   Duration [22m 8.47s[2m (transform 7.44s, setup 0ms, import 13.58s, tests 688ms, environment 30.00s)[22m

