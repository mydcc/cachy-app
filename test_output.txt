
> cachy-app@0.98.0 test
> vitest --run

The following Vite config options will be overridden by SvelteKit:
  - base

[1m[46m RUN [49m[22m [36mv4.0.16 [39m[90m/home/pat/Dokumente/GitHub/cachy-app[39m

 [31mâ¯[39m src/utils/utils.test.ts [2m([22m[2m18 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[32m 28[2mms[22m[39m
     [32mâœ“[39m should return number as is (milliseconds)[32m 4[2mms[22m[39m
     [32mâœ“[39m should parse numeric string[32m 1[2mms[22m[39m
     [32mâœ“[39m should parse ISO date string[32m 0[2mms[22m[39m
     [32mâœ“[39m should return 0 for invalid string[32m 0[2mms[22m[39m
     [32mâœ“[39m should return 0 for null[32m 1[2mms[22m[39m
     [32mâœ“[39m should return 0 for undefined[32m 0[2mms[22m[39m
     [32mâœ“[39m should return 0 for NaN[32m 0[2mms[22m[39m
     [32mâœ“[39m should return 0 for empty string[32m 0[2mms[22m[39m
     [32mâœ“[39m should parse valid millisecond timestamps (number)[32m 1[2mms[22m[39m
     [32mâœ“[39m should parse valid millisecond timestamps (string)[32m 1[2mms[22m[39m
     [32mâœ“[39m should convert seconds to milliseconds (number)[32m 0[2mms[22m[39m
     [32mâœ“[39m should convert seconds to milliseconds (string)[32m 0[2mms[22m[39m
     [32mâœ“[39m should handle floating point seconds (string)[32m 0[2mms[22m[39m
     [32mâœ“[39m should handle Date object[32m 0[2mms[22m[39m
[31m     [31mÃ—[31m should parse German date format DD.MM.YYYY[39m[32m 10[2mms[22m[39m
[31m     [31mÃ—[31m should parse ISO date format YYYY-MM-DD[39m[32m 2[2mms[22m[39m
[31m     [31mÃ—[31m should fallback to JS parsing for US format MM/DD/YYYY[39m[32m 1[2mms[22m[39m
[31m     [31mÃ—[31m should handle empty time[39m[32m 2[2mms[22m[39m
 [32mâœ“[39m src/routes/api/chat-v2/server.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 19[2mms[22m[39m
 [32mâœ“[39m src/utils/inputUtils.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 45[2mms[22m[39m
[90mstdout[2m | src/services/technicalsService.test.ts
[22m[39mtalib-web initialized successfully from undefined

 [32mâœ“[39m src/lib/calculator.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 22[2mms[22m[39m
 [32mâœ“[39m src/lib/calculator_charts.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 32[2mms[22m[39m
[90mstdout[2m | src/services/technicalsService.test.ts[2m > [22m[2mtechnicalsService[2m > [22m[2mshould calculate new oscillators correctly
[22m[39m[Technicals] AO Internal: fastSMA=536, slowSMA=507, diff=29

[90mstdout[2m | src/services/technicalsService.test.ts[2m > [22m[2mtechnicalsService[2m > [22m[2mshould respect custom settings
[22m[39m[Technicals] AO Internal: fastSMA=539, slowSMA=536, diff=3

 [32mâœ“[39m src/services/technicalsService.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 92[2mms[22m[39m
[90mstderr[2m | src/services/app.test.ts[2m > [22m[2mapp service - ATR and Locking Logic[2m > [22m[2mshould backward-calculate risk percentage when risk amount is locked
[22m[39mMatomo Tag Manager not available. Skipping custom event.

[90mstderr[2m | src/services/app.test.ts[2m > [22m[2mapp service - ATR and Locking Logic[2m > [22m[2mshould parse trade history date correctly (number and string)
[22m[39mMatomo Tag Manager not available. Skipping custom event.

 [31mâ¯[39m src/services/app.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m | [22m[33m1 skipped[39m[2m)[22m[32m 60[2mms[22m[39m
     [32mâœ“[39m should distribute surplus evenly when another TP is decreased[32m 6[2mms[22m[39m
     [32mâœ“[39m should distribute surplus to other unlocked TPs if one is locked[32m 1[2mms[22m[39m
     [32mâœ“[39m should take deficit from other TPs in reverse order (T3 then T2)[32m 1[2mms[22m[39m
     [32mâœ“[39m should take deficit from T3, then T2 if T3 is depleted[32m 1[2mms[22m[39m
     [32mâœ“[39m should not take deficit from locked TPs[32m 1[2mms[22m[39m
     [32mâœ“[39m should revert change if only one unlocked TP is edited (increase)[32m 2[2mms[22m[39m
     [32mâœ“[39m should revert change if only one unlocked TP is edited (decrease)[32m 4[2mms[22m[39m
     [32mâœ“[39m should ignore changes to a locked field[32m 1[2mms[22m[39m
     [32mâœ“[39m should re-balance correctly when a lock is released[32m 1[2mms[22m[39m
     [2m[90mâ†“[39m[22m should create a production build output
[31m     [31mÃ—[31m should fetch ATR and update the trade store[39m[32m 23[2mms[22m[39m
     [32mâœ“[39m should toggle risk amount lock[32m 1[2mms[22m[39m
     [32mâœ“[39m should enforce mutual exclusion: locking risk amount unlocks position size[32m 1[2mms[22m[39m
     [32mâœ“[39m should enforce mutual exclusion: locking position size unlocks risk amount[32m 1[2mms[22m[39m
     [32mâœ“[39m should backward-calculate risk percentage when risk amount is locked[32m 6[2mms[22m[39m
     [32mâœ“[39m should set atrMode to auto when useAtrSl is toggled on[32m 2[2mms[22m[39m
     [32mâœ“[39m should parse trade history date correctly (number and string)[32m 4[2mms[22m[39m
 [32mâœ“[39m src/utils/indicators.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 17[2mms[22m[39m
 [32mâœ“[39m src/lib/calculator_duration.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 16[2mms[22m[39m
 [32mâœ“[39m src/services/julesService.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 11[2mms[22m[39m
 [32mâœ“[39m src/utils/utils_timestamp.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 8[2mms[22m[39m
 [32mâœ“[39m src/stores/accountStore.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 8[2mms[22m[39m
 [32mâœ“[39m src/services/hotkeyService.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 14[2mms[22m[39m
 [32mâœ“[39m src/stores/marketStore.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 9[2mms[22m[39m
 [32mâœ“[39m src/utils/errorUtils.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 3[2mms[22m[39m
 [32mâœ“[39m src/services/backupService.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 6[2mms[22m[39m
 [32mâœ“[39m src/services/apiService.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 4[2mms[22m[39m

[31mâ¯â¯â¯â¯â¯â¯â¯[39m[1m[41m Failed Tests 5 [49m[22m[31mâ¯â¯â¯â¯â¯â¯â¯[39m

[41m[1m FAIL [22m[49m src/services/app.test.ts[2m > [22mapp service - ATR and Locking Logic[2m > [22mshould fetch ATR and update the trade store
[31m[1mAssertionError[22m: expected "vi.fn()" to be called with arguments: [ 'BTCUSDT', '1h' ][90m

Received: 

[1m  1st vi.fn() call:

[22m[2m  [[22m
[2m    "BTCUSDT",[22m
[2m    "1h",[22m
[31m+   15,[90m
[31m+   undefined,[90m
[31m+   undefined,[90m
[31m+   "high",[90m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[36m [2mâ¯[22m src/services/app.test.ts:[2m283:43[22m[39m
    [90m281| [39m    [90m// Assert[39m
    [90m282| [39m    [35mconst[39m store [33m=[39m [35mget[39m(tradeStore)[33m;[39m
    [90m283| [39m    expect(apiService.fetchBitunixKlines).toHaveBeenCalledWith("BTCUSDâ€¦
    [90m   | [39m                                          [31m^[39m
    [90m284| [39m    [34mexpect[39m(store[33m.[39matrValue)[33m.[39mnot[33m.[39m[34mtoBe[39m([35mnull[39m)[33m;[39m
    [90m285| [39m    [34mexpect[39m([35mnew[39m [33mDecimal[39m(store[33m.[39matrValue[33m![39m)[33m.[39m[34misFinite[39m())[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/5]â¯[22m[39m

[41m[1m FAIL [22m[49m src/utils/utils.test.ts[2m > [22mparseDateString[2m > [22mshould parse German date format DD.MM.YYYY
[31m[1mAssertionError[22m: expected '2025-12-23T18:40:08.000Z' to be '2025-12-23T19:40:08.000Z' // Object.is equality[39m

Expected: [32m"2025-12-23T1[7m9[27m:40:08.000Z"[39m
Received: [31m"2025-12-23T1[7m8[27m:40:08.000Z"[39m

[36m [2mâ¯[22m src/utils/utils.test.ts:[2m75:32[22m[39m
    [90m 73| [39m  [34mit[39m([32m"should parse German date format DD.MM.YYYY"[39m[33m,[39m () [33m=>[39m {
    [90m 74| [39m    [35mconst[39m date [33m=[39m [34mparseDateString[39m([32m"23.12.2025"[39m[33m,[39m [32m"19:40:08"[39m)[33m;[39m
    [90m 75| [39m    [34mexpect[39m(date[33m.[39m[34mtoISOString[39m())[33m.[39m[34mtoBe[39m([32m"2025-12-23T19:40:08.000Z"[39m)[33m;[39m
    [90m   | [39m                               [31m^[39m
    [90m 76| [39m  })[33m;[39m
    [90m 77| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/5]â¯[22m[39m

[41m[1m FAIL [22m[49m src/utils/utils.test.ts[2m > [22mparseDateString[2m > [22mshould parse ISO date format YYYY-MM-DD
[31m[1mAssertionError[22m: expected '2025-12-23T18:40:08.000Z' to be '2025-12-23T19:40:08.000Z' // Object.is equality[39m

Expected: [32m"2025-12-23T1[7m9[27m:40:08.000Z"[39m
Received: [31m"2025-12-23T1[7m8[27m:40:08.000Z"[39m

[36m [2mâ¯[22m src/utils/utils.test.ts:[2m80:32[22m[39m
    [90m 78| [39m  [34mit[39m([32m"should parse ISO date format YYYY-MM-DD"[39m[33m,[39m () [33m=>[39m {
    [90m 79| [39m    [35mconst[39m date [33m=[39m [34mparseDateString[39m([32m"2025-12-23"[39m[33m,[39m [32m"19:40:08"[39m)[33m;[39m
    [90m 80| [39m    [34mexpect[39m(date[33m.[39m[34mtoISOString[39m())[33m.[39m[34mtoBe[39m([32m"2025-12-23T19:40:08.000Z"[39m)[33m;[39m
    [90m   | [39m                               [31m^[39m
    [90m 81| [39m  })[33m;[39m
    [90m 82| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/5]â¯[22m[39m

[41m[1m FAIL [22m[49m src/utils/utils.test.ts[2m > [22mparseDateString[2m > [22mshould fallback to JS parsing for US format MM/DD/YYYY
[31m[1mAssertionError[22m: expected '2025-12-23T18:40:08.000Z' to be '2025-12-23T19:40:08.000Z' // Object.is equality[39m

Expected: [32m"2025-12-23T1[7m9[27m:40:08.000Z"[39m
Received: [31m"2025-12-23T1[7m8[27m:40:08.000Z"[39m

[36m [2mâ¯[22m src/utils/utils.test.ts:[2m85:32[22m[39m
    [90m 83| [39m  [34mit[39m([32m"should fallback to JS parsing for US format MM/DD/YYYY"[39m[33m,[39m () [33m=>[39m {
    [90m 84| [39m    [35mconst[39m date [33m=[39m [34mparseDateString[39m([32m"12/23/2025"[39m[33m,[39m [32m"19:40:08"[39m)[33m;[39m
    [90m 85| [39m    [34mexpect[39m(date[33m.[39m[34mtoISOString[39m())[33m.[39m[34mtoBe[39m([32m"2025-12-23T19:40:08.000Z"[39m)[33m;[39m
    [90m   | [39m                               [31m^[39m
    [90m 86| [39m  })[33m;[39m
    [90m 87| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/5]â¯[22m[39m

[41m[1m FAIL [22m[49m src/utils/utils.test.ts[2m > [22mparseDateString[2m > [22mshould handle empty time
[31m[1mAssertionError[22m: expected '2025-12-22T23:00:00.000Z' to be '2025-12-23T00:00:00.000Z' // Object.is equality[39m

Expected: [32m"2025-12-2[7m3T00[27m:00:00.000Z"[39m
Received: [31m"2025-12-2[7m2T23[27m:00:00.000Z"[39m

[36m [2mâ¯[22m src/utils/utils.test.ts:[2m90:32[22m[39m
    [90m 88| [39m  [34mit[39m([32m"should handle empty time"[39m[33m,[39m () [33m=>[39m {
    [90m 89| [39m    [35mconst[39m date [33m=[39m [34mparseDateString[39m([32m"23.12.2025"[39m[33m,[39m [32m""[39m)[33m;[39m
    [90m 90| [39m    [34mexpect[39m(date[33m.[39m[34mtoISOString[39m())[33m.[39m[34mtoBe[39m([32m"2025-12-23T00:00:00.000Z"[39m)[33m;[39m
    [90m   | [39m                               [31m^[39m
    [90m 91| [39m  })[33m;[39m
    [90m 92| [39m})[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[5/5]â¯[22m[39m


[2m Test Files [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m      Tests [22m [1m[31m5 failed[39m[22m[2m | [22m[1m[32m112 passed[39m[22m[2m | [22m[33m1 skipped[39m[90m (118)[39m
[2m   Start at [22m 02:07:39
[2m   Duration [22m 4.92s[2m (transform 2.78s, setup 0ms, import 4.96s, tests 394ms, environment 20.67s)[22m

