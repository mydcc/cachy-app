@import "tailwindcss";

/* Import KaTeX CSS globally - MUST be before Tailwind directives */
@import "katex/dist/katex.min.css";

/*
  Tailwind 4 Migration Note:
  The @theme block replaces the 'theme.extend' section from tailwind.config.js.
  All theme variables are now defined here using CSS variables.
*/
@theme {
  /* Colors */
  --color-primary: var(--bg-primary);
  --color-secondary: var(--bg-secondary);
  --color-tertiary: var(--bg-tertiary);
  --color-text-primary: var(--text-primary);
  --color-text-secondary: var(--text-secondary);
  --color-border-color: var(--border-color);
  --color-accent: var(--accent-color);
  --color-accent-hover: var(--accent-color-hover);
  --color-success: var(--success-color);
  --color-danger: var(--danger-color);
  --color-warning: var(--warning-color);

  /* Background Colors */
  --color-bg-primary: var(--bg-primary);
  --color-bg-secondary: var(--bg-secondary);
  --color-bg-tertiary: var(--bg-tertiary);
  --color-bg-btn-default: var(--btn-default-bg);
  --color-bg-btn-default-hover: var(--btn-default-hover-bg);
  --color-bg-btn-danger: var(--btn-danger-bg);
  --color-bg-btn-danger-hover: var(--btn-danger-hover-bg);
  --color-bg-btn-accent: var(--btn-accent-bg);
  --color-bg-btn-accent-hover: var(--btn-accent-hover-bg);
  --color-bg-btn-success: var(--btn-success-bg);
  --color-bg-btn-success-hover: var(--btn-success-hover-bg);
  --color-bg-toggle-off: var(--toggle-bg-off);
  --color-bg-toggle-on: var(--toggle-bg-on);

  /* Text Colors */
  --color-text-btn-default: var(--btn-default-text);
  --color-text-btn-danger: var(--btn-danger-text);
  --color-text-btn-accent: var(--btn-accent-text);
  --color-text-btn-success: var(--btn-success-text);

  /* Border Colors */
  --color-border-color: var(--border-color);

  /* Box Shadows */
  --shadow-tooltip: var(--shadow-tooltip);
}

/* Custom Fonts */
@font-face {
  font-family: "Inter";
  src: url("/fonts/Inter/Inter-VariableFont_opsz,wght.ttf") format("truetype");
  font-weight: 100 900;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: "Inter";
  src: url("/fonts/Inter/Inter-Italic-VariableFont_opsz,wght.ttf")
    format("truetype");
  font-weight: 100 900;
  font-style: italic;
  font-display: swap;
}

/* Variable Fonts */
@font-face {
  font-family: "IBM Plex Sans";
  src: url("/fonts/IBM_Plex_Sans/IBMPlexSans-VariableFont_wdth,wght.ttf")
    format("truetype");
  font-weight: 100 900;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: "JetBrains Mono";
  src: url("/fonts/JetBrains_Mono/JetBrainsMono-VariableFont_wght.ttf")
    format("truetype");
  font-weight: 100 900;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: "Roboto Mono";
  src: url("/fonts/Roboto_Mono/RobotoMono-VariableFont_wght.ttf")
    format("truetype");
  font-weight: 100 900;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: "Source Sans 3";
  src: url("/fonts/Source_Sans_3/SourceSans3-VariableFont_wght.ttf")
    format("truetype");
  font-weight: 100 900;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: "Manrope";
  src: url("/fonts/Manrope/Manrope-VariableFont_wght.ttf") format("truetype");
  font-weight: 100 900;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: "Nunito Sans";
  src: url("/fonts/Nunito_Sans/NunitoSans-VariableFont_YTLC,opsz,wdth,wght.ttf")
    format("truetype");
  font-weight: 100 900;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: "Nunito Sans";
  src: url("/fonts/Nunito_Sans/NunitoSans-Italic-VariableFont_YTLC,opsz,wdth,wght.ttf")
    format("truetype");
  font-weight: 100 900;
  font-style: italic;
  font-display: swap;
}

@font-face {
  font-family: "Red Hat Display";
  src: url("/fonts/Red_Hat_Display/RedHatDisplay-VariableFont_wght.ttf")
    format("truetype");
  font-weight: 100 900;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: "Red Hat Display";
  src: url("/fonts/Red_Hat_Display/RedHatDisplay-Italic-VariableFont_wght.ttf")
    format("truetype");
  font-weight: 100 900;
  font-style: italic;
  font-display: swap;
}

@font-face {
  font-family: "Schibsted Grotesk";
  src: url("/fonts/Schibsted_Grotesk/SchibstedGrotesk-VariableFont_wght.ttf")
    format("truetype");
  font-weight: 100 900;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: "Schibsted Grotesk";
  src: url("/fonts/Schibsted_Grotesk/SchibstedGrotesk-Italic-VariableFont_wght.ttf")
    format("truetype");
  font-weight: 100 900;
  font-style: italic;
  font-display: swap;
}

@font-face {
  font-family: "Space Grotesk";
  src: url("/fonts/Space_Grotesk/SpaceGrotesk-VariableFont_wght.ttf")
    format("truetype");
  font-weight: 100 900;
  font-style: normal;
  font-display: swap;
}

/* =================================================================
   Root & Default Theme
   ================================================================= */
:root,
.theme-default {
  /* --- Palette --- */
  --blue-950: #0f172a;
  --blue-900: #1e293b;
  --blue-800: #334155;
  --blue-700: #475569;
  --blue-600: #64748b;
  --blue-300: #94a3b8;
  --blue-100: #e2e8f0;
  --sky-400: #38bdf8;
  --sky-500: #0ea5e9;
  --sky-600: #0284c7;
  --green-500: #22c55e;
  --green-600: #16a34a;
  --red-500: #ef4444;
  --red-800: #991b1b;
  --red-900: #b91c1c;
  --yellow-400: #facc15;
  --black-transparent: rgba(0, 0, 0, 0.3);
  --black-overlay: rgba(0, 0, 0, 0.7);

  /* --- Semantic Mapping --- */
  --bg-primary: var(--blue-950);
  --bg-secondary: var(--blue-900);
  --bg-tertiary: var(--blue-800);
  --chat-bubble-bg: var(--blue-900);
  --chat-messages-bg: var(--blue-950);
  --scrollbar-thumb: var(--blue-800);
  --scrollbar-track: var(--blue-900);
  --text-primary: var(--blue-100);
  --text-secondary: var(--blue-300);
  --text-tertiary: var(--blue-600);
  --border-color: var(--blue-800);
  --accent-color: var(--sky-500);
  --accent-color-hover: var(--sky-400);
  --success-color: var(--green-500);
  --danger-color: var(--red-500);
  --warning-color: var(--yellow-400);
  --shadow-tooltip: 0 30px 90px -20px rgba(0, 0, 0, 0.5);

  /* --- Button Colors --- */
  --btn-default-bg: var(--blue-700);
  --btn-default-hover-bg: var(--blue-600);
  --btn-default-text: var(--blue-100);
  --btn-danger-bg: var(--red-800);
  --btn-danger-hover-bg: var(--red-900);
  --btn-danger-text: var(--blue-100);
  --btn-accent-bg: var(--sky-500);
  --btn-accent-hover-bg: var(--sky-600);
  --btn-accent-text: var(--blue-950);
  --btn-success-bg: var(--green-500);
  --btn-success-hover-bg: var(--green-600);
  --btn-success-text: var(--blue-950);

  /* --- Toggle & UI --- */
  --toggle-bg-off: var(--blue-700);
  --toggle-bg-on: var(--sky-500);
  --toggle-circle-bg: var(--blue-100);
  --toggle-circle-bg-on: var(--blue-100);
  --overlay-color: var(--black-overlay);
  /* --- Motion --- */
  --transition-fast: 0.15s ease-out;
  --transition-smooth: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  --transition-bounce: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);

  /* --- Glassmorphism Defaults --- */
  --glass-blur: 8px;
  --glass-saturate: 100%;
  --glass-opacity: 0.7;

  /* --- Z-Index System --- */
  --z-negative: -1;
  --z-base: 0;
  --z-dropdown: 20;
  --z-sticky: 30;
  --z-modal-backdrop: 40;
  --z-modal: 50;
  --z-tooltip: 60;
  --z-overlay: 100;
  --z-feedback: 200;
  --z-max: 9999;
}

/* =================================================================
   Light Theme
   ================================================================= */
.theme-light {
  /* --- Palette --- */
  --slate-100: #f1f5f9;
  --pure-white: #ffffff;
  --slate-200: #e2e8f0;
  --slate-800: #1e293b;
  --slate-900: #0f172a;
  --slate-500: #64748b;
  --slate-300: #cbd5e1;
  --slate-400: #94a3b8;
  --sky-400: #38bdf8;
  --sky-500: #0ea5e9;
  --green-600: #16a34a;
  --green-700: #15803d;
  --red-600: #dc2626;
  --red-500: #ef4444;
  --amber-500: #f59e0b;
  --indigo-600: #4f46e5;
  --indigo-500: #6366f1;
  --orange-500: #f97316;
  --black-transparent: rgba(0, 0, 0, 0.1);
  --white-transparent: rgba(255, 255, 255, 0.7);

  /* --- Semantic Mapping --- */
  --bg-primary: var(--slate-100);
  --bg-secondary: var(--pure-white);
  --bg-tertiary: var(--slate-200);
  --chat-bubble-bg: var(--slate-100);
  --chat-messages-bg: var(--pure-white);
  --scrollbar-thumb: var(--slate-300);
  --scrollbar-track: var(--slate-100);
  --text-primary: var(--slate-900);
  --text-secondary: var(--slate-500);
  --text-tertiary: var(--slate-400);
  --border-color: var(--slate-300);
  --accent-color: var(--indigo-600);
  --accent-color-hover: var(--indigo-500);
  --success-color: var(--green-600);
  --danger-color: var(--red-600);
  --warning-color: var(--orange-500);
  --shadow-tooltip: 0 10px 40px -10px rgba(0, 0, 0, 0.1);

  /* --- Button Colors --- */
  --btn-default-bg: var(--slate-400);
  --btn-default-hover-bg: var(--slate-300);
  --btn-default-text: var(--slate-800);
  --btn-danger-bg: var(--red-500);
  --btn-danger-hover-bg: var(--red-600);
  --btn-danger-text: var(--slate-100);
  --btn-accent-bg: var(--sky-400);
  --btn-accent-hover-bg: var(--sky-500);
  --btn-accent-text: var(--pure-white);
  --btn-success-bg: var(--green-600);
  --btn-success-hover-bg: var(--green-700);
  --btn-success-text: var(--pure-white);

  /* --- Toggle & UI --- */
  --toggle-bg-off: var(--slate-400);
  --toggle-bg-on: var(--sky-400);
  --toggle-circle-bg: var(--slate-100);
  --toggle-circle-bg-on: var(--slate-100);
  --overlay-color: var(--white-transparent);
}

/* =================================================================
   Meteorite Theme - Vollst√§ndige Farbpalette
   ================================================================= */
.theme-meteorite {
  /* --- Core Colors --- */
  --core-purple: #4e21e7;
  --core-meteorite: #433f65;
  --core-green-free: #0da49a;
  --core-blue-pro: #334eff;
  --core-red-insights: #ee485f;

  /* --- Highlighting Colors --- */
  --highlight-purple: #7383f5;
  --highlight-meteorite: #c2befa;
  --highlight-green-free: #48b0b2;
  --highlight-blue-pro-alt: #7fb5a8;
  --highlight-blue-pro: #80b8f2;
  --highlight-red-alt: #fa9de7;
  --highlight-red: #ff60ee;

  /* --- Gradient Colors --- */
  --gradient-purple-light: #2b1f99;
  --gradient-purple-dark: #0c082f;
  --gradient-green-light: #3c8499;
  --gradient-green-dark: #002039;
  --gradient-blue-light: #3c6e99;
  --gradient-blue-dark: #08103f;
  --gradient-red-light: #6d2954;
  --gradient-red-dark: #0f0523;

  /* --- Light and Dark Colors --- */
  --purple-light: #ede8fd;
  --purple-dark: #0c082f;
  --green-free-light: #e6f6f5;
  --green-free-dark: #002039;
  --blue-pro-light: #eaedff;
  --blue-pro-dark: #08103f;
  --red-insights-light: #feecef;
  --red-insights-dark: #0f0523;

  /* --- Derived Colors --- */
  --bg-secondary-derived: #1a154a;
  --bg-tertiary-derived: #2b1f99;
  --chat-bubble-assistant-bg: #0c082f;
  --accent-hover-derived: #5c71ff;
  --default-hover-derived: #5b587d;
  --danger-hover-derived: #f46d7e;
  --success-hover-derived: #3db6af;
  --overlay-derived: rgba(12, 8, 47, 0.8);

  /* --- Semantic Mapping --- */
  --bg-primary: radial-gradient(
    farthest-side at top,
    var(--gradient-purple-light),
    var(--gradient-purple-dark)
  );
  --bg-secondary: #08051e;
  /* Deepest purple for sidebar & inputs */
  --bg-tertiary: #161245;
  /* Slightly lighter for card backgrounds */
  --chat-bubble-bg: var(--chat-bubble-assistant-bg);
  --chat-messages-bg: var(--gradient-purple-dark);
  --scrollbar-thumb: var(--bg-tertiary);
  --scrollbar-track: var(--bg-secondary);
  --text-primary: var(--purple-light);
  --text-secondary: var(--highlight-meteorite);
  --text-tertiary: var(--core-meteorite);
  --border-color: #2b1f99;
  /* Sharper borders for better separation */
  --accent-color: var(--core-blue-pro);
  --accent-color-hover: var(--accent-hover-derived);
  --success-color: var(--core-green-free);
  --danger-color: var(--core-red-insights);
  --warning-color: var(--highlight-red-alt);
  --shadow-tooltip: 0 30px 90px -20px rgba(12, 8, 47, 0.5);

  /* --- Button Colors --- */
  --btn-default-bg: var(--core-meteorite);
  --btn-default-hover-bg: var(--default-hover-derived);
  --btn-default-text: var(--purple-light);
  --btn-danger-bg: var(--core-red-insights);
  --btn-danger-hover-bg: var(--danger-hover-derived);
  --btn-danger-text: var(--purple-light);
  --btn-accent-bg: var(--core-blue-pro);
  --btn-accent-hover-bg: var(--accent-hover-derived);
  --btn-accent-text: var(--purple-light);
  --btn-success-bg: var(--core-green-free);
  --btn-success-hover-bg: var(--success-hover-derived);
  --btn-success-text: var(--purple-light);

  /* --- Toggle Colors --- */
  --toggle-bg-off: var(--core-meteorite);
  --toggle-bg-on: var(--core-blue-pro);
  --toggle-circle-bg: var(--purple-light);
  --toggle-circle-bg-on: var(--purple-light);

  /* --- Overlay --- */
  --overlay-color: var(--overlay-derived);
}

/* ... (Remaining themes are defined similarly by mapping variables to semantic names) ... */
/* For brevity, I'm assuming the existing theme classes correctly set CSS variables. */
/* Tailwind 4 will automatically pick up any variables defined in :root or scope and make them available if referenced via arbitrary values or theme config */

/* Base & Component Styles */
html {
  background-color: var(--bg-primary);
  background-image: var(--bg-primary);
  background-attachment: fixed;
  min-height: 100%;
}

body {
  font-family: var(--app-font-family, "Inter"), sans-serif;
  background: transparent;
  color: var(--text-primary);
  transition: color 0.3s;
  position: relative;
  margin: 0;
  padding: 0;
  min-height: 100vh;
}

table,
input,
select {
  font-variant-numeric: tabular-nums;
}

.calculator-wrapper {
  background-color: var(--bg-secondary);
}

.input-field {
  background-color: var(--bg-tertiary);
  border: 1px solid var(--border-color);
  color: var(--text-primary);
  font-variant-numeric: tabular-nums;
}

.settings-number-input {
  width: 70px;
  text-align: left;
  padding: 0.25rem 0.5rem;
  font-variant-numeric: tabular-nums;
}

.input-field:disabled {
  background-color: var(--bg-secondary);
  cursor: not-allowed;
  opacity: 0.7;
}

.input-field.invalid {
  border-color: var(--danger-color);
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--danger-color) 40%, transparent);
}

.tp-percent.locked-input {
  background: var(--bg-primary);
  cursor: not-allowed;
}

.section-header {
  background-color: var(--bg-tertiary);
  padding: 0.5rem 1rem;
  border-radius: 0.375rem;
  margin-bottom: 1rem;
  font-weight: 700;
  font-size: 0.875rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--text-secondary);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.result-group {
  background: var(--bg-primary);
  padding: 1rem;
  border-radius: 0.5rem;
  margin-top: 1.5rem;
}

.result-item {
  display: flex;
  justify-content: space-between;
  align-items: baseline;
  flex-wrap: wrap;
  padding: 0.75rem 0;
  border-bottom: 1px solid var(--bg-tertiary);
}

.result-item:last-child {
  border-bottom: none;
}

.result-label {
  color: var(--text-secondary);
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-right: 1rem;
}

.input-label {
  @apply block text-xs font-medium text-[var(--text-secondary)] mb-1;
}

.result-value {
  color: var(--text-primary);
  font-weight: 600;
  text-align: right;
  word-break: break-all;
  flex-grow: 1;
  font-variant-numeric: tabular-nums;
}

.fade-in {
  animation: fadeIn 0.5s ease-in-out;
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }

  to {
    opacity: 1;
    transform: translateY(0);
  }
}

input[type="number"]::-webkit-inner-spin-button,
input[type="number"]::-webkit-outer-spin-button {
  -webkit-appearance: none;
  appearance: none;
  margin: 0;
}

input[type="number"] {
  -moz-appearance: textfield;
  appearance: textfield;
}

.input-wrapper {
  position: relative;
  display: inline-flex;
  vertical-align: middle;
}

.custom-spin-buttons {
  position: absolute;
  right: 4px;
  top: 50%;
  transform: translateY(-50%);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 1px;
  pointer-events: none;
  z-index: 10;
  transition: opacity 0.2s ease;
}

.custom-spin-buttons.hover-only {
  opacity: 0;
}

.input-wrapper:hover .custom-spin-buttons.hover-only,
.input-wrapper:focus-within .custom-spin-buttons.hover-only {
  opacity: 1;
}

.spin-btn {
  pointer-events: auto;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--text-secondary);
  opacity: 0.7;
  transition: all 0.2s ease;
  padding: 0;
  height: 10px;
  width: 12px;
}

.spin-btn:hover {
  color: var(--accent-color);
  opacity: 1;
}

.spin-btn svg {
  width: 10px;
  height: 10px;
}

.trade-type-switch button {
  padding: 0.5rem 1rem;
  border-radius: 0.375rem;
  transition: all 0.2s ease-in-out;
  border: 1px solid transparent;
}

.trade-type-switch button.active {
  font-weight: 700;
}

.trade-type-switch button.long.active {
  background-color: var(--success-color);
  border-color: var(--success-color);
  color: var(--btn-success-text);
}

.trade-type-switch button.short.active {
  background-color: var(--danger-color);
  border-color: var(--danger-color);
  color: var(--btn-danger-text);
}

.trade-type-switch button:not(.active) {
  background-color: var(--bg-tertiary);
  color: var(--text-primary);
}

.trade-type-switch {
  background-color: var(--bg-tertiary);
}

/* Styles for ATR Mode Switcher */
.atr-mode-switcher {
  display: flex;
  gap: 0.5rem;
  /* 8px */
}

.btn-switcher {
  padding: 0;
  border: none;
  background-color: transparent;
  color: var(--text-secondary);
  cursor: pointer;
  transition: color 0.2s ease-in-out;
  font-size: 0.875rem;
  /* 14px */
  font-weight: 500;
  /* Medium weight for non-active */
}

.btn-switcher.active {
  color: var(--text-primary);
  font-weight: 700;
  /* Bold for active */
}

.atr-toggle-track {
  background-color: var(--toggle-bg-off);
  transition: background-color 0.3s;
}

input[type="checkbox"]:checked + .atr-toggle-track {
  background-color: var(--toggle-bg-on);
}

.atr-toggle-track::after {
  background-color: var(--toggle-circle-bg);
  border-color: var(--border-color);
  transition:
    transform 0.3s,
    background-color 0.3s,
    border-color 0.3s;
}

input[type="checkbox"]:checked + .atr-toggle-track::after {
  transform: translateX(calc(100% + 2px));
  border-color: var(--toggle-circle-bg-on) !important;
  background-color: var(--toggle-circle-bg-on) !important;
}

.copy-btn,
.price-fetch-btn {
  background: none;
  border: none;
  color: var(--text-secondary);
  cursor: pointer;
  transition: color 0.2s;
  padding-right: 0.25rem;
}

.copy-btn:hover,
.price-fetch-btn:hover {
  color: var(--success-color);
}

/* New class for accent-colored icon buttons */
.btn-icon-accent {
  color: var(--accent-color);
  transition: color 0.2s;
}

.btn-icon-accent:hover {
  color: var(--accent-color-hover);
}

/* New class for lock icons */
.btn-lock-icon {
  color: var(--text-secondary);
  transition: color 0.2s;
}

.btn-lock-icon:hover {
  color: var(--accent-color);
}

/* New class for modal OK button */
.btn-modal-ok {
  background-color: var(--btn-accent-bg);
  color: var(--btn-accent-text);
  transition: background-color 0.2s;
}

.btn-modal-ok:hover {
  background-color: var(--btn-accent-hover-bg);
}

/* Custom classes for theme-aware Buttons */
.btn-primary-action {
  background: var(--btn-accent-bg);
  color: var(--btn-accent-text);
  transition: all 0.3s ease;
}

.btn-primary-action:hover {
  background: var(--btn-accent-hover-bg);
  transform: translateY(-2px);
  box-shadow:
    0 4px 6px rgba(0, 0, 0, 0.1),
    0 0 10px rgba(102, 126, 234, 0.1);
}

/* Pro Execute Button: Special styling for trade execution */
.btn-primary-action.pro-execute {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
  position: relative;
  overflow: hidden;
}

.btn-primary-action.pro-execute::before {
  content: "";
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    90deg,
    transparent,
    rgba(255, 255, 255, 0.15),
    transparent
  );
  transition: left 0.6s ease;
}

.btn-primary-action.pro-execute:hover::before {
  left: 100%;
}

.btn-primary-action.pro-execute:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
}

.btn-secondary-action {
  background-color: var(--btn-default-bg);
  color: var(--btn-default-text);
  transition: background-color 0.2s;
}

.btn-secondary-action:hover {
  background-color: var(--btn-default-hover-bg);
}

.btn-primary-action:disabled,
.btn-secondary-action:disabled {
  background-color: var(--bg-tertiary);
  color: var(--text-secondary);
  cursor: not-allowed;
}

.copy-feedback,
.save-feedback {
  color: var(--success-color);
  font-size: 0.8rem;
  visibility: hidden;
  opacity: 0;
  transition: all 0.3s;
}

.copy-feedback.visible,
.save-feedback.visible {
  visibility: visible;
  opacity: 1;
}

.visual-bar-container {
  background: var(--bg-primary);
  padding: 2.5rem 1rem 2.5rem 1rem;
  border-radius: 0.5rem;
  margin-top: 1.5rem;
  position: relative;
}

.visual-bar {
  height: 1.5rem;
  position: relative;
  display: flex;
  border-radius: 0.375rem;
  overflow: visible;
  background-color: var(--bg-tertiary);
}

.loss-zone {
  background-color: var(--danger-color);
  position: absolute;
  height: 100%;
}

.gain-zone {
  background-color: var(--success-color);
  position: absolute;
  height: 100%;
}

.bar-marker {
  position: absolute;
  top: -0.25rem;
  bottom: -0.25rem;
  width: 20px;
  display: flex;
  flex-direction: column;
  align-items: center;
  cursor: pointer;
  transform: translateX(-50%);
}

.bar-marker::before {
  content: "";
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  width: 4px;
  height: 100%;
  background-color: var(--text-primary);
}

.bar-marker span {
  position: absolute;
  font-size: 0.75rem;
  background-color: var(--bg-tertiary);
  padding: 0.1rem 0.3rem;
  border-radius: 0.25rem;
  white-space: nowrap;
}

.bar-marker:not(.entry-marker) span {
  bottom: 100%;
  margin-bottom: 0.25rem;
  box-shadow: var(--shadow-tooltip);
}

.entry-marker span {
  top: 100%;
  margin-top: 0.25rem;
}

.bar-marker:hover .tp-tooltip {
  visibility: visible;
  opacity: 1;
  transform: translateX(-50%) translateY(-5px);
}

.tp-tooltip {
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%) translateY(0);

  visibility: hidden;
  opacity: 0;
  transition:
    opacity 0.2s,
    visibility 0.2s,
    transform 0.2s;

  background-color: var(--bg-tertiary);
  color: var(--text-primary);
  padding: 0.5rem 0.75rem;
  border-radius: 0.5rem;
  font-size: 0.8rem;
  white-space: nowrap;
  z-index: var(--z-tooltip);
  pointer-events: none;
  box-shadow: var(--shadow-tooltip);
}

.tp-tooltip::before {
  content: "";
  position: absolute;
  top: 100%;
  left: 50%;
  transform: translateX(-50%);
  width: 0;
  height: 0;
  border-left: 5px solid transparent;
  border-right: 5px solid transparent;
  border-top: 5px solid var(--bg-tertiary);
}

.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: var(--overlay-color);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: var(--z-modal);
  visibility: hidden;
  opacity: 0;
  transition:
    opacity 0.3s ease-in-out,
    visibility 0.3s ease-in-out;
}

.modal-overlay.visible {
  visibility: visible;
  opacity: 1;
}

.modal-content {
  background-color: var(--bg-secondary);
  padding: 2rem;
  border-radius: 1rem;
  max-width: 90vw;
  max-height: 90vh;
  overflow-y: auto;
  transform: scale(0.95);
  opacity: 0;
  transition:
    transform 0.2s ease-in-out,
    opacity 0.2s ease-in-out;
}

.modal-overlay.visible .modal-content {
  transform: scale(1);
  opacity: 1;
}

.journal-table {
  width: 100%;
  border-collapse: collapse;
  font-variant-numeric: tabular-nums;
}

.journal-table th,
.journal-table td {
  padding: 0.75rem;
  border: 1px solid var(--border-color);
  text-align: left;
  font-size: 0.875rem;
}

.journal-table th {
  background-color: var(--bg-tertiary);
}

.notes-cell {
  max-width: 200px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  cursor: pointer;
  transition: all 0.2s ease-in-out;
}

.notes-cell.expanded {
  white-space: pre-wrap;
  overflow: visible;
  text-overflow: clip;
  max-width: 400px;
}

.journal-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
  gap: 0.5rem;
  margin-bottom: 1.5rem;
}

.stat-card {
  background: var(--bg-primary);
  padding: 0.75rem;
  border-radius: 0.5rem;
  text-align: center;
}

.stat-value {
  font-size: 1.25rem;
  font-weight: 700;
}

.stat-label {
  font-size: 0.75rem;
  color: var(--text-secondary);
}

.suggestion-item {
  background-color: var(--bg-secondary);
  padding: 0.5rem 1rem;
  cursor: pointer;
  color: var(--text-primary);
}

.suggestion-item:hover {
  background-color: var(--accent-color);
  color: var(--btn-accent-text);
}

.prose h3 {
  margin-top: 1.5em;
  margin-bottom: 0.5em;
  font-size: 1.25rem;
  font-weight: 600;
  border-bottom: 1px solid var(--border-color);
  padding-bottom: 0.3em;
}

.prose p {
  margin-bottom: 1em;
  line-height: 1.6;
}

.prose ul {
  list-style-type: disc;
  margin-left: 1.5em;
  margin-bottom: 1em;
}

.prose li {
  margin-bottom: 0.5em;
}

.prose strong {
  color: var(--text-primary);
  font-weight: 600;
}

.prose code {
  background-color: var(--bg-tertiary);
  padding: 0.2em 0.4em;
  margin: 0;
  font-size: 85%;
  border-radius: 3px;
}

.price-loaded-flash {
  animation: price-flash 0.7s ease-in-out;
}

@keyframes price-flash {
  0% {
    background-color: var(--bg-tertiary);
  }

  30% {
    background-color: color-mix(
      in srgb,
      var(--accent-color) 50%,
      var(--bg-tertiary)
    );
  }

  100% {
    background-color: var(--bg-tertiary);
  }
}

/* Glassmorphism Utility */
.glass-panel {
  background: var(--bg-secondary);
  transition:
    backdrop-filter var(--transition-smooth),
    background var(--transition-smooth);
}

.glass-enabled .glass-panel {
  background: color-mix(
    in srgb,
    var(--bg-secondary) calc(var(--glass-opacity) * 100%),
    transparent
  );
  backdrop-filter: blur(var(--glass-blur)) saturate(var(--glass-saturate));
  -webkit-backdrop-filter: blur(var(--glass-blur))
    saturate(var(--glass-saturate));
}

/* Hover & Focus Enhancements */
button,
.clickable {
  transition:
    opacity var(--transition-fast),
    background var(--transition-fast);
}

input:focus,
select:focus,
textarea:focus {
  outline: none;
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent-color) 30%, transparent);
  transition: box-shadow var(--transition-fast);
}

  /* Fix for browser autofill (white background issue) */
input:-webkit-autofill,
input:-webkit-autofill:hover,
input:-webkit-autofill:focus,
input:-webkit-autofill:active {
  -webkit-box-shadow: 0 0 0 1000px var(--bg-tertiary) inset !important;
  -webkit-text-fill-color: var(--text-primary) !important;
  caret-color: var(--text-primary);
  /* transition: background-color 5000s ease-in-out 0s; - Removed to prevent conflicts */
}

/* Global Interaction Helper: Prevents transition lag during drag/resize operations */
.is-interacting {
    transition: none !important;
    pointer-events: auto !important; /* Ensure events continue to fire */
}

/* Improved App Feel & PWA optimizations */
html,
body {
  overscroll-behavior: auto;
  /* Allows pull-to-refresh and rubber-banding */
  -webkit-tap-highlight-color: transparent;
  /* Clean mobile taps */
  padding: env(safe-area-inset-top) env(safe-area-inset-right)
    env(safe-area-inset-bottom) env(safe-area-inset-left);
}

h1,
h2,
.header-title,
.icons,
svg {
  user-select: none;
  /* Prevents accidental selection of UI elements */
}

/* Loading Shimmer */
.shimmer {
  background: linear-gradient(
    90deg,
    var(--bg-tertiary) 25%,
    color-mix(in srgb, var(--bg-tertiary) 80%, var(--text-tertiary)) 50%,
    var(--bg-tertiary) 75%
  );
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite linear;
}

@keyframes shimmer {
  0% {
    background-position: 200% 0;
  }

  100% {
    background-position: -200% 0;
  }
}

/* Price Flash Animations */
@keyframes flash-green-text {
  0% {
    color: var(--success-color);
    transform: scale(1.1);
  }

  100% {
    color: inherit;
    transform: scale(1);
  }
}

@keyframes flash-red-text {
  0% {
    color: var(--danger-color);
    transform: scale(1.1);
  }

  100% {
    color: inherit;
    transform: scale(1);
  }
}

.price-up-flash {
  animation: flash-green-text 0.5s ease-out;
  display: inline-block;
}

.price-down-flash {
  animation: flash-red-text 0.5s ease-out;
  display: inline-block;
}

.price-up {
  animation: flash-green 0.8s ease-out;
}

.price-down {
  animation: flash-red 0.8s ease-out;
}

.text-link {
  color: var(--accent-color);
  text-decoration: none;
}

.text-link:hover {
  text-decoration: underline;
}

/* =================================================================
   Accessibility & Specific Overrides
   ================================================================= */
/*
  The following overrides ensure proper text contrast on buttons
  where the default text color (--btn-success-text, --btn-danger-text)
  does not provide enough contrast against the button's background color
  in a specific theme.
*/

/* Solarized Light: Use dark text on light green 'Long' button */
.theme-solarized-light .trade-type-switch button.long.active {
  color: var(--base04);
}

/* =================================================================
   Scrollbar & Modal Styles
   ================================================================= */
/* Themed Scrollbar Styles */
::-webkit-scrollbar {
  width: 12px;
}

::-webkit-scrollbar-track {
  background: var(--scrollbar-track, var(--bg-secondary));
}

::-webkit-scrollbar-thumb {
  background-color: var(--scrollbar-thumb, var(--bg-tertiary));
  border-radius: 6px;
  border: 3px solid var(--scrollbar-track, var(--bg-secondary));
}

::-webkit-scrollbar-thumb:hover {
  background-color: var(--accent-color);
}

/* Firefox Scrollbar Styles */
* {
  scrollbar-width: thin;
  scrollbar-color: var(--scrollbar-thumb, var(--bg-tertiary))
    var(--scrollbar-track, var(--bg-secondary));
}

/* Modal Size Utilities */
.modal-size-sm {
  @apply w-[90vw] max-w-lg;
}

.modal-size-journal {
  width: 80vw;
}

.modal-size-instructions {
  width: 80vw;
  max-width: 1320px;
  aspect-ratio: 3 / 2;
}

@media (max-width: 768px) {
  .modal-size-instructions {
    aspect-ratio: auto;
  }
}

/* App Container for Footer Layout */
.app-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  /* Center horizontally */
  justify-content: center;
  /* Center vertically if space allows */
  min-height: 100vh;
  padding: 1rem;
  width: 100%;
  box-sizing: border-box;
}
